# Analysis of Kinetics Data from a CSTR {#sec-6_cstr_data_analysis}

This section of *Reaction Engineering Basics* focuses upon the analysis of kinetics data for the purpose of assessing the accuracy of a proposed rate expression. @sec-6_kin_data_gen presented a general introduction to kinetics data generation and analysis and @sec-6_bstr_data_analysis examined the analysis of kinetics data generated using a BSTR. This chapter is like @sec-6_bstr_data_analysis except it is focused on the analysis of kinetics data generated using a CSTR.

## Laboratory CSTRs

There are many similarities between BSTRs and CSTRs. The primary difference is that fluid continually flows in and out of a CSTR. Basically CSTRs are BSTRs with inlet and outlet flow streams. Other than the stopped flow reactor, the BSTRs described in @sec-6_bstr_data_analysis could be converted to CSTR simply by adding a flow in and a flow out. In the case of the recirculation loop reactor, @fig-batch_recirc_reactor, the flow in and out should be small compared to the recirculation flow within the loop. As with the BSTR, one of the most important characteristics of a CSTR is that it is perfectly mixed. As discussed below, when a CSTR is used to generate kinetics data, it is preferable to operate the CSTR at steady state. Consequently, in addition to assessing the mixing before experiments begin, it is also important to verify steady-state operation while conducting the experiments.

### Testing the Ideality of a CSTR

Given the similarities between BSTRs and CSTRs, most of the discussion in @sec-6_bstr_data_analysis applies here, as well. Specifically, one of the most important requirements is that the reactor must be perfectly mixed. Smoke tests and the measurement of the reactor response as the agitation rate is increased again can be used to test for perfect mixing. In addition, a property known as the residence time distribution can be used to assess how well a reactor conforms to the assumptions of an ideal CSTR. Essentially, it provides a necessary, but not sufficient, criterion that the laboratory reactor must satisfy. The measurement and use of the residence time distribution will be presented in @sec-7_seg_flow_models.

## CSTR Kinetics Experiments and Data

The nature of kinetics experiments involving a CSTR and the data they generate is different in some respects from a BSTR. To prevent the generally strong temperature dependence of reaction rates from masking weaker composition and pressure effects, steady-state experiments using a temperature controller are preferred. The temperature controller continually monitors the reactor temperature and adjusts the heat input and/or cooling so that the reacting fluid temperature remains constant. To facilitate data analysis, experiments should be performed in blocks where all of the experiments in a block are performed at the same temperature. That way, if difficulties are encountered when attempting to estimate kinetics parameters using the entire data set, each of the same-temperature data blocks can be analyzed separately. That will yield, for example, a secondary set of $k$ *vs.* $T$ data to which the Arrhenius expression can be fit to find $k_0$ and $E$. (See the discussion section of [Example -@sec-example_19_5_1] for the advantages and disadvantages of parameter estimation using the full data set compared to estimation using same-temperature blocks of data.)

When the experimental CSTR operates at steady state, the reactor design equations are ATEs. Since the reacting fluid temperature is constant and known, the mole balance design equations can be solved independently of the energy balances, so only the mole balances are needed when analyzing steady-state CSTR kinetics data.

In a typical CSTR kinetics experiment, the rate of fluid flow into the reactor is set along with the composition of the feed fluid, the pressure and the reacting fluid temperature. Once these inputs have been fixed, the flow rate and composition of the fluid leaving the reactor is monitored. Initially the outlet composition and flow rate may change over time. This indicates that the CSTR has not yet reached steady state. When the outlet flow rate and composition become constant, the CSTR has reached steady state, and the response can be measured to conclude the experiment. This is very different from BSTR experiments where the response was measured several times during a single experiment. The reason, of course, is that the composition changes during a BSTR experiment wherease nothing changes during a steady-state CSTR experiment. Consequently, the generation of kinetics data using a CSTR typically involves many more experiments compared to when a BSTR is used. Because reagents are flowing the whole time until steady-state is reached, CSTR experiments typically consume more reagent than batch experiments.

## Design of CSTR Experiments

In isothermal BSTR experiments the initial composition and pressure of the reacting fluid and the elapsed time at which the response was measured were the inputs that were adjusted so that the experiments sampled a wide range of compositions. In a sense, the same is true of flow reactor experiments (both CSTR and PFR), but in flow reactors the space time, @eq-space_time, determines how long the reaction is allowed to proceed instead of the elapsed wall-clock time (see @sec-3_design_eqns). This means that for flow reactors there are more reactor inputs that can be adjusted from experiment to experiment.

As noted in @sec-6_bstr_data_analysis, preliminary studies typically define ranges of interest for temperature, pressure, and composition, and the purpose of kinetics experiments is to generate kinetics data that span those ranges. For each factor (e.g. the temperature, pressure, the concentration of reagent A, the concentration of reagent B, etc.) a set of values (also called levels) are chosen that span its range of interest. Increasing the number of levels improves the resolution of the effect of that factor upon the reaction rate. At the same time, increasing the number of levels increases the number of experiments that must be performed. Once the levels have been chosen for each factor, a factorial design like that described in @sec-6_kin_data_gen can be used to specify the experiments that will be performed.

### Adjusted Experimental Inputs

Temperature is always an important factor in kinetics experiments. The pressure is constant in CSTR experiments, so if pressure is a factor of interest, the reactor pressure becomes one of the adjusted inputs. Typically the pressure does not affect the rate of liquid-phase reactions, but it can be important for gas-phase reactions.

The concentrations (or, for gases, partial pressures) within the reactor are the ones that need to span their range of interest, but unfortunately they cannot be adjusted directly. Instead, the composition and flow rate of the feed entering the reactor are adjusted. Depending upon the configuration of the feed system, the variables that can be adusted include the molar flow rates of the individual reagents or the volumetric flow rate of the feed and the concentrations of the reagents in that feed. Changing these quantities effectively changes the starting composition and the space time.  (This assumes that the same reactor will be used in every experiment so the reactor volume cannot be adjusted to vary the space time.)

### Experimental Responses

It was noted in @sec-6_bstr_data_analysis that there are many different quantities that can be used as the experimental response. That discussion won't be repeated here. The response should be a quantity that is directly related to the composition of the fluid leaving the reactor or to the extent of reaction relative to the reactor feed. In other words, after measuring the response and knowing the feed, it should be possible to calculate the concentration of every reagent in the product stream leaving the reactor.

## CSTR Data Analysis

The focus of this section is the analysis of a block of experimental CSTR kinetics data where the steady-state reactor temperature was the same in every experiment. Once all blocks have been analyzed as described here, the Arrhenius expression can be fit to the resulting rate coefficients *versus* block temperature data. The fitting of the Arrhenius expression has been discussed and illustrated several times in @sec-2_rates_rate_express, @sec-3_design_eqns, and @sec-6_bstr_data_analysis, and should be familiar at this point. It won't be repeated again here, but instead, analysis of a constant-temperture block of CSTR kinetics data using the CSTR reactor design equations is featured.

@sec-3_design_eqns explained that when a reactor operates at a constant, known temperature, the mole balances for the reactor can be solved independently of the other reactor design equations. Consequently the steady-state form of the ideal CSTR mole balance, @eq-cstr_ss_mole_balance, is the only equation needed to model the reactor used to generate CSTR kinetics data. In *Reaction Engineering Basics* the kinetics data analysis problems are limited to systems where only one reaction is taking place. In that situation, it is not necessary to use an index to differentiate between multiple reactions, and the steady-state mole balance takes the form shown in @eq-cstr_mole_bal_one_reaction.

$$
0 = \dot{n}_{i,in} - \dot{n}_i + \nu_i r V
$${#eq-cstr_mole_bal_one_reaction}

When a rate expression is substituted into @eq-cstr_mole_bal_one_reaction it will introduce the concentration (or possibly for gases, partial pressure) of one or more reagents. In order to solve the mole balances for the outlet molar flow rates of the reagents, the concentration or partial pressure must be expressed in terms of the molar flow rates. At steady-state, the volumetric flow rate is constant and the concentration is related to the molar flow rate as shown in @eq-concentration_open.

$$
C_i = \frac{\dot n_i}{\dot V}
$$

CSTRs operate at constant pressure, and when used in kinetics experiments, the temperature is also constant. For gas phase systems, however, the volumetric flow rate in @eq-concentration_open will not equal the feed volumetric flow rate if the reaction causes a change in the total number of moles. Using the ideal gas law to express the volumetric flow rate in terms of the molar flow rates yields the preferred expression for the concentration of a gas phase reagent, $i$, shown in @eq-conc_cstr_kinetics.

$$
C_i = \frac{\dot n_iP}{RT\displaystyle \sum_i\left( \dot{n}_i \right)}
$${#eq-conc_cstr_kinetics}

If the rate expression for a gas-phase reaction uses partial pressures instead of concentrations, the partial pressure is related to the molar flow rates as shown in @eq-partial_pressure_kinetics.

$$
P_i = y_iP = \frac{\dot{n}_iP}{\displaystyle \sum_i\left( \dot{n}_i \right)}
$${#eq-partial_pressure_kinetics}

### Analysis Using a Predicted Response Function

The analysis of CSTR kinetics data using a predicted responses function is analogous to the analysis of BSTR kinetics data using a predicted responses function. The only difference is that the reactor model is a set of ATEs that must be solved numerically instead of a set of IVODEs. Briefly, the procedure is as follows. A model for the experimental CSTR is generated. The CSTR model can be used to calculate the outlet molar flow rates of the reagents in any one experiment.

A predicted responses function is then created. For each experiment it uses the CSTR model to calculate the outlet molar flow rates of the reagents. The outlet molar flow rates, in turn, are used to calculate the model-predicted response. This is repeated for all of the experiments, and the predicted responses function returns the model-predicted responses for all of the experiments.

As noted, the CSTR mole balance design equations are ATEs that will be solved numerically. See @sec-apndx_solve_ates for a brief overview of the numerical solution of ATEs. A guess for the unknowns is typically needed when solving ATEs numerically. For this reason, it is useful to also make the experimental responses available to the CSTR model. They can be used to make good guesses for the unknowns in the mole balances. The details for doing this will depend upon the software being used..

The response function is then provided to parameter estimation software along with the adjusted experimental inputs, the experimental responses, and a guess for the parameters. The parameter estimation software returns the estimated values of the kinetics parameters, some measure of the uncertainty in the estimates, and the coefficient of determination, $R^2$. The estimated parameters can then be used to calculate the model-predicted responses for the experiments. From these, a parity plot and residuals plots can be created as described in @sec-6_kin_data_gen. If the rate expression is accurate, the following criteria will be satisfied.

* The coefficient of determination, $R^2$, will be close to 1.
* The uncertainty in most, if not all, parameter estimates will be small compared to the estimate. (See @sec-6_kin_data_gen for a discussion of why a few estimates may have a large uncertaintly.)
* The points in the parity plot will all be close to the diagonal $y_{\text{expt}} = y_{\text{model}}$ line.
* In each residuals plot, the points will scatter randomly about zero (the horizontal axis), and no systematic deviations will be apparent.

### Analysis Using a Linearized Model

When only one reaction is taking place, as is the case in *Reaction Engineering Basics* kinetics data analysis problems, the reactor can be modeled using only one mole balance on a reactant or product in the reaction. When this is done, the apparent extent of reaction is used to relate the amounts of all other reagents to the reagent for which the mole balance is written. If that one mole balance can be rearranged into a linear form, it can be fit to the experimental data using linear least squares. This was described and illustrated in @sec-6_kin_data_gen and @sec-6_bstr_data_analysis and won't be repeated or illustrated in this chapter.

One point to note, however, is that with CSTR kinetics data, the mole balance is already an ATE. It isn't necessary to integrate an IVODE before linearizing it. Indeed, for a simple rate expression with only one rate coefficient of the form shown in @eq-simple_rate_expr, the mole balance, @eq-cstr_mole_bal_one_reaction, will already have the linear form shown in @eq-linear_no_intercept if $y$ and $x$ are defined as shown in @eq-def_y and @eq-def_x.

$$
r = kf\left(\dot{n}_i,P\right)
$${#eq-simple_rate_expr}

$$
y=kx
$${#eq-linear_no_intercept}

$$
y = \dot{n}_i - \dot{n}_{i,in}
$${#eq-def_y}

$$
x=\nu_i V f\left(\dot{n}_i,P\right)
$${#eq-def_x}

## Examples

```{r}
#| echo: false
#| output: false
library(tidyverse)
library(knitr)
library(kableExtra)
source('~/Libraries/R/fmt_tibble_col.R')
```

As noted above, the analysis of data from a CSTR is quite similar to the analysis of BSTR data (@sec-6_bstr_data_analysis) or PFR data (@sec-6_pfr_data_analysis). Perhaps the most significant difference for analysis of CSTR data is that the reactor design equations are ATEs whereas for BSTRs and PFRs they are IVODEs. In each of the examples in this chapter presents a single, same-temperature block of data is analyzed.

If one wished or needed to analyzed many such data blocks, the analysis illustrated here could be repeated for each data block. The Arrhenius expression, @eq-arrhenius, could then be fit to the resulting rate coefficient *versus* temperature data. This is illustrated in Examples -@sec-example_4_5_4, -@sec-example_L_7_1, -@sec-example_19_5_1, and -@sec-example_19_5_2 (using the linearized model). Alternatively, the CSTR model could be formulated in terms of $k_0$ and $E$ and the complete data set could be analyzed at once as illustrated in [Example -@sec-example_19_5_2].

The first example here considers a liquid-phase reaction. Assuming liquids to be incompressible, ideal mixtures means that the inlet and outlet volumetric flow rates are equal. In contrast, for a gas-phase reacting fluid the inlet and outlet volumetric flow rates will not be equal if the reaction causes a change in the total number of moles. That situation is illustrated in [Example -@sec-example_20_5_2]. The final example in this chapter illustrates the assessment of a rate expression that contains both forward and reverse rate coefficients.

### Analysis of CSTR Kinetics Data for Liquid-Phase Reaction {#sec-example_20_5_1}

{{< include examples/reb_20_5_1/narrative.qmd >}}

{{< include examples/reb_20_5_1/equations.qmd >}}

```{r}
#| echo: false
#| output: false
d <- read.csv("examples/reb_20_5_1/reb_20_5_1_data.csv")
 # VFR, CAin, CBin, CYin, CZin, CYout
```

The first few data points are shown in @tbl-example_20_1_data. The full data set is available in the file [reb_20_1_data.csv](examples/reb_20_5_1/reb_20_5_1_data.csv).

```{r}
#| echo: false
#| warning: false
#| label: tbl-example_20_1_data
#| tbl-cap: First 8 experimental data points.
kbl(d[1:8,], format = "markdown", align = "cccccc", 
  col.names = c('$\\dot{V}$ (cm^3^ min^-1^)', 'C~A,0~ (M)', 'C~B,0~ (M)',
  'C~Y,0~ (M)', 'C~Z,0~ (M)', 'C~Y,1~ (M)'))
```

---

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

This is a kinetics data analysis problem for a liquid-phase reaction taking place in a steady-state CSTR. In the experiments the volumetric feed rate and the feed concentrations of the four reagents were adjusted and the outlet concentration of reagent Y was measured as the response. I'll begin by summarizing the assignment using appropriate variable symbols for each quantity. I'll use a subscripted "0" to denote values associated with the reactor feed and a subscripted "1" to denote values associated with the reactor outlet. An underline will be used to indicate sets of values and subscripted "CI,l" and "CI,u" will indicate the lower and upper limits of a 95% confidence interval. Finally, since this is a liquid-phase system, the feed and volumetric flow rates will be equal, so I won't use a feed or outlet subscript on the volumetric flow rate.

:::

#### Assignment Summary

**Reactor System:** Steady-state, liquid-phase CSTR

**Reactor Schematic:**

![Schematic representation of the steady-state CSTR used in the experiments.](Graphics/cstr_isothermal_ss_schematic.png){#fig-example_20_5_1_schematic}

**Items of Interest:** $k$, $k_{CI,l}$, $k_{CI,u}$, and an assessment of the accuracy of the rate expression given in equation (2).

**Given and Known Constants:** $V=100 \text{ cm}^3$ and $T=\left( 35 + 273.15 \right) \text{ K}$.

**Adjusted Experimental Inputs:** $\underline{\dot{V}}$, $\underline{C}_{A,0}$, $\underline{C}_{B,0}$, $\underline{C}_{Y,0}$, and $\underline{C}_{Z,0}$.

**Experimental Response:** $\underline{C}_{Y,1}$.

#### Mathematical Formulation of the Analysis

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

I know that I'll need a steady-state CSTR model to analyze the data, so I'll develop that first. Because the temperature in each experiment is constant and known, I can solve the CSTR mole balances independently of any energy balances. Furthermore, I can calculate everything I need using only the mole balances, so for this analysis the reactor design equations will consist of a mole balance on each reagent present in the system. 

The general form of the steady-state CSTR mole balance is given in @eq-cstr_ss_mole_balance, but here there is only one reaction occurring, so the summation over the reactions reduces to a single term and there isn't a need to index the reactions.

$$
0 = \dot{n}_{i,0} - \dot{n}_{i,1} + \nu_i r V
$$

I'll write one mole balance for each of the four reagents. Knowing that they will be solved numerically, I'll write them in the form of residuals expressions (see @sec-apndx_solve_ates).

:::

**Steady-State CSTR Model**

[Design Equations]{.underline}

$$
0 = \epsilon_1 = \dot{n}_{A,0} - \dot{n}_{A,1} - rV \tag{3}
$$

$$
0 = \epsilon_2 = \dot{n}_{B,0} - \dot{n}_{B,1} - rV \tag{4}
$$

$$
0 = \epsilon_3 = \dot{n}_{Y,0} - \dot{n}_{Y,1} + rV \tag{5}
$$

$$
0 = \epsilon_4 = \dot{n}_{Z,0} - \dot{n}_{Z,1} + rV \tag{6}
$$

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

I will solve the CSTR design equatiions for the outlet molar flow rates of A, B, Y, and Z. Then I can use the CSTR model when I need to calculate the model-predicted response. The design equations are ATEs, and to solve them numerically, I'll need to provide a guess for those outlet molar flow rates and a residuals function.

I could just make a single random guess for the ATE unknowns, and it would be used as the guess when solving the CSTR design equations for each of the experiments. However, if the model is provided with the experimental adjusted inputs and the experimental response for each experiment, a separate guess for the ATE unknowns can be calculated for each experiment. That is, the inlet concentrations and the volumetric flow rate can be used to calculate the inlet molar flow rates of the reagents. 

$$
C_i = \frac{\dot{n}_i}{\dot{V}} \qquad \Rightarrow \qquad \dot{n}_i = C_i \dot{V}
$$

The guess for the outlet molar flow rate of Y then can be calculated using the experimental response (i. e. the measured outlet concentration of Y).

$$
\dot{n}_{Y,1} = C_{Y,1}\dot{V}
$$

With those results, the apparent extent of reaction can be calculated, and finally the guesses for the outlet molar flow rates of A, B, and Z can be calculated.

$$
\xi = \dot{n}_{Y,1} - \dot{n}_{Y,0}
$$

$$
\dot{n}_{i,1} = \dot{n}_{i,0} + \nu_i \xi
$$

The other thing I need in order to solve the design equations numerically is a residuals function (see @sec-apndx_solve_ates). I'll need to write the residuals function knowing that it will be given values for the ATE unknowns ($\dot{n}_{A,1}$, $\dot{n}_{B,1}$, $\dot{n}_{Y,1}$, and $\dot{n}_{Z,1}$), and it will have access to the given and known constants in the assignment summary. It must evaluate the residuals in equations (3) through (6) and return their values. Before that can be done, any other unknown quantities appearing in equations (3) through (6) must be calculated.

Examining equations (3) through (6), I can see that there are five additional unknown quantities: the four inlet molar flow rates and the reaction rate. I just generated the equations for calculating the inlet molar flow rates. The rate can be calculated using equation (2), but to do that I need the outlet concentrations of A and B and the rate coefficient. It isn't possible to calculate the rate coefficient using the information provided to the residuals function, so the rate coefficient will need to be provided. The outlet concentrations must be used in the rate expression, and to calculate them, I can again use the definition of concentration, @eq-concentration_open.

:::

[Required Input:]{.underline} $\dot{V}$, $C_{A,0}$, $C_{B,0}$, $C_{Y,0}$, $C_{Z,0}$, $C_{Y,1}$, and $k$.

[Guesses for the Design Equations Unknowns]{.underline}

Given the adjusted experimental inputs and the experimental response from an experiment, a guess for the ATE unknowns, $\dot{n}_{A,1}$, $\dot{n}_{B,1}$, $\dot{n}_{Y,1}$, and $\dot{n}_{Z,1}$, can be generated using the following sequence of calculations.

$$
\dot{n}_{A,0} = C_{A,0}\dot{V} \tag{7}
$$

$$
\dot{n}_{B,0} = C_{B,0}\dot{V} \tag{8}
$$

$$
\dot{n}_{Y,0} = C_{Y,0}\dot{V} \tag{9}
$$

$$
\dot{n}_{Z,0} = C_{Z,0}\dot{V} \tag{10}
$$

$$
\dot{n}_{Y,1} = C_{Y,1}\dot{V} \tag{11}
$$

$$
\xi = \dot{n}_{Y,1} - \dot{n}_{Y,0} \tag{12}
$$

$$
\dot{n}_{A,1} = \dot{n}_{A,0} - \xi \tag{13}
$$

$$
\dot{n}_{B,1} = \dot{n}_{B,0} - \xi \tag{14}
$$

$$
\dot{n}_{Z,1} = \dot{n}_{Z,0} + \xi \tag{15}
$$

[Residuals Function]{.underline}

Given the values of the ATE unknowns ($\dot{n}_{A,1}$, $\dot{n}_{B,1}$, $\dot{n}_{Y,1}$, and $\dot{n}_{Z,1}$), the required input above, and the given and known constants from the assignment summary, the remaining unknown quantities appearing in the residual expressions can be computed using the following sequence of calculations. Then the residuals can be evaluated using equations (3) through (6).

$$
\dot{n}_{A,0} = C_{A,0}\dot{V} \tag{7}
$$

$$
\dot{n}_{B,0} = C_{B,0}\dot{V} \tag{8}
$$

$$
\dot{n}_{Y,0} = C_{Y,0}\dot{V} \tag{9}
$$

$$
\dot{n}_{Z,0} = C_{Z,0}\dot{V} \tag{10}
$$

$$
C_{A,1} = \frac{\dot{n}_{A,1}}{\dot{V}} \tag{16}
$$

$$
C_{B,1} = \frac{\dot{n}_{B,1}}{\dot{V}} \tag{17}
$$

$$
r = kC_{A,1}C_{B,1} \tag{2}
$$

[Solving the Steady-State CSTR Design equations]{.underline}

The reactor design equations can be solved by calling an ATE solver, providing it with the name of the residuals function and the guess for the ATE unknowns. Assuming the solver was successful, it will return one set of values of the ATE unknowns that solve the design equations (there could be other solutions).

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

I need to find the best value for $k$ and assess the accuracy of resulting rate expression. I will use a numerical fitting function to do that. I will need to provide it with a guess for $k$, the set of adjusted experimental inputs, the corresponding set of experimental responses and the name of a predicted responses function that I will need to write.

The predicted responses function I write must accept a value for $k$ and the set of adjusted experimental input as arguments. Using that information and the given and known constants from the assignment summary, it must calculate and return a set of model-predicted responses for the experiments. I can use the steady-state CSTR model above to calculate the outlet molar flow rates, $\dot{n}_{A,1}$, $\dot{n}_{B,1}$, $\dot{n}_{Y,1}$, and $\dot{n}_{Z,1}$, for each experiment. I can then use the defining equation for concentration to calculate $C_{Y,1}$, which is the model-predicted response. So all I need to do in the predicted responses function is to loop through the experiments solving the CSTR model equations for the outlet molar flow rates and then calculating the concentration of Y.

Assuming the numerical fitting function is successful, it will return the best estimate for $k$, its 95% confidence interval and the coefficient of determination. I need to assess accuracy, so I will make parity and residuals plots, as well. To do so I will calculate the model-predicted responses using the best estimate for $k$. Then I will calculate the difference between the experimental response and the model-predicted response, i. t. the residual for each experiment. Plotting the experimental responses *vs.* the model-predicted responses will yield the parity plot. Plotting the residuals *vs.* each adjusted experimental input will generate the residuals plots.

Indicators of accuracy are that $R^2$ is close to 1, the upper and lower limits of the 95% confidence interval are close to the estimated value of $k$, the points on the parity plot lie close to $C_{Y,1} = C_{Y,1,model}$ diagonal, and random scatter of the residuals about zero.

:::

**Parameter Estimation**

[Predicted Responses Function]{.underline}

Given a value for $k$ and the set of adjusted experimental inputs, the reactor model above can be used to calculate corresponding sets of values of $\dot{n}_{A,1}$, $\dot{n}_{B,1}$, $\dot{n}_{Y,1}$, and $\dot{n}_{Z,1}$. The model predicted response can then be calculated as using equation (18). This can be repeated for each experiment to generate a set of model-predicted responses.

$$
C_{Y,1} = \frac{\dot{n}_{Y,1}}{\dot{V}} \tag{18}
$$

[Parameter Estimates and Statistics]{.underline}

A numerical fitting function can be used to estimate $k$. A guess for $k$, the set of adjusted experimental inputs, the set of experimental responses, and the name of the predicted responses function above will need to be provided to it. Assuming it is successful, it will return the best estimate for $k$, its 95% confidence interval, and the coefficient of determination, $R^2$.

[Assessment Graphs]{.underline}

After estimating $k$, the set of model predicted responses for the data set being analyzed, $\underline{C}_{Y,model}$, can be calculated using the predicted responses function above. A corresponding set of residuals, $\underline{\epsilon}$, can be calculated using equation (19).

$$
\epsilon = C_{Y,1} - C_{Y,1,model} \tag{19}
$$

Plotting $\underline{C}_{Y,1}$ *vs.* $\underline{C}_{Y,1,model}$ as points and the $C_{Y,1} - C_{Y,1,model}$ diagonal as a line yields the parity plot. Plotting $\underline{\epsilon}$ *vs.* each of the adjucted experimental inputs, $\underline{\dot{V}}$, $\underline{C}_{A,0}$, $\underline{C}_{B,0}$, $\underline{C}_{Y,0}$, and $\underline{C}_{Z,0}$, yields the residuals plots.

[Assessment of Model Accuracy]{.underline}

The following are indicators that the model is accurate.

* $R^2$ is close to 1.0.
* $k_{CI,l}$ and $k_{CI,u}$ are close in value to the estimated value of $k$.
* The plotted data in the parity plot fall close to the $C_{Y,1} - C_{Y,1,model}$ diagonal.
* The plotted residuals in each residuals plot scatter randomly about zero with no apparent trends in the deviations.

**Performing the Analysis**

The complete analysis can be performed by reading the adjusted experimental inputs and the experimental responses from the file, [reb_20_1_data.csv](examples/reb_20_5_1/reb_20_5_1_data.csv), estimating $k$, and assessing the accuracy of the predicted responses function as described above.

#### Numerical Implementation of the Calculations

The computer code that performs the calculations could be structured in a number of ways. Here, using the coding structure suggested in @sec-apndx_notation, the numerical implementation begins with the creation of a single computer function for this example, and doing the following within that function:

1. Make the given and known constants available within all functions.
2. Define variables to make the current values of $k$, $\dot{V}$, $C_{A,0}$, $C_{B,0}$, $C_{Y,0}$, $C_{Z,0}$, and $C_{Y,1}$ available to all functions.
3. Write a residuals function as described in the mathematical formulation; it should
    a. receive $\dot{n}_{A,1}$, $\dot{n}_{B,1}$, $\dot{n}_{Y,1}$, and $\dot{n}_{Z,1}$ as arguments and
    b. calculate and return $\epsilon_1$, $\epsilon_2$, $\epsilon_3$, and $\epsilon_4$.
4. Write a steady-state CSTR model function as described in the mathematical formulation; it should calculate and return $\dot{n}_{A,1}$, $\dot{n}_{B,1}$, $\dot{n}_{Y,1}$, and $\dot{n}_{Z,1}$ for the current experiment.
5. Write a predicted responses function as described in the mathematical formulation; it should
    a. receive $\underline{\dot{V}}$, $\underline{C}_{A,0}$, $\underline{C}_{B,0}$, $\underline{C}_{Y,0}$, $\underline{C}_{Z,0}$, and $k$ as arguments,
    b. make $k$, $\dot{V}$, $C_{A,0}$, $C_{B,0}$, $C_{Y,0}$, $C_{Z,0}$, and $C_{Y,1}$ available to all functions, and
    c. calculate and return $\underline{C}_{Y,1,model}$.
6. Write a calculations function that
    a. reads $\underline{\dot{V}}$, $\underline{C}_{A,0}$, $\underline{C}_{B,0}$, $\underline{C}_{Y,0}$, $\underline{C}_{Z,0}$, and $\underline{C}_{Y,1}$ from the data file.
    b. defines an initial guess for $k$.
    c. calls a numerical fitting function as described in the mathematical formulation, passing that guess, $\underline{\dot{V}}$, $\underline{C}_{A,0}$, $\underline{C}_{B,0}$, $\underline{C}_{Y,0}$, $\underline{C}_{Z,0}$, $\underline{C}_{Y,1}$, and the name of the predicted responses function from step 5 as arguments and receiving $k$, $k_{CI,l}$, $k_{CI,u}$, and $R^2$ as return values.
    d. generates a parity plot and the residuals plots, and
    e. displays and/or saves the results.
7. Call the calculations function from step 6.

#### Results and Discussion

```{r}
#| echo: false
#| output: false
df <- read.csv("examples/reb_20_5_1/reb_20_5_1_results.csv")
df <- fmt_tibble_col(df, 2, 3, 3, 2)
a <- c('k','R^2^')
b1 <- paste0(df$value[1],' ',df$units[1],', 95% CI [',df$value[2],', ',df$value[3],']')
b <- c(b1,df$value[4])
 # item, value, units
d <- data.frame(a,b)
```

The calculations were performed as described, except that the base-10 log of $k$ was estimated (see [Example -@sec-example_19_5_1]), and the results are shown in @tbl-example_20_5_1_results.

```{r}
#| echo: false
#| warning: false
#| label: tbl-example_20_5_1_results
#| tbl-cap: Parameter estimation results
kbl(d, format = "markdown", align = "cc", col.names = NULL)
```

The estimated rate coefficient was used to calculate the model-predicted response for each experiment, and that was used to calculate the residual for each experiment. The results were then used to generate the parity plot and residuals plots shown in @fig-example_20_5_1_plots.

::: {#fig-example_20_5_1_plots layout-ncol=2}

![](examples/reb_20_5_1/reb_20_5_1_parity.png)

![](examples/reb_20_5_1/reb_20_5_1_Vdot_residual.png)

![](examples/reb_20_5_1/reb_20_5_1_CA0_residual.png)

![](examples/reb_20_5_1/reb_20_5_1_CB0_residual.png)

![](examples/reb_20_5_1/reb_20_5_1_CY0_residual.png)

![](examples/reb_20_5_1/reb_20_5_1_CZ0_residual.png)

Parity and Residuals Plots.
:::

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

The 95% confidence interval for $k$, `r df$value[2]` to `r df$value[3]` `r df$units[2]`, is approximately plus or minus 7% of its estimated value, `r df$value[1]` `r  df$units[1]`. There is some scatter apparent in the parity plot, and the coefficient of determination is `r  df$value[4]`. These factors suggest that the rate expression is reasonably accurate. The residuals plots for $\dot{V}$ and $C_Y$ show random deviations of the residuals about zero, too. However, in the residuals plots for $C_A$ and $C_B$ the residuals at low concentration do not scatter equally about zero. The residuals for $C_Z$ show a definite trend, decreasing steadily as $C_Z$ increases. This suggests that the reaction rate may have some functional dependence on the concentration of Z that is not captured in the rate expression.

:::

**Assessment**

The rate expression is reasonably accurate, but there are indications that the rate expression may not fully capture the dependence of the rate on the concentration of reagent Z. Rate expressions that include a functional dependence on the concentration of Z should be postulated and assessed to determine whether they can represent the experimental results more accurately.

:::{.callout-note collapse="false"}
## Note

In this example, the accuracy of the rate expression is reasonable, but the indication that the rate depends on the concentration of Z is a concern. In a real-world study, there would be blocks of data at other temperatures. If the same trends were observed for each data block, the recommendation to try different rate expressions that include functional dependence on Z would be supported. If none of the other temperature blocks showed these trends, it might be recommended that the rate expression was reasonably acceptable.

:::

::: {.callout-note appearance="simple"}

## [SC]{style="color:blue"}o[RE]{style="color:red"} Connection

Videos showing how to complete this assignment using either Matlab or Python, along with the Matlab and Python code, are available in [SCoRE](http://buffalobadger.github.io/SCoRE/class_29.html)

:::


### Analysis of Data for a Gas-Phase Reaction with Change of Total Moles {#sec-example_20_5_2}

{{< include ../RE_Basics_Examples/reb_20_5_2/narrative.qmd >}}

{{< include ../RE_Basics_Examples/reb_20_5_2/equations.qmd >}}

```{r}
#| echo: false
#| output: false
df <- read.csv("examples/reb_20_5_2/reb_20_5_2_data.csv")
 # tau, yAin, CZout
```

The first few data points are shown in @tbl-example_20_5_2_data. The full data set is available in the file [reb_20_5_2_data.csv](examples/reb_20_5_2/reb_20_5_2_data.csv).

```{r}
#| echo: false
#| warning: false
#| label: tbl-example_20_5_2_data
#| tbl-cap: First 6 experimental data points.
kbl(df[1:6,], format = "markdown", align = "ccc", 
  col.names = c('$\\tau$ (s)', 'y~A,in~', 'C~Z,out~ (mmol L^-1^)'))
```

---

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

This problem describes reactor experiments, provides the data from the experiments, and asks me to assess the accuracy of a rate expression, so it is a kinetics data analysis problem. Knowing that I will be creating a response function, I'll start by listing the reactor type, constants given in the problem statement, the adjusted experimental inputs, the experimental response, and the rate expression parameters I need to estimate.

:::

**Reactor**: CSTR

**Given**: $P = 3 \text{ atm}$ and $T = 450 + 273.15 \text{ K}$.

**Adjusted Inputs**: $\underline{\tau}$ and $\underline{y}_{A,in}$.

**Experimental Response**: $\underline{C}_Z$.

**Rate Expression Parameters**:  $k$, $\alpha_A$, and $\alpha_B$.

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

I need to generate a response function that predicts the responses using the rate expression. To start, I need a model for the reactor. Referring back to @sec-3_design_eqns, I know that when the reactor operates at a known temperature, the mole balances can be solved independently from the other design equations, so all I need here is a set of mole balances for this reactor. The mole balance design equation for a steady-state CSTR with only one reaction taking place is given in @eq-cstr_mole_bal_one_reaction.

$$
0 = \dot{n}_{i,in} - \dot{n}_i + \nu_i r V
$$

The stoichiometric coefficients of A, B, and Z are -1, -1 and 1, respectively. The problem also states that the feed contained only reagents A and B, so the inlet molar flow rate of reagent Z is equal to zero. Substitution of those values leads to equations (3) through (5).

:::

**Reactor Model**

Mole balances on A, B, and Z are shown in equations (3) through (5).

$$
0 = \dot{n}_{A,in} - \dot{n}_A - rV \tag{3}
$$

$$
0 = \dot{n}_{B,in} - \dot{n}_B - rV \tag{4}
$$

$$
0 = \cancelto{0}{\dot{n}_{Z,in}} - \dot{n}_Z + rV \tag{5}
$$

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

Within the response function I will need to numerically solve equations (3) through (5) for the outlet molar flow rates of A, B, and Z. To do that, I must provide equations for calculating every other quantity in the equations from those unknowns and known constants. So I'll go through each of the mole balances, and any equations that will be substituted into them, and write equations for the quantities other than the unknowns and known constants.

At first, looking at the mole balances, it appears that I'm not given sufficient information, but upon careful reading of the problem statement I see that all of the quantities provided are *intensive* quantities. When that is true, I can choose the value for one *extensive* quantity and use it as the basis for my calculations. I'm going to choose a reactor volume of 1 L as the basis for my calculations.

The mole balance design equations also contain the inlet molar flow rates of A and B. The problem statement does not provide any flow rates, but having chosen a volume as a basis, I can use the definition of space time, @eq-space_time, (which is one of the adjusted inputs) to calculate the inlet volumetric flow rate. Then I can use the ideal gas law to calculate the total inlet molar flow rate and the inlet mole fractions of A and B to calculate their inlet molar flow rates.

When I substitute the rate expression into the mole balances, that will introduce the partial pressures of A and B. Equations for the partial pressures can be written using the unknowns and the defining equation for partial pressure. The rate coefficient and the reaction orders will be passed to the response function as arguments, so I don't need equations for them.

:::

**Ancillary Equations**

$$
V = 1 \text{ L }\left( \text{Basis} \right) \tag{6}
$$

$$
\dot{V}_{in} = V/\tau \tag{7}
$$

$$
\dot{n}_{in,\text{total}} = \frac{P\dot{V}_{in}}{RT} \tag{8}
$$

$$
\dot{n}_{A,in} = y_{A,in}\dot{n}_{in,\text{total}} \tag{9}
$$

$$
\dot{n}_{B,in} = \left(1 - y_{A,in}\right)\dot{n}_{in,\text{total}} \tag{10}
$$

$$
P_A = y_A P = \frac{\dot{n}_A}{\dot{n}_A + \dot{n}_B + \dot{n}_Z}P \tag{11}
$$

$$
P_B = y_B P = \frac{\dot{n}_B}{\dot{n}_A + \dot{n}_B + \dot{n}_Z}P \tag{12}
$$

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

At this point the mole balances can be solved numerically for the outlet molar flow rates of A, B, and Z. This will be done within the response function, and then the results must be used to calculate the response predicted by the model. In this problem the response is the concentration of Z in the stream leaving the reactor. That can be calculated using the ideal gas law, @eq-conc_cstr_kinetics.

:::

**Response Calculation**

$$
C_Z = \frac{\dot{n}_Z}{\dot{V}} = \frac{\dot{n}_ZP}{\dot{n}_{\text{total}}RT} = \frac{\dot{n}_ZP}{\left(\dot{n}_A + \dot{n}_B + \dot{n}_Z\right)RT} \tag{13}
$$

**Response Function**

The response function is created with the following structure.

* The adjusted inputs, $\underline{\tau}$ and $\underline{y}_{A,in}$, and the rate expression parameters, $k$, $\alpha_A$, and $\alpha_B$, are passed to it as arguments.
* Variables are defined and assigned the values of all known and given quantities, $P = 3 \text{ atm}$ and $T = 450 + 273.15 \text{ K}$, and the basis, equation (6).
* A function is defined that evaluates the reactor equation residuals (the right-hand sides of equations (3) through (5)), given values of the unknowns, $\dot{n}_A$, $\dot{n}_B$, and $\dot{n}_Z$. It
    * Calculates the inlet volumetric and molar flow rates, equations (7) and (8).
    * Calculates the inlet molar flow rates of A and B, equations (9) and (10).
    * Calculates the partial pressures of A and B, equations (11) and (12).
    * Calculates $r$ using equation (2).
    * Evaluates and returns the residuals, equations (3) through (5).
* For each experiment, the response function
    * Solves the reactor design equations numerically to find $\dot{n}_A$, $\dot{n}_B$, and $\dot{n}_Z$.
    * Calculates $C_Z$ using equation (13).
* The predicted values of $C_Z$ for all of the experiments are returned.

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

Having created the response function, I can now use it to estimate the rate expression parameters, $k$, $\alpha_A$, and $\alpha_B$, at the experimental temperature, 450 °C. To do so I will use parameter estimation software of my choosing. I will write a simple program that passes the adjusted inputs, the measured responses, and a guess for the rate expression parameters to that parameter estimation software. It will return the best estimate for $k$, $\alpha_A$, and $\alpha_B$, some measure of the uncertainty in $k$, $\alpha_A$, and $\alpha_B$, and the coefficient of determination, $R^2$.

Using the resulting values of $k$, $\alpha_A$, and $\alpha_B$, I can calculate the model-predicted responses for all of the experiments using the response function. Then, knowing the model-predicted responses I can calculate the residual (difference between the measured response and the model-predicted response) for each eperiment. Finally, as described in @sec-6_kin_data_gen, I can create a parity plot and residuals plots.

:::

**Calculations**

1. Pass the response function, the adjusted inputs, the experimental responses, and a guess for the rate expression parameters to parameter estimation software to find $k$, $\alpha_A$, and $\alpha_B$, the uncertainty in $k$, $\alpha_A$, and $\alpha_B$, and the coefficient of determination, $R^2$.
2. Use the resulting values of $k$, $\alpha_A$, and $\alpha_B$ to calculate the model-predicted response, $C_{Z,\text{model}}$, for every experiment.
3. Create a parity plot ($C_{Z,\text{model}}$ *vs*. $C_{Z,\text{expt}}$) and parity plots ($C_{Z,\text{model}} - C_{Z,\text{expt}}$ *vs*. $\underline{\tau}$ and *vs*. $\underline{y}_{A,in}$.

**Results**

```{r}
#| echo: false
#| output: false
df <- read.csv("examples/reb_20_5_2/reb_20_5_2_results.csv")
df <- fmt_tibble_col(df, 2, 3, 2, 2)
a <- c('k','$\\alpha_A$','$\\alpha_B$','R^2^')
b1 <- paste0(df$value[1],' ',df$units[1],', 95% CI [',df$value[2],', ',df$value[3],']')
b2 <- paste0(df$value[4],' ',df$units[4],', 95% CI [',df$value[5],', ',df$value[6],']')
b3 <- paste0(df$value[7],' ',df$units[7],', 95% CI [',df$value[8],', ',df$value[9],']')
b <- c(b1,b2,b3,df$value[10])
 # item, value, units
d <- data.frame(a,b)
```

The reactor model described above was fit to the experimental data presented in @tbl-example_20_5_2_data using parameter estimation software. The results are presented in @tbl-example_20_5_2_parameters. A parity plot is shown in @fig-example_20_5_2_parity and residuals plots are shown in @fig-example_20_5_2_residuals_plots.

```{r}
#| echo: false
#| warning: false
#| label: tbl-example_20_5_2_parameters
#| tbl-cap: Parameter estimation results
kbl(d, format = "markdown", align = "cc", col.names = NULL)
```

![Parity plot.](examples/reb_20_5_2/reb_20_5_2_parity.png){#fig-example_20_5_2_parity}

::: {#fig-example_20_5_2_residuals_plots layout-ncol=2}

![](examples/reb_20_5_2/reb_20_5_2_tau_residual.png)

![](examples/reb_20_5_2/reb_20_5_2_yA0_residual.png)

Residuals Plots.
:::

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

The deviations of the data points from the line in the parity plot are small, the deviations of the residuals about zero are random with no apparent trends, the coefficient of determination is close to 1, and the upper and lower limits of the 95% confidence intervals for all three parameters are close to the estimated parameter value. All of these are indicators of an accurate model.

:::

**Assessment**

When used with the rate expression parameters shown in @tbl-example_20_5_2_parameters, the accuracy of the proposed rate expression in describing the concentration dependence of the rate at 450 °C is acceptable.

::: {.callout-note appearance="simple"}

## [SC]{style="color:blue"}o[RE]{style="color:red"} Connection

Videos showing how to complete this assignment using either Matlab or Python, along with the Matlab and Python code, are available in [SCoRE](http://buffalobadger.github.io/SCoRE/class_29.html)

:::

### Analysis of Data for a Reversible Reaction {#sec-example_20_5_3}

{{< include ../RE_Basics_Examples/reb_20_5_3/narrative.qmd >}}

{{< include ../RE_Basics_Examples/reb_20_5_3/equations.qmd >}}

```{r}
#| echo: false
#| output: false
df <- read.csv("examples/reb_20_5_3/reb_20_5_3_data.csv")
 # VFR, CAin, CYin, CZin, CA
```

The first few data points are shown in @tbl-example_20_5_3_data. The full data set is available in the file [reb_20_5_3_data.csv](examples/reb_20_5_3/reb_20_5_3_data.csv).

```{r}
#| echo: false
#| warning: false
#| label: tbl-example_20_5_3_data
#| tbl-cap: First 6 experimental data points.
kbl(df[1:6,], format = "markdown", align = "ccccc", 
  col.names = c('$\\dot{V}$ (gal min^-1^)', 'C~A,in~ (lbmol gal^-1^)', 
  'C~Y,in~ (lbmol gal^-1^)','C~Z,in~ (lbmol gal^-1^)','C~A,out~ (lbmol gal^-1^)'))
```

---

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

This is a kinetics data analysis assignment, and to solve it I will need to create a response function. I will begin by summarizing the information provided in the problem statement.

:::

**Reactor**: CSTR

**Given**: $V = 3 \text{ gal}$.

**Adjusted Inputs**: $\underline{\dot{V}}$, $\underline{C}_{A,in}$, $\underline{C}_{Y,in}$, and $\underline{C}_{Z,in}$.

**Experimental Response**: $\underline{C}_{A,out}$.

**Rate Expression Parameters**:  $k_f$ and $k_r$.

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

I need to create a response function that solves the reactor design equations and predicts the response for each data point. Since the CSTR operated at a known temperature, I only need mole balances to model it. There are 3 reagents in this system, so I'll write @eq-cstr_mole_bal_one_reaction for each of them.

$$
0 = \dot{n}_{i,in} - \dot{n}_i + \nu_i r V
$$

The stoichiometric coefficients of A, Y, and Z, are -1, 1, and 1, respectively, leading to equations (3) through (5).

:::

**Reactor Model**

Mole balances on A, Y, and Z are shown in equations (3) through (5).

$$
0 = \dot{n}_{A,in} - \dot{n}_A - rV \tag{3}
$$

$$
0 = \dot{n}_{Y,in} - \dot{n}_Y + rV \tag{4}
$$

$$
0 = \dot{n}_{Z,in} - \dot{n}_Z + rV \tag{5}
$$

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

Within the response function I need to solve equations (3) through (5) for $\dot{n}_A$, $\dot{n}_Y$, and $\dot{n}_Z$. The adjusted inputs and the rate expression parameters will be provided to the response function. To solve the reactor design equations, I need to express every other quantity appearing in or substituted into equations (3) through (5) in terms of $\dot{n}_A$, $\dot{n}_Y$, $\dot{n}_Z$ and known constants. Looking at equations (3) through (5) I can see that I will need expressions for the inlet molar flow rates, $\dot{n}_{A,in}$, $\dot{n}_{Y,in}$, and $\dot{n}_{Z,in}$. I know the volumetric flow rate and the inlet concentrations of the reagents, so those expressions are straightforward.

When the rate expression is substituted into the mole balances it introduces the concentrations of the reagents. This is a steady-state, liquid phase system, so the volumetric flow rate is constant. Knowing that, @eq-concentration_open can be used to express the concentrations in terms of the unknowns in terms of their molar flow rates.

$$
C_i = \frac{\dot n_i}{\dot V}
$$

:::

**Ancillary Equations**

$$
\dot{n}_{A,in} = C_{A,in}\dot{V} \tag{6}
$$

$$
\dot{n}_{Y,in} = C_{Y,in}\dot{V} \tag{7}
$$

$$
\dot{n}_{Z,in} = C_{Z,in}\dot{V} \tag{8}
$$

$$
C_A = \frac{\dot{n}_A}{\dot{V}} \tag{9}
$$

$$
C_Y = \frac{\dot{n}_Y}{\dot{V}} \tag{10}
$$

$$
C_Z = \frac{\dot{n}_Z}{\dot{V}} \tag{11}
$$

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

Once the reactor design equations have been solved, the resulting values of $\dot{n}_A$, $\dot{n}_Y$, and $\dot{n}_Z$ must be used to predict the experimental response. In this study, the response was the outlet concentration of A, and that can be calculated using equation (9).

:::

**Response Function**

The response function is created with the following structure.

* The adjusted inputs, $\underline{\dot{V}}$, $\underline{C}_{A,in}$, $\underline{C}_{Y,in}$, and $\underline{C}_{Z,in}$, and the rate expression parameters, $k_f$ and $k_r$, are passed to it as arguments.
* A variable is defined and assigned the value of the known and given quantity, $V = 3 \text{ gal}$.
* A function is defined that evaluates the reactor equation residuals (the right-hand sides of equations (3) through (5)), given values of the unknowns, $\dot{n}_A$, $\dot{n}_Y$, and $\dot{n}_Z$. It
    * Calculates the inlet molar flow rates of A, Y, and Z, equations (6), (7), and (8).
    * Calculates the concentrations of A, Y, and Z, equations (9), (10), and (11).
    * Calculates $r$ using equation (2).
    * Evaluates and returns the residuals, equations (3) through (5).
* For each experiment, the response function
    * Solves the reactor design equations numerically to find $\dot{n}_A$, $\dot{n}_Y$, and $\dot{n}_Z$.
    * Calculates $C_A$ using equation (9).
* The predicted values of $C_A$ for all of the experiments are returned.

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

Having created the response function, I can now use it to estimate the rate expression parameters, $k_f$ and $k_r$, at the experimental temperature. To do so I will use parameter estimation software of my choosing. I will write a simple program that passes the adjusted inputs, the measured responses, and a guess for the rate expression parameters to that parameter estimation software. It will return the best estimates for $k_f$ and $k_r$, some measure of the uncertainty in $k_f$ and $k_r$, and the coefficient of determination, $R^2$.

Using the resulting values of $k_f$ and $k_r$, I can calculate the model-predicted responses for all of the experiments using the response function. Then, knowing the model-predicted responses I can calculate the residual (difference between the measured response and the model-predicted response) for each eperiment. Finally, as described in @sec-6_kin_data_gen, I can create a parity plot and residuals plots.

:::

**Calculations**

1. Pass the response function, the adjusted inputs, the experimental responses, and a guess for the rate expression parameters to parameter estimation software to find $k_f$ and $k_r$, the uncertainty in $k_f$ and $k_r$, and the coefficient of determination, $R^2$.
2. Use the resulting values of $k_f$ and $k_r$ to calculate the model-predicted response, $C_{A,\text{model}}$, for every experiment.
3. Create a parity plot ($C_{A,\text{model}}$ *vs*. $C_{ZA,\text{expt}}$) and residuals plots ($C_{A,\text{model}} - C_{A,\text{expt}}$ *vs*. $\dot{V}$, *vs*. $C_{A,in}$, *vs*. $C_{Y,in}$, and *vs*. $C_{Z,in}$.

**Results**

```{r}
#| echo: false
#| output: false
df <- read.csv("examples/reb_20_5_3/reb_20_5_3_results.csv")
df <- fmt_tibble_col(df, 2, 3, 2, 2)
a <- c('k~f~','k~r~','R^2^')
b1 <- paste0(df$value[1],' ',df$units[1],', 95% CI [',df$value[2],', ',df$value[3],']')
b2 <- paste0(df$value[4],' ',df$units[4],', 95% CI [',df$value[5],', ',df$value[6],']')
b <- c(b1,b2,df$value[7])
 # item, value, units
d <- data.frame(a,b)
```

To estimate the kinetics parameters, the response function described above was passed to parameter estimation software along with the adjusted experimental inputs, the experimental responses and a guess for the kinetics parameters. The results returned by that software are shown in @tbl-example_20_5_3_results.

```{r}
#| echo: false
#| warning: false
#| label: tbl-example_20_5_3_results
#| tbl-cap: Parameter estimation results
kbl(d, format = "markdown", align = "cc", col.names = NULL)
```

The results from the parameter estimation were then used to create the parity plot shown in @fig-example_20_5_3_parity and residuals plots shown in @fig-example_20_5_3_residuals_plots as described in @sec-6_kin_data_gen.

![Parity plot.](examples/reb_20_5_3/reb_20_5_3_parity.png){#fig-example_20_5_3_parity}

::: {#fig-example_20_5_3_residuals_plots layout-ncol=2}

![](examples/reb_20_5_3/reb_20_5_3_Vdot_residual.png)

![](examples/reb_20_5_3/reb_20_5_3_CA0_residual.png)

![](examples/reb_20_5_3/reb_20_5_3_CY0_residual.png)

![](examples/reb_20_5_3/reb_20_5_3_CZ0_residual.png)

Parity and Residuals Plots.
:::

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

The confidence intervals for $k_f$ and $k_r$ form a narrow range of values about the estimates and the coefficient of determination is close to 1.0. Both of these results suggest that the model is accurate. In the parity plot the experimental data all lie close to the line representing the model, and in the residuals plots, the deviations of the experimental residuals from zero appear to be random with no apparent trends. These graphical results also suggest that the model is acceptably accurate.

:::

**Assessment**

When the rate coefficients in @tbl-example_20_5_3_results are used in the rate expression, equation (2), it provides an acceptably accurate representation of the experimental results.

::: {.callout-note appearance="simple"}

## [SC]{style="color:blue"}o[RE]{style="color:red"} Connection

Videos showing how to complete this assignment using either Matlab or Python, along with the Matlab and Python code, are available in [SCoRE](http://buffalobadger.github.io/SCoRE/class_29.html)

:::

## Symbols Used in @sec-6_cstr_data_analysis

| Symbol | Meaning |
|:-------|:--------|
| $i$ | index denoting a reagent. |
| $k$ | Rate coefficient. |
| $f\left(\right)$ | A mathematical function of the variables within the parentheses. |
| $\dot{n}_i$ | Molar flow rate of reagent $i$, an additional subscripted "in" denotes the flow into the reactor. |
| $r$ | Net rate of reaction per unit fluid volume. |
| $x$ | Independent variable in a linear model. |
| $y$ | Dependent variable in a linear model. |
| $y_i$ | Mole fraction of reagent $i$. |
| $C_i$ | Concentration of reagent $i$. |
| $P$ | Pressure. |
| $P_i$ | Partial pressure of reagent $i$. |
| $R$ | Ideal gas constant. |
| $T$ | Temperature. |
| $V$ | Volume of fluid within the reactor. |
| $\dot{V}$ | Volumetric flow rate. |
| $\nu_i$ | Stoichiometric coefficient of reagent $i$. |


: {tbl-colwidths="[20,80]"}
