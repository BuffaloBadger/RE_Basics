# BSTR Analysis {#sec-5_bstr_analysis}

This chapter examines reaction engineering of single, isolated batch stirred-tank reactors (BSTRs). It examines properties, advantages and disadvantages of BSTRs, common situations where BSTRs are used, the operation of BSTRs, and qualitative and quantitative analysis of BSTRs. It concludes with examples of BSTR reaction engineering tasks involving BSTRs.

## BSTR Characteristics

The two most important characteristics of a BSTR are (a) that the reacting fluid within a BSTR is perfectly mixed, and (b) there is no flow of reagents into or out of the reactor while it is operating. As the name batch *stirred tank* reactor suggests, the most common physical form of a BSTR for chemical processing is a stirred tank. As indicated in the schematic representations in @fig-bstr_heat_exchange_schematics, they are typically cylindrical in shape, completely containing the reacting fluid within rigid walls. When processing liquids, an agitator, immersed in the reacting fluid is used to effect perfect mixing. There may be some space at the top of the reactor that does not contain reacting fluid. This is referred to as headspace; it is indicated by gray shading in @fig-bstr_heat_exchange_schematics.

::: {#fig-bstr_heat_exchange_schematics layout-ncol=3}

![a](Graphics/Batch_with_jacket.png){width="40%"}

![b](Graphics/Batch_with_Coil.png){width="40%"}

![c](Graphics/Batch_with_External_Heat_Exchange.png){width="55%"}

Sechematic representations of three batch stirred tank reactors, wherein heat is exchanged with an external fluid through the walls of (a) a jacket, (b) a submerged coil, and (c) an external heat exchanger that separates the reacting fluid from the heat exchange fluid.
:::

If it is necessary to heat or cool the reactor, a heat exchange fluid may flow in and out of the the reactor during operation, but the heat exchange fluid is physically separated from the reacting fluid. @fig-bstr_heat_exchange_schematics depicts three common configurations for exchange of heat with an external fluid. One (a in the figure) is referred to as a shell or jacket. It is a compartment that surrounds the reacting fluid and has an external heat exchange fluid flowing through it. Another (b in the figure) consists of a coil of tubing that is immersed in the reacting fluid. The heat exchange fluid flows within the coil. The third (c in the figure) is an external heat exchanger. With the latter configuration it is important that the reacting fluid circulates through the heat exchanger rapidly so that the assumption of perfect mixing of the reacting fluid is satisfied. In all three configurations, it is possible that the exchange fluid temperture is not uniform, but in *Reaction Engineering Basics* it is always assumed that the heat exchange fluid (within the shell, coil or external heat exchanger) is perfectly mixed.

Stirred tanks are not often used for the processing of gases or when a solid catalyst is being used because stirring gases or small solids praticles is difficult. However, other configurations can be modeled as BSTRs as long as the critical assumptions are met (perfect mixing and no flow in or out of the reactor). @sec-4_bstr_data_analysis describes a few laboratory BSTRs that are not stirred tanks. Similarly, any reactor in a chemicla processing facility that conforms to the assumptions used when deriving the BSTR design equations can be modeled as a BSTR. Heat can be added or removed from a reactor in ways that do not involve an exchange fluid. For example, an electric resistance heating element might be used to add heat. *Reaction Engineering Basics* only considers heat transfer to an external heat transfer fluid.

There are **advantages of using a BSTR**, as opposed to the other types of ideal reactors, particularly the flow reactors (CSTRs and PFRs). BSTRs offer flexibility both in terms of the reactions being run and in the details of operating the process. In a situation where the demand for products is too small to warrant continuous production, a batch reactor might be used to make one product for a few weeks, and then be used to make a different product for the next few weeks. This kind of flexibility avoids having the reactor sit idle for extended periods of time. Similarly, if the production of a product involves heating to and holding two or more different temperatures during processing, it may be easier to produce it in a batch reactor than to set up a chain of continuous reactors operating at the necessary temperatures. In contrast to PFRs, the heat transfer area per volume of reacting fluid can be varied over a wide range of values at the time of design. Even after the reactor has been constructed, the length of a submerged coil or the area of an external heat exchanger could be changed if additional heat transfer capability is needed.

There are also **disadvantages or using BSTRs**. As described below, the operation of a BSTR includes periods of time during which no reaction is taking place. Compared to reactors like CSTRs and PFRs that run continuously, this leads to a lower net rate of reaction. Additionally, the operation of a BSTR is more labor intensive than operation of a continuous reactor. This adds to the cost of production, meaning a higher selling price is necessary in order to make a profit. Another issue with batch processes is that of batch-to-batch consistency. As an example, consider the batch production of an expensive perfume. It is critically imporant that every batch smells the same. Consequently, in addition to being labor intensive, batch processing requires well-trained operators who are careful to precisely follow the specified operational procedure and not deviate from it. Food and beverage production similarly demand high batch-to-batch consistency. This can be even more challenging if, as an example, the process utilizes agricultural reagents that can vary from season to season or year to year.

In light of their advantages and disadvantages, **BSTRs are often used to produce value-added products**. These are products for which the market demand is smaller, but the price, and therefore the profit per pound, is greater. This is in contrast to commodity products where the demand for large quantities is high, but the price per pound is relatively small. High volume production is usually performed in a continuous reactor (CSTR or PFR).

## BSTR Operation

By definition, reaction does not take place continuously in a batch
reactor. Before reaction can take place, the reactor must first be cleaned (or, in some cases, sterilized) to remove anything “left behind” by the last reaction that was run. Then the reactants must be prepared and charged into the reactor. From this point on, the operation is much like a cooking recipe. A prescribed series of heating and cooling steps is followed, with reaction taking place during every step. A simple example might be that after the reactants are charged, the reactor is heated to a specified temperature, held at that temperature for a specified length of time, and then cooled back to room temperature. In almost all situations, the reaction has ceased by the end of the last step, either because one of the reactants has been fully consumed or because the temperature has been lowered to the point where the rate is effectively zero. The last step in the operating protocol then is to remove the product from the reactor. Often it is transferred to a holding tank from which it can be sent elsewhere for further processing, purification, or longer term storage.

Of course, the operational protocol, i. e. the “recipe,” could be more complicated, requiring any number of steps. In some cases the operational protocol might call for the addition of a reagent. As long as that reagent is added instantaneously and all at once, the reactor can be analyzed as a BSTR. However, if the reagent is added over time as reactions continue to occur, the reactor is no longer a BSTR and that phase of processing must be analzyed as a semi-batch reactor (@sec-5_sbstr_analysis).

It is very important to recognize that the productivity of the reactor, that is the amount of product it produces per hour, must be calculated taking the so-called *turnaround time* into account. That is, one must include the time needed to clean, fill and drain the reactor, not just the length of time reaction takes place. Doing so permits the definition of the net rate of generation of reagent $i$ given in @eq-bstr_net_rate.

$$
r_{i,net} = \frac{n_i - n_{i,0}}{t_{rxn} + t_{turn}}
$$ {#eq-bstr_net_rate}

Even if the turnaround time was zero, it would still be desirable to define a net rate as above. The net rate is useful for characterizing the overall process. As the reaction is progressing, the rate of reaction is continually changing because the temperature and composition are changing. The rate of reaction at any one time during the processing is referred to as the instantaneous rate at that time. As such, the net rate is a kind of average of the instantaneous rate over the processing time. Similarly, it is sometimes useful to differentiate between overall and instantaneous values of other quantities such as yields, conversions, selectivities, etc.

## Qualitative Analysis of Reaction in a BSTR

A simple process for the qualitative analysis of a reacting system was presented in @sec-5_response_opt_design. In a BSTR, there are no spatial variations in temperature or composition because the reactor is perfectly mixed. Therefore, qualitative analysis of a BSTR is used to determine how temperature, reaction rate, composition and related quantities (conversion, selectivity) vary with reaction time. 

For purposes of illustration, suppose the typical, irreversible, exothermic reaction, $A \rightarrow Z$ takes place in an isothermal BSTR. In this situation, only the concentrations need to be considered because the temperature does not change. At the start of the process, the concentration of A will be high and that of Z will be small or zero. During a very small interval of time at the start of the process the concentration of A will decrease and the concentration of Z will increase due to the reaction starting to take place. Hence, in a plot of reactant concentration versus reaction time, the $y$-intercept will be high and the slope at that point will be negative. For the product, the $y$-intercept will be low or zero and the initial slope will be positive.

The changes in composition will affect the reaction rate. For a typical, irreversible reaction, the decrease in the reactant concentration will tend to decrease the rate while the increase in the product concentration will not affect the it. Consequently, at the end of that small interval of reaction time, the rate will be smaller.

In the next small interval of time, the concentration of the reactant, A, will decrease by less than it did in the first interval because the rate is lower. For the same reason, the concentration of the product, Z, will increase by less than it did during the first interval of time. In terms of graphs showing the concentrations versus time, then, the concentration of the reactant, A, will start high with a negative slope and a curvature that is concave upward. That is, the slope will become less steep as the reaction time increases. In like manner, a graph showing the concentration of Z versus reaction time will start at or near zero with a positive slope and a curvature that is concave downward (i. e. the slope will get less steep as the reaction time increases).

If that initial behavior continued througout the process, the concentration of the reactant would decrease with a smaller and smaller slope until finally reaching a horizontal plateau at a value of zero (because the reaction is irreversible and therefor goes to completion). The concentration of the product would increase with a smaller and smaller slope until finally reaching a plateau at a value equal to the initial concentration of A. The results of this qualitative analysis are shown in @fig-qualitative_iso_batch_profiles.

::: {#fig-qualitative_iso_batch_profiles layout-ncol=2}

![](Graphics/qual_iso_batch_reactant_profile.png){width="80%"}

![](Graphics/qual_iso_batch_product_profile.png){width="80%"}

Qualitative reactant (left) and product (right) concentration profiles during isothermal reaction in a BSTR.
:::

The qualitative analysis here was straightforward because the reactor was isothermal. In @sec-example_13_1 the qualitative analysis of an adiabatic BSTR is presented. That analysis is more complicated because both concentrations and temperature are changing. In fact, the changes in composition and temperature, taken separately, would affect the rate in opposite ways. As a consequence there is greater uncertainty in the results.

## BSTR Design Equations

The reactor design equations for BSTRs were presented in @sec-3_design_eqns. The BSTR mole and energy balances shown below were presented in Equations [-@eq-bstr_mole_balance] and [-@eq-bstr_energy_balance]. That chapter also presents the energy balances shown below for a heat exchange fluid that transfers sensible heat, @eq-exchange_energy_bal_sensible, and one that transfers latent heat, @eq-exchange_energy_bal_latent. @sec-3_design_eqns also describes how to select the specific reactor design equations needed to model BSTRs under different circumstances. That discussion will not be duplicated here.

$$
\frac{dn_i}{dt} = V \sum_j \nu_{i,j}r_j
$$

$$
\left(\sum_i n_i \hat C_{p,i} \right) \frac{dT}{dt} - V\frac{dP}{dt}  - P  \frac{dV}{dt}  = \dot Q - \dot W - V \sum_j \left(r_j \Delta H_j \right)
$$

$$
\rho_{ex} V_{ex} \tilde C_{p,ex}\frac{dT_{ex}}{dt} = -\dot Q - \dot m_{ex} \int_{T_{ex,in}}^{T_{ex}} \tilde C_{p,ex}dT
$$

$$
\frac{\rho_{ex} V_{ex} \Delta H_{\text{latent},ex}^0}{M_{ex}} \frac{d \gamma}{dt} = - \dot Q - \gamma \dot m_{ex} \frac{\Delta H_{\text{latent},ex}^0}{M_{ex}}
$$

The design equations can often be simplified. As noted in @sec-3_design_eqns, if the reactor walls are rigid (or if an ideal, incompressible liquid is being processed) then the volume, $V$, will be constant and its time derivative, $\frac{dV}{dt}$, will equal zero. If the work associated with agitation is negligible (it usually is) and there are no other shafts or moving boundaries, then the rate at which the reacting fluid performs work, $\dot W$, on its surroundings is also equal to zero. When an ideal, incompressible liquid is being processed, the pressure, $P$, is constant and its time derivative, $\frac{dP}{dt}$, is equal to zero. Finally, for liquids, @eq-bstr_equivalent_sens_heat_terms showed how the sensible heat term in @eq-bstr_energy_balance can be expressed in terms of the mass-specific or volume-specific heat capacity of the solution as a whole instead of the individual molar heat capacities.

$$
\left(\sum_i n_i \hat C_{p,i} \right) \frac{dT}{dt}\ \Leftrightarrow\ \rho V \tilde C_p \frac{dT}{dt}\ \Leftrightarrow\ V \breve C_p \frac{dT}{dt}
$$

When rate expressions are substituted into the BSTR mole and energy balances, they typically introduce concentrations or partial pressures of reagents. When the design equations are solved, those concentrations and partial pressures must be expressed in terms of the molar amounts of the reagents. The concentration is simply the molar amount divided by the volume, @eq-concentration_closed.

$$
C_i = \frac{n_i}{V}
$$

For ideal gases, the partial pressure is related to the molar amount through the ideal gas law, @eq-partial_pressure.

$$
P_i = \frac{n_iRT}{V}
$$

## General Approach to Modeling Isolated BSTRs

@sec-5_response_opt_design described how to identify a reaction engineering assignment that involves the modeling of an isolated ideal reactor and presented a general approach for completing the assignment using a response function. This section describes the application of that approach to the modeling of an isolated BSTR. The process may seem a bit abstract when first read, but it should become clearer after seeing it used in the examples provided at the end of this chapter. Often the operational protocol for a BSTR has multiple heating and cooling steps. When this is true, each step of the protocol can be analyzed separately from the other steps.

**The first step is to write the reactor design equations** for the system as described in @sec-3_design_eqns and in the preceding section of this chapter. The design equations for an isolated BSTR will be a set of initial-value, ordinary differential equations (IVODEs). As can be seen in the equations above, the independent variable will be the elapsed time since the start of processing, $t$. The dependent variables in those equations are the molar amounts of the reagents present in the system, $n_i$ the temperature of the reacting fluid, $T$, and either the outlet temperature of the exchange fluid (when it exchanges sensible heat), $T_{ex}$ or the fraction of the exchange fluid that undergoes phase change (when it exchanges latent heat), $\gamma$. When the operational protocol involves multiple steps, the reactor design equations can be written and solved separately for each step. The final values of the independent and dependent variables in one step then become the initial values for the next step.

**The second general step is to formulate the numerical solution of the reactor design equations**. Because they are IVODEs, the BSTR design equations *always* will be solved numerically to find the values of the dependent variables at one or more times after the start of processing. However, some reaction engineering assignments may entail finding the unknown value of a reactor input (initial moles of a reagent, initial temperature, inlet mass flow rate of the exchange fluid or inlet temperature of the exchange fluid) or a process parameter other than the final reaction time (reactor volume, heat transfer area, etc.). When this is the case, the numerical solution of the design equations is formulated *assuming that the unknown reactor input or process parameter will be provided* at the time the IVODEs are solved.

To solve the reactor design IVODEs numerically, initial values of the dependent variables and a value to be used as a stopping criterion must be provided or calculated within the respone function. Additionally, every quantity appearing in, or substituted into, the reactor design equations must be provided or calculated within the response function using only known constants, the dependent variables and the independent variable. It may be necessary to use the results from solving the reactor design equations to calculate quantities of interest in the analysis. The ancillary equations needed to do all of these things are included as part of the formulation of the solution to the reactor design equations. 

**The third general step is to create a response function** within which the reactor design equations are solved and the quantities of interest in the assignment are calculated and returned. If the assignment involves finding an unknown reactor input or process parameter, then the assignment will, of necessity, specify the value of one reactor output (or a quantity related to a reactor output). In this situation, as described in @sec-5_response_opt_design, the response function will be passed that unknown reactor input or process parameter as an argument that must be used when solving the design equations, and after solving the design equations, the reactor output specified in the assignment must be calculated and returned by the response function along with the other quantities of interest.

The completion of some reaction engineering assignments requires that the reactor design equations be solved multiple times while varying one or more quantities over ranges of values. The quantities being varied are passed to the response function as and adjusted values argument (see @fig-response_fcn) that takes the form of a vector or matrix. Each row of the adjusted values argument corresponds to one set of values withing the range of values. The response function then returns a vector or matrix where each row contains the quantity or quantities of interest corresponding the same row in the adjusted values argument.

**The fourth general step is to use the response function to calculate the quantities of interest in the analysis**. Generally this is straightforward, but if the assignment involves calculating an unknown reactor input or process parameter, the response function must first be used to calculate that value. The way that is done was described in @sec-5_response_opt_design. Basically, the response function is treated like an algebraic-trancendental equation (ATE) relating the unknown reactor input or process parameter to the reactor output specified in the assignment, @eq-resp_func_as_residual_eqn. It is solved numerically for the reactor input or process parameter that corresponds to the specified reactor output.

**The final general step is to process the quantities of interest returned by the response function**. A second function can be written to perform this step. If there is a missing reactor input or process parameter, it calculates that value first. The function then calls the response function and receives the quantities of interest from it. If there is a missing reactor input or process parameter, its value is provided as an argument when calling the response function. Similarly, if there are adjusted values, they are provided as an argument when calling the response function. The returned quantities of interest are then processed. Doing so may involve generating a graph, identifying a maximum or minimum value, displaying values and graphs on screen, and saving results to a file.

## BSTR Design Objectives

As noted in @sec-5_response_opt_design, design assignments typically involve calculation of fixed and operating costs, etc. together with reactor modeling. These types of design problems are beyond the scope of *Reaction Engineering Basics*. However, for illustrative purposes, reactor and process parameters can be used as indicators of these costs. For an isolated BSTR a few of the reactor and process parameters that might be used as economic indicators include the system volume (smaller is better), the processing time (shorter is better), the net production rate, @eq-bstr_net_rate, (larger is better), heat requirements (smaller is better), and selectivity or yield of one of the products. These indicators can be minimized or maximized using other reactor and process parameters including initial composition, temperature, reaction time, etc. Design assignments involving BSTRs are considered in @sec-5_non_continuous_design.

## Examples

```{r}
#| echo: false
#| output: false
library(tidyverse)
library(knitr)
library(kableExtra)
source('~/Libraries/R/fmt_tibble_col.R')
```

The examples in this section illustrate the analysis of isolated BSTRs. Examples [-@sec-example_13_1] and [-@sec-example_13_2] are **response assignments** where the assignment specifies a sufficient number of quantities so that the reactor design equations can be solved to find the quantities of interest. In [Example -@sec-example_13_1] all necessary reactor inputs and process parameters are specified and the quantities of interest are related to reactor outputs. In [Example -@sec-example_13_2] a reactor output is specified (the conversion), and one of the unknown quantities of interest is a reactor input (the initial temperature). In addition to illustrating the computational procedure for these two types of response tasks, [Example -@sec-example_13_1] involves a single reaction taking place in an adiabatic BSTR while [Example -@sec-example_13_2] features two reactions taking place in a BSTR that is cooled using an exchange fluid. Examples [-@sec-example_13_3] and [-@sec-example_13_4] are **optimization assignments** that identify a reactor variable that must be maximized or minimized by specifying a reactor input. The computational procedure for solving optimization problems differs slightly from the procedures for solving response problems. The BSTR operational protocol in [Example -@sec-example_13_3], like those in Examples [-@sec-example_13_1] and [-@sec-example_13_2], consists of a single step. [Example -@sec-example_13_4] illustrates a situation where there are multiple steps in the operating protocol. It also considers turnaround time and the net rate of reaction.

### Concentration, Temperature and Rate Profiles during Adiabatic Operation of a BSTR {#sec-example_13_1}

{{< include ../RE_Basics_Examples/reb_13_1/problem_statement.qmd >}}

```{r}
#| echo: false
#| output: false
path_to_data <- './Data/'
path_to_results <- '../RE_Basics_Examples/reb_13_1/Results/'
path_to_figures <- './Graphics/'
```

---

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

This assignment describes a single BSTR and its operation. There are no other reactors, heat exchangers, stream splits or stream mixers. The reaction taking place in the reactor is identified, and a rate expression is provided for it. The quantities of interest in the assignment are reactor variables. I know from @sec-5_response_opt_design that this combination of characteristics identifies this as an isolated reactor modeling assignment.

I know the general approach to completing an isolated reactor modeling assignment that was described in @sec-5_response_opt_design, and I will implement it here, but first I will summarize the information provided in the assignment.

:::

**Reactor**: BSTR

**Given**: $\Delta H_1 = -101.2 \text{ kJ mol}^{-1}$, $k_{0,1} = 5.11 \times 10^4 \text{ L mol}^{-1} \text{ s}^{-1}$, $E_1 = 74.8 \text{ kJ mol}^{-1}$, $V = 1900 \text{ L}$, $T_0 = \left( 180 + 273.15 \right) \text{ K}$, $C_{A,0} = 2.9 \text{ mol L}^{-1}$, $C_{B,0} = 3.2 \text{ mol L}^{-1}$, $\tilde{C}_p = 1.23 \text{ cal g}^{-1} \text{ K}^{-1}$, $\rho = 1.02 \text{ g cm}^{-3}$, and $t_{\text{rxn}} = 2 \text{ h}$.

**Quantities of Interest**: $C_A\left(t\right)$, $C_B\left(t\right)$, $C_Y\left(t\right)$, $C_Z\left(t\right)$, $T\left(t\right)$, and $r\left(t\right)$.

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

The first step in the general approach to completing an isolated reactor modeling assignment is to write and simplify the design equations that are needed to model the reactor. As described in @sec-3_design_eqns, mole balances are always included among the design equations. Here I will write a mole balance for each of the four reagents using @eq-bstr_mole_balance. There is only one reaction taking place, so the summation reduces to a single term. The stoichiometric coefficients of A and B are each equal to -1, and the stoichiometric coefficients of Y and Z are each equal to +1.

$$
\frac{dn_i}{dt} = V \cancelto{\nu_i r}{\sum_j \nu_{i,j}r_j}
$$

The BSTR in this assignment is not isothermal, so an energy balance must also be included among the design equations. The BSTR energy balance is given in @eq-bstr_energy_balance. A liquid-phase reaction is taking place in the BSTR. Assuming it to be an incompressible ideal solution, both the volume and the pressure are constant and their time derivatives are equal to zero. The reactor is adiabatic, so the rate of heat input, $\dot{Q}$, is equal to zero. There are no shafts or moving boundaries other than the agitator, and the rate at which it performs work is negligible, so $\dot{W}$ is also equal to zero. With only one reaction taking place, the summation over the reactions, $j$, reduces to a single term. Finally, this assignment provides the mass-specific heat capacity of the entire solution, so the sensible heat term can be re-written using that heat capacity, @eq-bstr_equivalent_sens_heat_terms.

$$
\cancelto{\rho V \tilde{C}_p}{\left(\sum_i n_i \hat C_{p,i} \right)} \frac{dT}{dt} - \cancelto{0}{V\frac{dP}{dt}}  - \cancelto{0}{P\frac{dV}{dt}}  = \cancelto{0}{\dot Q} - \cancelto{0}{\dot W} - V \cancelto{r \Delta H}{\sum_j \left(r_j \Delta H_j \right)}
$$

The BSTR here operates adiabatically, so there isn't an exchange fluid for which to write an energy balance, and momentum balances are not used with BSTRs, so that completes the reactor design equations needed to model the BSTR in this assignment.

The reactor design equations are initial value ordinary differential equations (IVODEs), so initial values and a stopping criterion are needed in order to solve them. The instant the fluids are mixed in the reactor can be defined as $t=0$, and $n_{A,0}$, $n_{B,0}$, and $T_0$ can be used to represent the molar amounts of reagents A and B and the temperature at that instant. The problem indicates that neither Y nor Z was present initially, so their initial values are zero. The assignment asks for reagent concentrations and temperature over the first 2 h of operation, so $t_{\text{rxn}} = 2 \text{ h}$ represents the stopping criterion.

:::

**Reactor Model**

Mole balance design equations for A, B, Y, and Z are presented in equations (3) through (6), and the energy balance on the reacting fluid is given by equation (7). The initial values and stopping criterion for solving these initial value ordinary differential equations are listed in @tbl-example_13_1_initial_values.

$$
\frac{dn_A}{dt} = -rV \tag{3}
$$

$$
\frac{dn_B}{dt} = -rV \tag{4}
$$

$$
\frac{dn_Y}{dt} = rV \tag{5}
$$

$$
\frac{dn_Z}{dt} = rV \tag{6}
$$

$$
\frac{dT}{dt} = \frac{-r \Delta H_1}{\rho \tilde{C}_p} \tag{7}
$$

| Variable | Initial Value | Stopping Criterion |
|:-------|:-------:|:-------:|
| $t$ | $0$ | $t_{rxn}$ |
| $n_A$ | $n_{A,0}$ | |
| $n_B$ | $n_{B,0}$ | |
| $n_Y$ | $0$ | |
| $n_Z$ | $0$ | |
| $T$ | $T_0$ | |
  
: Initial values and stopping criterion for solving the design equations, equations (3) through (7). {#tbl-example_13_1_initial_values tbl-colwidths="[20, 40, 40]"}

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

The next step in the general approach to completing an isolated reactor modeling assignment is to formulate the numerical solution of the reactor design equations, providing all necessary ancillary equations and initial values and a stopping criterion. The BSTR reactor design equations are IVODEs. In order to solve them, it is necessary to to go through the equations, and any equations that will be substituted into them, and express every quantity they contain in terms of known constants, the independent variable and the dependent variables. Here the independent variable is $t$, and the dependent variables are $n_A$, $n_B$, $n_Y$, $n_Z$, and $T$. It is also necessary to calculate the initial values and the value to be used as the stopping criterion if they are not known.

The only quantity appearing in the design equations, (3) through (7), that isn't a known constant, $t$, $n_A$, $n_B$, $n_Y$, $n_Z$, or $T$ is the rate, $r$. Equation (2) can be used to eliminate $r$ from the design equations, but that introduces $k$, $C_A$, and $C_B$. The rate coefficient can be expressed in terms of $T$ and known constants using the Arrhenius expression, @eq-arrhenius. The concentrations of A and B can be expressed in terms of $n_A$, $n_B$, and the known, constant, fluid volume using the defining equation for concentration. The initial moles of A and B also can be found using the defining equation for concentration.

Having gone through the equations I can see that there aren't any reactor inputs or proces parameters, so the design equations can be solved directly to calculate the reactor outputs.

:::

**Ancillary Equations**

Upon substitution of equations (8) through (10) into the design equations, they will only contain known constants, the independent variable, $t$, and the dependent variables, $n_A$, $n_B$, $n_Y$, $n_Z$, and $T$. As such, they can be solved numerically. The initial molar amounts of of the reagents in @tbl-example_13_1_initial_values can be calculated using equations (11) and (12) and used to solve the design equations.

$$
k = k_{0,1}\exp{\left( \frac{-E_1}{RT} \right)} \tag{8}
$$

$$
C_A = \frac{n_A}{V} \tag{9}
$$

$$
C_B = \frac{n_B}{V} \tag{10}
$$

$$
n_{A,0} = C_{A,0}V \tag{11}
$$

$$
n_{B,0} = C_{B,0}V \tag{12}
$$

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

The next step in the general approach to completing an isolated reactor modeling assignment is to create a response function that solves the reactor design equations, and calculates and returns the quantities of interest.

Solving the design equations will give values of $n_A$, $n_B$, $n_Y$, $n_Z$, and $T$ at times between $t=0$ and $t = t_{\text{rxn}}$. The quantities of interest are the concentrations, temperature, and rate *vs*. $t$. The concentrations can again be calculated using the defining equation for concentration, and the rate can be calculated using equation (2).

:::

**Response Calculation**

Solving equations (3) through (7) will yield $n_A$, $n_B$, $n_Y$, $n_Z$, and $T$ as functions of $t$. The concentrations of A, B, Y, and Z as functions of time can be computed using equations (9), (10), (13), and (14). The instantaneous reaction rate at any time, $t$, can be found by calculating $k$ using equation (8), and then using equation (2).

$$
C_Y = \frac{n_Y}{V} \tag{13}
$$

$$
C_Z = \frac{n_B}{V} \tag{14}
$$

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

In this assignment, there isn't a missing reactor input or process parameter that needs to be passed to the response function as an argument. The reactor design equations do not need to be solved repeatedly to generate a graph or identify a minimum/maximum. Therefore, nothing needs to be passed to the response function as an argument.

:::

**Response Function**

The response function is created with the following structure:

* Variables are defined and assigned the values of all known and given quantities: $\Delta H_1 = -101.2 \text{ kJ mol}^{-1}$, $k_{0,1} = 5.11 \times 10^4 \text{ L mol}^{-1} \text{ s}^{-1}$, $E_1 = 74.8 \text{ kJ mol}^{-1}$, $V = 1900 \text{ L}$, $T_0 = \left( 180 + 273.15 \right) \text{ K}$, $C_{A,0} = 2.9 \text{ mol L}^{-1}$, $C_{B,0} = 3.2 \text{ mol L}^{-1}$, $\tilde{C}_p = 1.23 \text{ cal g}^{-1} \text{ K}^{-1}$, $\rho = 1.02 \text{ g cm}^{-3}$, and $t_{\text{rxn}} = 2 \text{ h}$.
* The IVODEs are solved as described in @sec-apndx_solve_ivodes:
	* A function that evaluates the derivatives in the design equations is defined.
		* It receives a value of the independent variable, $t$, and values of the dependent variables, $n_A$, $n_B$, $n_Y$, $n_Z$, and $T$, as arguments.
    	* It calculates $k$ using equation (8).
		* It calculates $C_A$ and $C_B$ using equations (9) and (10).
    	* It calculates $r$ using equation (2).
    	* It calculates and returns the values of the derivatives using equations (3) through (7).
	* The initial values in @tbl-example_13_1_initial_values, $n_{A,0}$ and $n_{B,0}$, are calculated using equations (11) and (12).
	* An IVODE solver is called.
		* It receives the function defined above, the initial values and the stopping criterion as arguments.
		* It returns a vector containing reaction times between $t=0$ and $t=t_{rxn}$ and a matrix with columns containing $n_A$, $n_B$, $n_Y$, $n_Z$, and $T$ at those reaction times.
* Using the results from solving the IVODEs, the quantities of interest are calculated.
	* $C_A$, $C_B$, $C_Y$, and $C_Z$ are calculated at each reaction time using equations (9), (10), (13), and (14).
	* $r$ is calculated at each time using equations (8), and (2).
* The reaction times, and the quantities of interest at those reaction times, $C_A$, $C_B$, $C_Y$, $C_Z$, $T$, and $r$, are returned.

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

The final steps in the general approach to completing an isolated reactor modeling assignment are to use the response function to calculate the quantities of interest and to process them as needed to complete the assignment. In this assignment, this is accomplished simply by calling the response function to calculate the quantities of interest as functions of reaction time and then plotting the results.

:::

**Calculations**

A response function was written to calculate the quantities of interest as described above. A second computer function was written to plot and save the results. Specifically, it

1. Calls the response function to get values of $t$, $C_A$, $C_B$, $C_Y$, $C_Z$, $T$, and $r$ at times between $t=0$ and $t=t_{rxn}$.
2. Plots each of the concentrations, the temperature, and the rate versus time.

**Results**

Performing the calculations as described yields the concentration profiles shown in @fig-example_13_1_concentrations, the temperature profile shown in @fig-example_13_1_temperatures, and the rate profile shown in @fig-example_13_1_rates

![Concentrations *versus* reaction time.](`r paste0(path_to_figures,'reb_13_1_C_vs_t.png')`){#fig-example_13_1_concentrations width="60%"}

![Temperature *versus* reaction time.](`r paste0(path_to_figures,'reb_13_1_T_vs_t.png')`){#fig-example_13_1_temperatures width="60%"}

![Rate *versus* reaction time.](`r paste0(path_to_figures,'reb_13_1_r_vs_t.png')`){#fig-example_13_1_rates width="60%"}

**Summary and Comments**

The shapes of the concentration, temperature, and rate profiles shown in Figures [-@fig-example_13_1_concentrations], [-@fig-example_13_1_temperatures], and [-@fig-example_13_1_rates] can be explained by performing a **qualiative analysis**. At $t=0$, the concentrations of the reagents and the temperature are all at their initial values and the rate is non-zero.

After a short interval of time, the concentrations of A and B will have decreased slightly and the concentration of Y and Z will have increased slightly due to the occurrence of the reaction. Because the reaction is exothermic and the reactor operates adiabatically, the temperature will have increased due to the heat released by the reaction. The rate could either increase or decrease during this short interval. The concentrations of the reactants, A and B, are decreasing, and this alone would cause the rate to decrease (see equation (2)). However, at the same time the temperature is increasing, and that alone would cause the rate coefficient, and hence the rate to increase (see equation (8)). Generally the exponential dependence of the rate upon the temperature will be stronger than its dependence upon the reactant concentrations and the rate will increase. This is seen to be the case in @fig-example_13_1_rates. Had the heat of reaction been very small, it is possible that the rate would have decreased.

Thus, *during that initial short interval of time, the concentrations of Y and Z, the temperature, and the rate all have positive slopes while the concentrations of A and B have negative slopes*. During the next short interval of time, the rate is larger than during the first interval of time. As a consequence, *the concentrations and temperature will change **more** during the second interval*. Thus, *the curvature of temperature, Y concentration, and Z concentration profiles is initially concave upward and the curvature of the A and B concentration profiles is initially concave downward*.

The initial curvature of the concentration and temperature profiles is very slight and can't really be discerned in @fig-example_13_1_concentrations and @fig-example_13_1_temperatures. Nonetheless, the initial curvature **must** change at some later time. Initially the concentrations of A and B are decreasing faster and faster and the concentrations of Y and Z and the temperature are increasing faster and faster. These trends cannot continue indefinitely, if they did, $C_Y$, $C_Z$, and $T$ would approach positive infinity and $C_A$ and $C_B$ would approach negative infinity.

In fact, the curvature does change because at some point the effect of decreasing reactant concentrations upon the rate becomes stronger than the effect of increasing temperature. At the point where the two effects become equal, the rate reaches a maximum. Beyond the maximum, the effect of decreasing reactant concentration dominates and the rate decreases. This is seen in @fig-example_13_1_rates.

At the point where the rate reaches its maximum value, the concentration and temperature profiles exhibit an inflection point. (Again, in this example this is very, very subtle and cannot be discerned in the figures.) Beyond that point, the $C_Y$, $C_Z$, and $T$ profiles are concave downward and the $C_A$ and $C_B$ are concave upward. That is, the changes over time become smaller and smaller. This behavior can continue indefinitely. Eventually the concentrations and temperature will stop changing and become constant. In this example, A is the limiting reactant, and the reaction is irreversible, so the concentrations and temperature will become constant when $C_A$ becomes equal to zero.

### Parallel Reaction Selectivity in a Cooled BSTR with an Unknown Initial Temperature {#sec-example_13_2}

{{< include ../RE_Basics_Examples/reb_13_2/problem_statement.qmd >}}

```{r}
#| echo: false
#| output: false
path_to_data <- './Data/'
path_to_results <- '../RE_Basics_Examples/reb_13_2/Results/'
path_to_figures <- './Graphics/'
```

---

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

I know that this is an isolated reactor modeling assignment because it includes the following distinguishing characteristics.

* The system consists of an ideal BSTR with no other reactors, heat exchangers, stream splits, stream mixers, etc.
* Properties of the reactor and operational parameters are provided.
* The reactions taking place are known, and rate expressions are available for them.
* The assignment quantities of interest in this assignment are a reactor input, the initial temperature, and three reactor responses, the final temperature, the outlet exchange fluid temperature and the selectivity of X to Z.

I know that the first step in the general approach for completing isolated reactor modeling assignments is to write the reactor design equations for the reactor, but before doing that I will summarize the information provided in the assignment.

:::

**Reactor**: BSTR

**Given**: $V = 10\text{ L}$, $V_{ex} = 1.4\text{ L}$, $U = 138\text{ cal ft}^{-2}\text{ min}^{-1}\text{ K}^{-1}$, $A = 1200\text{ cm}^2$, $T_{ex,in} = 40\text{ °C}$, $\dot{m}_{ex} = 100\text{ g min}^{-1}$, $\rho = 1.0\text{ g cm}^{-3}$, $\rho_{ex} = 1.0\text{ g cm}^{-3}$, $\tilde{C}_p = 1.0\text{ cal g}^{-1}\text{ K}^{-1}$, $\tilde{C}_{p,ex} = 1.0\text{ cal g}^{-1}\text{ K}^{-1}$, $C_{A,0} = 5.0\text{ M}$, $C_{B,0} = 7.0\text{ M}$, $\Delta H_1 = -16.7\text{ kcal mol}^{-1}$, $\Delta H_2 = -14.3\text{ kcal mol}^{-1}$, $k_{0,1} = 9.74 \times 10^9\text{ L mol}^{-1}\text{ min}^{-1}$, $E_1 = 20.1\text{ kcal mol}^{-1}$, $k_{0,2} = 2.38 \times 10^{13}\text{ min}^{-1}$, $E_2 = 25.3\text{ kcal mol}^{-1}$, and $t_{rxn} = 30\text{ min}$.

**Specified Response**: $f_A = 0.45$

**Quantities of Interest**: $T$, $T_{ex}$, and $S_{X/Z}$ at $t=t_{rxn}$; $T_0$

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

The first step in the general approach for completing isolated reactor modeling assignments is to write the reactor design equations for the reactor as described in @sec-3_design_eqns. Mole balances are always included in the design equations, and for a BSTR the mole balance is given by @eq-bstr_mole_balance. In this system, there are two reactions taking place, so the summation expands to two terms.

$$
\frac{dn_i}{dt} = V \sum_j \nu_{i,j}r_j = \nu_{i,1}r_1V + \nu_{i,2}r_2V
$$

The BSTR is not isothermal, so an energy balance on the reacting fluid, @eq-bstr_energy_balance, is required. There are no shafts or moving boundaries (other than the agitator which is assumed to do negligible work), so the rate of doing work, $\dot{W}$, is zero and the volume is constant. This is a liquid phase system, so the pressure will also be constant. Since the volume and pressure are constant, their time derivatives are equal to zero.

$$
\left(\sum_i n_i \hat C_{p,i} \right) \frac{dT}{dt} - \cancelto{0}{V\frac{dP}{dt}}  - \cancelto{0}{P  \frac{dV}{dt}}  = \dot Q - \cancelto{0}{\dot W} - V \sum_j \left(r_j \Delta H_j \right)
$$

The summation over the reactions, $j$, expands to two terms, and a mass-specific heat capacity of the entire solution is provided, so the sensible heat term can be re-written using that heat capacity, @eq-bstr_equivalent_sens_heat_terms.

$$
V \sum_j \left(r_j \Delta H_j \right) \Rightarrow r_1V \Delta H_1 + r_2V \Delta H_2
$$

$$
\left(\sum_i n_i \hat C_{p,i} \right) \frac{dT}{dt} \Rightarrow \rho V \tilde{C}_p \frac{dT}{dt}
$$

The reactor is cooled with chilled water which gains sensible heat from the reacting fluid, so the energy balance on that exchange fluid is given by @eq-exchange_energy_bal_sensible.

$$
\rho_{ex} V_{ex} \tilde C_{p,ex}\frac{dT_{ex}}{dt} = -\dot Q - \dot m_{ex} \int_{T_{ex,in}}^{T_{ex}} \tilde C_{p,ex}dT
$$

The exchange fluid heat capacity is constant, making the evaluation of the integral trivial.

$$
\dot m_{ex}\int_{T_{ex,in}}^{T_{ex}} \tilde C_{p,ex}dT \Rightarrow \dot m_{ex}\tilde C_{p,ex}\left( T_{ex} - T_{ex,in} \right)
$$

Momentum balances are not used with BSTRs so the full set of design equations consists of mole balances on each of the reagents, A, B, X, Y, and Z, an energy balance on the reacting fluid, and an energy balance on the exchange fluid.

:::

**Reactor Model**

Mole balances on the five reagents are shown in equations (5) through (9). Equation (10) is an energy balance on the reacting fluid and equation (11) is an energy balance on the exchange fluid.

$$
\frac{dn_A}{dt} = \left(-r_1 -r_2 \right)V \tag{5}
$$

$$
\frac{dn_B}{dt} = -r_1 V \tag{6}
$$

$$
\frac{dn_X}{dt} = r_1 V \tag{7}
$$

$$
\frac{dn_Y}{dt} = r_1 V \tag{8}
$$

$$
\frac{dn_Z}{dt} = r_2 V \tag{9}
$$

$$
\frac{dT}{dt}  = \frac{\dot Q - V \left(r_1 \Delta H_1 +  r_2 \Delta H_2\right)}{\tilde{C}_p \rho V} \tag{10}
$$

$$
\frac{dT_{ex}}{dt} = \frac{-\dot Q - \dot m_{ex} \tilde C_{p,ex}\left(T_{ex} - T_{ex,in}\right)}{\rho_{ex} V_{ex} \tilde C_{p,ex}} \tag{11}
$$

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

The reactor design equations are initial value ordinary differential equations (IVODEs), so I need to provide initial values and a stopping criterion for solving them. The instant the fluids are mixed in the reactor can be defined as $t=0$. The solutions used to charge it contain only A and B; $n_{A,0}$ and $n_{B,0}$ can be used to represent the initial molar amounts of A and B. The initial molar amounts of X, Y, and Z are zero. The initial temperature is unknown, but $T_0$ can be used to represent it. The assignment does not mention the initial *outlet* temperature of the exchange fluid $T_{ex,0}$, so I will assume that the cooling water is flowing before the reagents are mixed so the initial outlet exchange fluid temperature equals the inlet exchange fluid temperature, $T_{ex,in}$. The assignment is to find responses after a reaction time of $t_{rxn} = 30 \text{ min}$, so that is the stopping criterion.

:::

| Variable | Initial Value | Stopping Criterion |
|:-------|:-------:|:-------:|
| $t$ | $0$ | $t_{rxn}$ |
| $n_A$ | $n_{A,0}$ | |
| $n_B$ | $n_{B,0}$ | |
| $n_X$ | $0$ | |
| $n_Y$ | $0$ | |
| $n_Z$ | $0$ | |
| $T$ | $T_0$ | |
| $T_{ex}$ | $T_{ex,0} = T_{ex,in}$ | |
  
: Initial values and stopping criterion for solving design equations, (5) through (11). {#tbl-example_13_2_initial_values tbl-colwidths="[20, 40, 40]"}

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

The second step in the general approach for completing isolated reactor modeling assignments is to formulate the solution of the design equations to calculate the reactor outputs, assuming that any missing reactor inputs and process parameters will be available. The reactor outputs in this system are the dependent variables in the IVODEs: $n_A$, $n_B$, $n_X$, $n_Y$, $n_Z$, $T$, and $T_{ex}$ at $t = t_{rxn}$. The design equations are IVODEs, and in order to solve them, every quantity that appears them or is substituted into them must be expressed in terms of known constants, the independent variable, $t$, and the dependent variables just listed. The initial values and the value of the stopping criterion must also be calculated if not known.

The two rates appearing in the design equations are given by equations (3) and (4), which introduce $k_1$, $k_2$, $C_A$, and $C_B$ into the design equations. The rate coefficients can be expressed in terms of the Arrhenius expression, @eq-arrhenius, and the concentrations in terms of the molar amounts and the fluid volume, @eq-concentration_closed. The rate of heat transfer can be expressed in terms of the heat transfer coefficient, heat transfer area and temperature difference between the reacting and exchange fluids, @eq-bstr_heat_transfer. Finally, the initial molar amounts of A and B can be calculated using their specified initial concentrations.

The initial temperature is not specified, indeed, the assignment asks me to find the initial temperature. It is needed as an initial value for solving the design equations, making it a missing value.
:::

**Ancillary Equations**

Upon substitution of equations (12) through (16) into the design equations, they will only contain known constants, the independent variable, $t$, and the dependent variables, $n_A$, $n_B$, $n_X$, $n_Y$, $n_Z$, $T$, and $T_{ex}$. As such, they can be solved numerically. The initial molar amounts of A and B can be calculated using equations (17) and (18) and used to solve the design equations.

$$
k_1 = k_{0,1}\exp{\left( \frac{-E_1}{RT} \right) } \tag{12}
$$

$$
k_2 = k_{0,2}\exp{\left( \frac{-E_2}{RT} \right) } \tag{13}
$$

$$
C_A = \frac{n_A}{V} \tag{14}
$$

$$
C_B = \frac{n_B}{V} \tag{15}
$$

$$
\dot{Q} = UA\left(T_{ex} - T \right) \tag{16}
$$

$$
n_{A,0} = C_{A,0}V \tag{17}
$$

$$
n_{B,0} = C_{B,0}V \tag{18}
$$

**Missing Value**: $T_0$

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

Assuming the missing value will be available, solving the reactor design equations will yield $n_A$, $n_B$, $n_X$, $n_Y$, $n_Z$, $T$, and $T_{ex}$ at $t = t_{rxn}$. The third step in the general approach for completing isolated reactor modeling assignments is to use the results from solving the design equations to calculate the quantities of interest. As noted in the summary at the start of this formulation, the quantities of interest are $T$, $T_{ex}$, and $S_{X/Z}$. The assignment also specifies the value of one response, the conversion, $f_A$, and it must also be calculated using the results from solving the reactor design equations. Solving the reactor design equations yields $T$ and $T_{ex}$ directly. The selectivity and conversion are simply calculated using their definitions, @eq-selectivity_def_closed and @eq-conversion_def_closed.

:::

**Response Calculation**

Solving the design equations will yield the values of the dependent variables after 30 min. Equation (19) can then be used to calculate the conversion of A, and equation (20) can be used to calculate the selectivity for X over Z.

$$
f_A \Big\vert_{t=t_{rxn}} = \frac{n_{A,0} - n_A \Big\vert_{t=t_{rxn}}}{n_{A,0}} \tag{19}
$$

$$
S_{X/Z} \Big\vert_{t=t_{rxn}} = \frac{n_X \Big\vert_{t=t_{rxn}}}{n_Z \Big\vert_{t=t_{rxn}}} \tag{20}
$$

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

The fourth step in the general approach for completing isolated reactor modeling assignments is to create the response function that solves the reactor design equations and calculates the quantities of interest as just described. The response function should be passed the missing value, that is, the initial temperature of the reacting fluid, as an argument. The response function should return the quantities of interest **and** the calculated value of the specified response, namely the conversion of A.

:::

**Response Function**

The response function is created with the following structure:

* The missing input, $T_0$, is passed to it as an argument.
* Variables are defined and assigned the values of all known and given quantities, $V$, $V_{ex}$, $U$, $A$, $T_{ex,in}$, $\dot{m}_{ex}$, $\rho$, $\rho_{ex}$, $\tilde{C}_p$, $\tilde{C}_{p,ex}$, $C_{A,0}$, $C_{B,0}$, $\Delta H_1$, $\Delta H_2$, $k_{0,1}$, $E_1$, $k_{0,2}$, $E_2$, and $t_{rxn}$, after converting them to consistent units.
* It defines a function that evaluates the derivatives in the design equations given values of the independent variable, $t$, and the dependent variables, $n_A$, $n_B$, $n_X$, $n_Y$, $n_Z$, $T$, and $T_{ex}$. That function
  * Calculates $k_1$ and $k_2$ using equations (12) and (13),
  * Calculates $C_A$ and $C_B$ using equations (14) and (15),
  * Calculates $r_1$ and $r_2$ using equations (3) and (4),
  * Calculates $\dot{Q}$ using equation (16), and
  * Evaluates and returns the values of the derivatives, equations (5) through (11).
* The initial molar amounts of A and B, $n_{A,0}$ and $n_{B,0}$ are calculated using equations (17) and (18).
* The design equations, (5) through (11), are solved using function defined above, the initial values, and the stopping criterion in @tbl-example_13_2_initial_values to find $n_A$, $n_B$, $n_X$, $n_Y$, $n_Z$, $T$, and $T_{ex}$ at $t=t_{rxn}$.
* The following quantities are calculated (if necessary) and returned.
  * The specified response, $f_A$, is calculated using equation (19).
  * The responses of interest, $T$, $T_{ex}$, are known from solving the design equations.
  * The selectivity for X over Z, $S_{X/Z}$, is calculated using equation (20).

**Calculations**

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

The fifth and final step in the general approach for completing isolated reactor modeling assignments is to use the response function to calculate all quantities of interest. In the present analysis a reactor input, specifically the initial temperature, $T_0$, is unknown, while a response, specifically the fractional conversion of A, $f_A$, is specified. In this situation it is necessary to use the response function to create a trivial residual equation and calculate and the missing unknown using an ATE solver as described in @sec-5_response_opt_design and earlier in this chapter. Then, knowing the value of the missing input, it can be passed to the response function to find the other responses of interest.

In this case, the response function can be thought of as providing the fractional conversion, given the initial temperature. (It also provides some other quantities, but for now, the other quantities can be ignored.) If it is given the correct value of the initial temperature, it will then equal the fractional conversion specified in the assignment. This can be represented as follows where $\Omega$ is used to represent the response function, $f_{A,f}$ is the conversion specified in the assignment, and $T_0$ is the unknown initial temperature.

$$
\Omega\left(T_0\right) = f_{A,f} \qquad \Rightarrow \qquad 0 = \Omega\left(T_0\right) - f_{A,f}
$$

This can be thought of as a single algebraic-transcendental equation (ATE) that needs to be solved to find $T_0$. The second form above has been written as a residual equation, which is the form used when solving ATEs numerically. Thus, to complete the assignment, I need to solve that trivial residual equation numerically for $T_0$. Then, once I know the initial temperature, I can call the response function passing that value as an argument and it will return the responses of interest, $T$, $T_{ex}$, and $S_{X/Z}$. (It will also return the fractional conversion, but I already know that.)

:::

1. Letting $\Omega\left(T_0\right)$ represent the fractional conversion returned by the response function, use numerical software that solves algebraic-transcendental equations (ATEs) to solve equation (21) to find the initial temperature that results in the fractional conversion specified in the assignment.

$$
0 = \Omega\left(T_0\right) - f_{A,f} \tag{21}
$$

2. Pass the resulting value of $T_0$ to the response function to get the responses of interest, $T$, $T_{ex}$, and $S_{X/Z}$. 

**Results**

```{r}
#| echo: false
#| output: false
df <- read.csv(paste0(path_to_results,"reb_13_2_results.csv"))
df <- fmt_tibble_col(df, 2, 3, 2, 1)
```

The calculations were performed as described above, yielding the results shown in @tbl-example_13_2_results.

```{r}
#| echo: false
#| label: tbl-example_13_2_results
#| tbl-cap: Computational results.
kbl(df, format = "markdown", align = "ccc")
```

**Summary and Comments**

An initial temperature of `r df$value[1]` `r df$units[1]` is required to reach a conversion of `r df$value[4]``r df$units[4]` in 30 min. At that time, the temperature of the reacting fluid will be `r df$value[2]` `r df$units[2]`, the exit temperature of the exchange fluid will be `r df$value[3]` `r df$units[3]`, and the selectivity will equal `r df$value[5]` `r df$units[5]`.

:::{.callout-note collapse="false"}
## Note

Both [Example -@sec-example_13_1] and [Example -@sec-example_13_2] involve response tasks. That is, the assignment provides all of the information needed to solve the reactor design equations. They differ in that [Example -@sec-example_13_1] provides all of the reactor inputs and process parameters and requests only reactor outputs and responses. In other words it is a simple response task as defined in @sec-5_response_opt_design. In contrast, [Example -@sec-example_13_2] specifies the value of an output (the conversion) and requests the value of a reactor input, making it a specified-response task. A response function is used to complete both tasks. In the simple response task it is used directly to calculate the requested quantities. In the specified-response task it is first used indirectly to calculate the missing input and then, with that input, it is used directly to calculate the other requested quantities.

:::


### Maximum Intermediate Yield in Series Reactions {#sec-example_13_3}

{{< include ../RE_Basics_Examples/reb_13_3/problem_statement.qmd >}}

```{r}
#| echo: false
#| output: false
path_to_data <- './Data/'
path_to_results <- '../RE_Basics_Examples/reb_13_3/Results/'
path_to_figures <- './Graphics/'
```

---

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

This assignment describes a single BSTR and no other reactors, heat exchangers, or stream mixing/splitting points. It describes the reactor, its operation, and the reactions taking place, including the rate expressions. It asks me to find a reaction time to maximize yield. From these characteristics, I now that this is an isolated reactor modeling assignment. Ffrom @sec-5_response_opt_design, I also know the general approach for solving this type of assignment.

I like to start assignments by creating a concise summary of the information provided in the assignment.

:::

**Reactor**: BSTR

**Given**: $P_{A,0}=1\text{ atm}$, $P_{B,0}=2\text{ atm}$, $T_0 = 25\text{ °C}$, $V= 2\text{ L}$, $A= 600\text{ cm}^2$, $U= 0.6 \text{ cal cm}^{-2} \text{ min}^{-1}\text{ K}^{-1}$, $T_e =30\text{ °C}$, $k_{0,1} =  3.34 \times 10^9 \text{ mol cm}^{-3}\text{ min}^{-1}\text{ atm}^{-2}$, $k_{0,2} = 4.99 \times 10^9 \text{ mol cm}^{-3}\text{ min}^{-1}\text{ atm}^{-2}$, $E_1= 20.5\text{ kcal mol}^{-1}$, $E_2= 21.8\text{ kcal mol}^{-1}$, $\Delta H_1= -6,300 \text{ cal mol}^{-1}$, $\Delta H_2= -6,900 \text{ cal mol}^{-1}$, $\hat C_{p,A}= 7.4 \text{ cal mol}^{-1}\text{ K}^{-1}$, $\hat C_{p,B}= 8.6 \text{ cal mol}^{-1}\text{ K}^{-1}$, $\hat C_{p,D}= 10.7 \text{ cal mol}^{-1}\text{ K}^{-1}$, $\hat C_{p,Z}= 5.2 \text{ cal mol}^{-1}\text{ K}^{-1}$ and $\hat C_{p,U}= 10.3 \text{ cal mol}^{-1}\text{ K}^{-1}$.

**Quantities of Interest**: $\underset{t_{rxn}}{\arg\max} \left(Y_{D/A}\right)$, $\max \left(Y_{D/A}\right)$, $f_A$

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

The first step in the general approach to completing isolated reactor modeling assignments is to write the reactor design equations for the reactor. @sec-3_design_eqns described how to do this.

Mole balances are always included in the reactor design equations. The general BSTR mole balance is given in @eq-bstr_mole_balance.

$$
\frac{dn_i}{dt} = V \sum_j \nu_{i,j}r_j
$$

I will use this equation to write mole balances for every reagent in the system. That is, I'll write the mole balance for $i$ = A, B, D, Z, and U. There are two reactions taking place, so the sum will expand to two terms in each mole balance.

$$
\frac{dn_i}{dt} = \left( \nu_{i,1}r_1 + \nu_{i,2}r_2 \right)V
$$

This reactor is not isothermal, so I will need to include a BSTR reacting fluid energy balance among the reactor design equations. The BSTR energy balance is given in @eq-bstr_energy_balance

$$
\left(\sum_i n_i \hat C_{p,i} \right) \frac{dT}{dt} - V\frac{dP}{dt}  - P  \frac{dV}{dt}  = \dot Q - \dot W - V \sum_j \left(r_j \Delta H_j \right)
$$

The reactor has rigid walls and no moving boundaries, so it's volume is constant. If the volume is constant, the time-derivative of the volume is equal to zero. Being a gas phase system with a constant volume, the pressure is expected to change because the temperature will change. Therefore I *cannot* set the time-derivative of the pressure equal to zero. With no moving boundaries, the only work is that of the agitator, which is assumed to be negligible. The summation over $i$ includes every reagent, and as above, the summation over $j$ expands to two terms.

$$
\begin{aligned}
\left( n_A \hat C_{p,A} + n_B \hat C_{p,B} + n_D \hat C_{p,D} + n_Z \hat C_{p,Z} + n_U \hat C_{p,U}  \right) \frac{dT}{dt} &- V\frac{dP}{dt}  - P  \cancelto{0}{\frac{dV}{dt}}  \\&= \dot Q - \cancelto{0}{\dot W} - \left( r_1 \Delta H_1 + r_2 \Delta H_2\right)V
\end{aligned}
$$

An exchange fluid is present in this reactor, but the assignment states that its temperature is constant at 30 °C. Knowing the exchange fluid temperature, the reactor design equations can be solved independently of an energy balance on the exchange fluid. Since none of the quantities of interest are affected by an  energy balance on the exchange fluid, I do not need to include one among the reactor design equations.

:::

**Reactor Model**

Mole balances on each of the reagents are presented in equations (5) through (9), and an energy balance on the reacting fluid is presented in equation (10).

$$
\frac{dn_A}{dt} = -r_1V \tag{5}
$$

$$
\frac{dn_B}{dt} = \left( -r_1 - r_2 \right)V \tag{6}
$$

$$
\frac{dn_D}{dt} = \left( r_1 - r_2 \right)V \tag{7}
$$

$$
\frac{dn_Z}{dt} = \left( r_1 + r_2 \right)V \tag{8}
$$

$$
\frac{dn_U}{dt} = r_2V \tag{9}
$$

$$
\begin{aligned}
&\left( n_A \hat C_{p,A} + n_B \hat C_{p,B} + n_D \hat C_{p,D} + n_Z \hat C_{p,Z} + n_U \hat C_{p,U}  \right) \frac{dT}{dt} - V\frac{dP}{dt} \\&= \dot Q  - \left( r_1 \Delta H_1 + r_2 \Delta H_2\right)V
\end{aligned} \tag{10}
$$

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

At this point I have 5 initial value ordinary differential equations (IVODEs) that contain 6 dependent variables (n~A~, n~B~, n~D~, n~Z~, n~U~, T, and P). I either need to eliminate a dependent variable or add an IVODE before I can solve the reactor design equations. For either approach, the ideal gas law is the starting point.

$$
PV - \left(n_A + n_B + n_D + n_Z + n_U \right)RT =0
$$

In this assignment, the volume is constant.

:::

Taking the derivative of the ideal gas law yields equation (11).

$$
\begin{aligned}
V\frac{dP}{dt} &- RT\left(\frac{dn_A}{dt} + \frac{n_B}{dt} + \frac{n_D}{dt} + \frac{n_Z}{dt} + \frac{n_U}{dt} \right) \\&- R\left(n_A + n_B + n_D + n_Z + n_U \right)\frac{dT}{dt} = 0
\end{aligned}\tag{11}
$$

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

I now have 6 IVODEs with 6 dependent variables. Initial values and a stopping criterion are needed in order to solve these equations. I can define $t=0$ to be instant that the A and B are added to the reactor, and let $n_{A,0}$, $n_{B,0}$, $P_0$, and $T_0$ represent the molar amounts of A and B, the pressure, and the temperature at that instant. Initially the reactor does not contain D, Z, or U, so the initial molar amounts of those reagents are equal to zero. The stopping criterion is $t=t_rxn$.

:::

The initial values and stopping criterion for equations (5) through (11) are presented in @tbl-example_13_3_initial_values.

| Variable | Initial Value | Stopping Criterion |
|:-------|:-------:|:-------:|
| $t$ | $0$ | $t_{rxn}$ |
| $n_A$ | $n_{A,0}$ | |
| $n_B$ | $n_{B,0}$ | |
| $n_D$ | $0$ | |
| $n_Z$ | $0$ | |
| $n_U$ | $0$ | |
| $T$ | $T_0$ | |
| $P$ | $P_0$ | |
  
: Initial values and stopping criterion for solving the design equations, (5) through (11). {#tbl-example_13_3_initial_values tbl-colwidths="[20, 40, 40]"}

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

The reactor design equations, (5) through (11), are a set of IVODEs. The next step in the general approach to completing isolated reactor modeling assignments is to formulate their solution. In order to solve them, I must have numerical values for the initial values and stopping criterion, and I need to express every quantity that appears in the IVODEs, or that is substituted into them, in terms of known constants, the independent variable, $t$, and the dependent variables, $n_A$, $n_B$, $n_D$, $n_Z$, $n_U$, $T$, and $P$.

Looking at the quantities in the IVODEs, $V$, $\hat C_{p,A}$, $\hat C_{p,B}$, $\hat C_{p,D}$, $\hat C_{p,Z}$, $\hat C_{p,U}$, $\Delta H_1$, $\Delta H_2$, and the gas constant, $R$, are known constants. The reaction rates are given by equations (3) and (4). Substituting the rate expressions into the reactor design equations introduces the known constants, $k_{0,1}$, $k_{0,2}$, $E_1$, and $E_2$, along with the partial pressures of A, B, and D. The partial pressures can be calculated using the ideal gas law.

$$
P_i = \frac{n_iRT}{V}
$$

The rate of heat transfer, $\dot{Q}$, can be expressed in terms of $T$ and the known, constant heat transfer coefficient, $U$, heat transfer area, $A$, and exchange fluid temperature, $T_{ex}$, @eq-bstr_heat_transfer.

The initial molar amounts of A and B can be calculated using the ideal gas law and the initial pressure is simply the sum of the initial partial pressures of A and B.

:::

**Ancillary Equations**

The partial pressures in the rate expression can be calculated using equations (12) through (14). The rate of heat transfer can be calculated using equation (15). The initial molar amounts of A and B can be calculated using equations (16) and (17), and the initial total pressure can be calculated using equation (18).

$$
P_A = \frac{n_ART}{V} \tag{12}
$$

$$
P_B = \frac{n_BRT}{V} \tag{13}
$$

$$
P_D = \frac{n_DRT}{V} \tag{14}
$$

$$
\dot Q = UA\left( T_{ex} - T \right) \tag{15}
$$

$$
n_{A,0} = \frac{P_{A,0}V}{RT} \tag{16}
$$

$$
n_{B,0} = \frac{P_{B,0}V}{RT} \tag{17}
$$

$$
P_0 = P_{A,0} + P_{B,0} \tag{18}
$$

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

The assignment does not provide a numerical value for $t_{rxn}$ to use as the stopping criterion, so it is either a missing value or an adjusted value. In this assignment, I am asked to find the value of $t_{rxn}$ that maximizes the yield. To do that, I will select a range of values for $t_{rxn}$, calculate the yield for each one, and plot the results. Then I'll identify the maximum from the graph. Thus, for this assignment, $t_{rxn}$ is an adjusted value.

:::

**Adjusted Value**: $t_{rxn}$

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

The third step in the general approach for completing isolated reactor modeling assignments is to use the results from solving the reactor design equations to calculate the responses of interest. The response function will be passed values for the reaction time. Given those values, the reactor design equations can be solved numerically to find the final values of the dependent variables, $n_A$, $n_B$, $n_D$, $n_Z$, $n_U$, $T$, and $P$ at $t=t_{rxn}$. Those results must then be used to calculate the responses to be returned by the response function. In this assignment the responses of interest are the yield and the conversion of A. Both of these can be calculated using their definitions, @eq-yield_def_closed and @eq-conversion_def_closed.

:::

**Response Calculation**

After solving the reactor design equations, the yield and conversion can be calculated using equations (19) and (20).

$$
Y_{D/A} = \frac{n_D}{n_{A,0}} \tag{19}
$$

$$
f_A=\frac{n_{A,0}-n_A}{n_{A,0}} \tag{20}
$$

**Response Function**

The response function is created with the following structure:

* It is passed a set of values of $t_{rxn}$ as an argument.
* Variables are defined and assigned the values of all known and given quantities: $P_{A,0}=1\text{ atm}$, $P_{B,0}=2\text{ atm}$, $T_0 = 25\text{ °C}$, $V= 2\text{ L}$, $A= 600\text{ cm}^2$, $U= 0.6 \text{ cal cm}^{-2} \text{ min}^{-1}\text{ K}^{-1}$, $T_e =30\text{ °C}$, $k_{0,1} =  3.34 \times 10^9 \text{ mol cm}^{-3}\text{ min}^{-1}\text{ atm}^{-2}$, $k_{0,2} = 4.99 \times 10^9 \text{ mol cm}^{-3}\text{ min}^{-1}\text{ atm}^{-2}$, $E_1= 20.5\text{ kcal mol}^{-1}$, $E_2= 21.8\text{ kcal mol}^{-1}$, $\Delta H_1= -6,300 \text{ cal mol}^{-1}$, $\Delta H_2= -6,900 \text{ cal mol}^{-1}$, $\hat C_{p,A}= 7.4 \text{ cal mol}^{-1}\text{ K}^{-1}$, $\hat C_{p,B}= 8.6 \text{ cal mol}^{-1}\text{ K}^{-1}$, $\hat C_{p,D}= 10.7 \text{ cal mol}^{-1}\text{ K}^{-1}$, $\hat C_{p,Z}= 5.2 \text{ cal mol}^{-1}\text{ K}^{-1}$ and $\hat C_{p,U}= 10.3 \text{ cal mol}^{-1}\text{ K}^{-1}$.
* A function is defined that evaluates the derivatives in the design equations given values of the independent variable, $t$, and the dependent variables, $n_A$, $n_B$, $n_D$, $n_Z$, $n_U$, $T$, and $P$. Specifically, it
	* Calculates $P_A$, $P_B$, and $P_D$ using equations (12), (13), and (14).
	* Calculates $r_1$ and $r_2$ using equations (3) and (4).
	* Calculates $\dot{Q}$ using equation (15).
	* Evaluates and returns the values of the derivatives, equations (5) through (11).
* For each value of $t_{rxn}$ that is passed to the response function, the response function then
	* Calculates $n_{A,0}$, $n_{B,0}$, and $P_0$ using equations (16), (17) and (18).
	* Solves the design equations using the function defined above and the initial values and stopping criterion in @tbl-example_13_3_initial_values to find $n_A$, $n_B$, $n_D$, $n_Z$, $n_U$, $T$, and $P$ at $t=t_{rxn}$.
	* Calculates and saves $Y_{D/A}$, and $f_A$ using equations (19) and (20).
* Returns the sets of values of $Y_{D/A}$, and $f_A$ corresponding to the values of $t_{rxn}$ passed to it.

:::{.callout-note collapse="false"}
## Note

In this particular assignment it was possible to pass a vector containing many values of $t_{rxn}$ to the response function. The response function could then solve the reactor design equations and calculate the responses of interest for all of those reaction times, and return them as vectors.

This is not always possible. In situations where this can't be done, the response function would need to be called separately for each reaction time.

:::

**Calculations**

1. The response function is called, passing to it a vector containing a range of values of $t_{rxn}$. (Note the range of values may need to be adjusted).
2. The response function returns vectors containing the corresponding values of $Y_{D/A}$, and $f_A$.
3. The values of $Y_{D/A}$ are plotted against $t_{rxn}$.
4. The graph resulting from step 3 is inspected.
	a. If it shows a maximum, the value of $t_{rxn}$ corresponding to the maximum value of $Y_{D/A}$ and the maximum value of $Y_{D/A}$ are two of the quantities of interest. The conversion of A at the value of $t_{rxn}$ corresponding to the maximum value of $Y_{D/A}$ is the other quantity of interest.
	b. If it does not show a maximum, the range of values of $t_{rxn}$ is adjusted and steps 2 through 4 are repeated.

:::{.callout-note collapse="false"}
## Note

Once a maximum has been found graphically, the process can be repeated using a large number of values of $t_{rxn}$ packed into a small range that includes the maximum. This will improve the accuracy of the results. These results need not be plotted. Instead they can be tabulated. The largest value of $Y_{D/A}$ can then be identified, and the corresponding value of $t_{rxn}$ can be read from the same row of the table.

:::

**Results**

```{r}
#| echo: false
#| output: false
df <- read.csv(paste0(path_to_results,'reb_13_3_results.csv'))
```

The calculations were performed as described above. The resulting plot of yield *vs*. reaction time is shown in @fig-example_13_3_yield_plot. The maximum yield, `r df$value[2]``r df$units[2]`, occurs at a reaction time of `r df$value[1]` `r df$units[1]`. The conversion of A at that reaction time is `r df$value[3]``r df$units[3]`.

![Yield of D as the reaction time varies.](`r paste0(path_to_figures,'reb_13_3_yield_plot.png')`){#fig-example_13_3_yield_plot width="80%"}

**Summary and Comments**

Reactions (1) and (2) constitute a series-parallel reaction network. The desired product, D, is an intermediate product. It is produced in reaction (1) and consumed in reaction (2). Assuming that the temperature affects the two reactions equally, the yield of an intermediate product is expected to pass through a maximum as the reaction time increases as seen in @fig-example_13_3_yield_plot.

The reason for the maximum is qualitatively easy to understand. At the start of the reaction, the rate of reaction (1) will be positive while that for reaction (2) will be zero. Thus, initially the amount of D will increase as can be seen in @fig-example_13_3_yield_plot. After a very small interval of time, the rate of reaction (1) will have decreased slightly due to the decreasing concentration of reactant A while the rate of reaction (2) will have increased due to the increasing concentration of reactant D. For as long as the rate of reaction (2) remains smaller than the rate of reaction (1), the amount of D will be increasing, but at a smaller and smaller rate. This can be seen in @fig-example_13_3_yield_plot where the curvature of the yield plot is initially concave downward,

Eventually, the rate of reaction (2) will become equal to the rate of reaction (1). For that instant in time, the amount of D will not be changing. This corresponds to the maximum in @fig-example_13_3_yield_plot. At times beyond the maximum, the rate of reaction (1) will be smaller than the rate of reaction (2), so the concentration of D will decrease. As the concentrations of both reactants, A and D, continue to decrease, both reactions (1) and (2) will become slower and slower. This can be seen at larger reaction times in @fig-example_13_3_yield_plot where the curve is concave upward. Eventually, at very large reaction time, the rates will equal zero.

:::{.callout-note collapse="false"}
## Note

In this example series-parallel reactions are occurring where the desired product is produced in one reaction and consumed by another. In this situation it is often found that the reaction time has the greatest effect upon the amount of the desired product, as was the case here. Other process parameters such as the temperature will also affect the results, but often their effect on the amount of desired product is weaker. Temperature can be an effective parameter for adjusting the selectivity of multiple reactions if the activation energies of the reactions differ significantly.

:::

### Optimization of Net Production Rate {#sec-example_13_4}

{{< include ../RE_Basics_Examples/reb_13_4/problem_statement.qmd >}}

```{r}
#| echo: false
#| output: false
path_to_data <- './Data/'
path_to_results <- '../RE_Basics_Examples/reb_13_4/Results/'
path_to_figures <- './Graphics/'
```

---

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

Using the criteria presented in @sec-5_response_opt_design, this is an isolated reactor modeling assignment. The system consists of a BSTR and no other equipment. The reactor and its operation are described. The reaction taking place is indentified and its rate expression is provided, and it asks for a reactor input, namely the coolant flow rate. Additionally, this is an optimization assignment because the coolant flow rate of interest is the one that maximizes the net rate of production of Z.

Having identified this as an isolated reactor optimization assignment, I know the general approach to take to complete it, again from @sec-5_response_opt_design. I will need to select the reactor design equations needed to model the system, formulate their solution (assuming missing reactor inputs and process parameters will be provided), formulate the calculation of the response of interest (here the net rate of production of Z), create a response function that incorporates those formulations, and use the response function to calculate the quantities of interest. Being an optimization assignment, I'll do that by selecting a range of values of the coolant flow rate, calculate the net rate for each of them, plot the results, and identify the maximum net rate using the graph.

To get started, I'll summarize the information provided in the assignment. I'll use a subscripted "ex" to denote quantities related to the jacket and "coil" to denote quantities related to the coil. I'll use a subscripted "0" to denote initial values of quantities, a subscripted "1" to denote quantities at the time the temperature reaches 50 °C, and a subscripted "f" to denote quantities at the end of the processing steps.

:::

**Reactor**:  BSTR

**Given**: $k_{0,1}$ = 2.59 x 10^9^ min^-1^, $E_1$ = 16.5 kcal mol^-1^, $\Delta H_1$ = -22,200 cal mol^-1^, $C_{A,0}$ = 2 M, $T_0$ = 23 °C, $\breve{C}_p$ = 440 cal L^-1^ K^-1^, $V$ = 4.0 L, $V_{ex}$ = 0.5 L, $A_{ex}$ = 0.6 ft^2^, $U_{ex}$ = 1.13 x 10^4^ cal ft^-2^ h^-1^ K^-1^, $T_{ex,in}$ = 20 °C, $\rho_{ex}$ = 1 g cm^-3^, $\tilde{C}_{p,ex}$ = 1 cal g^-1^ K^-1^, $U_{coil}$ = 3.8 x 10^4^ cal ft^-2^ h^-1^ K^-1^, $A_{coil}$ =  0.23 ft^2^, $T_{coil}$ = 120 °C, $T_{ex,0}$ = 23 °C, $\dot{m}_{ex,0}$ = 0, $T_1$ = 50 °C, $T_f$ = 25 °C, $t_{turn}$ = 25 min.

**Quantities of Interest**: $\dot{m}_{ex,opt} = \underset{\dot{m}_{ex}}{\arg\max} \left(r_{Z,net}\right)$, $\underset{\dot{m}_{ex}}{\max} \left(r_{Z,net}\right)$, $f_A\left(t\right)\Big\vert_{\dot{m}_{ex,opt}}$, $T\left(t\right)\Big\vert_{\dot{m}_{ex,opt}}$

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

I need to write the reactor design equations needed to model this system. The reactor design equations always include at least one mole balance. The general BSTR mole balance is given in @eq-bstr_mole_balance.  I'll write a mole balance for both of the reagents in this system, noting that the sum reduces to a single term since only one reaction is taking place.

$$
\frac{dn_i}{dt} = V \sum_j \nu_{i,j}r_j
$$

The BSTR is not isothermal, so I must include an energy balance on the reacting fluid among the design equations. The general BSTR mole balance is given in @eq-bstr_energy_balance. Assuming the liquid to be incompressible and the reactor walls to be rigid, both the pressure and volume will be constant, so their time-derivatives will equal zero. The work associated with mixing the reactor can also be assumed to be negligible.

$$
\left(\sum_i n_i \hat C_{p,i} \right) \frac{dT}{dt} - V\cancelto{0}{\frac{dP}{dt}}  - P  \cancelto{0}{\frac{dV}{dt}}  = \dot Q - \cancelto{0}{\dot W} - V \sum_j \left(r_j \Delta H_j \right)
$$

There is only one reaction occurring, so the final sum will reduce to a single term. In addition, the assignment provides the volumetric heat capacity of the entire solution, so the sensible heat term can be written in terms of that heat capacity, @eq-bstr_equivalent_sens_heat_terms. Heat is exchanged with both the cooling water and the steam, so the rate of heat exchange must be split into two terms

$$
\left(\sum_i n_i \hat C_{p,i} \right) \frac{dT}{dt}\ \Leftrightarrow\  V \breve C_p \frac{dT}{dt}
$$

$$
\dot{Q} = \dot{Q}_{ex} + \dot{Q}_{coil}
$$

There are two heat exchange fluids in this system. The water in the jacket exchanges sensible heat so the energy balance on it is given by @eq-exchange_energy_bal_sensible. Noting that the heat capacity is constant, the integral is easily evaluated.

$$
\rho_{ex} V_{ex} \tilde C_{p,ex}\frac{dT_{ex}}{dt} = -\dot{Q}_{ex} - \dot m_{ex} \int_{T_{ex,in}}^{T_{ex}} \tilde C_{p,ex}dT
$$

The steam in the coil exchanges latent heat, so the its temperature is known and constant. As a consequence, the mole balances, energy balance on the reacting fluid and energy balance on the cooling water can be solved independently of the energy balance on the steam. The problem does not ask any questions about the steam flow rate or how much of it condenses, so an energy balance on the steam is not needed.

Momentum balances are not used for stirred tank reactors, so the full set of reactor design equations consists of mole balances on A and Z, an energy balance on the reacting fluid and an energy balance on the cooling water.

:::

**Reactor Model**

Mole balances on A and Z are presented in equations (3) and (4). An energy balance on the reacting fluid is given in equation (5), and an energy balance on the cooling water in equation (6).

$$
\frac{dn_A}{dt} = -Vr_1 \tag{3}
$$

$$
\frac{dn_Z}{dt} = Vr_1 \tag{4}
$$

$$
V \breve C_p \frac{dT}{dt}  = \dot{Q}_{ex} + \dot{Q}_{coil}  - Vr_1 \Delta H_1 \qquad \Rightarrow \qquad \frac{dT}{dt} = \frac{\dot{Q}_{ex} + \dot{Q}_{coil}  - Vr_1 \Delta H_1}{V \breve C_p} \tag{5}
$$

$$
\rho_{ex} V_{ex} \tilde C_{p,ex}\frac{dT_{ex}}{dt} = -\dot{Q}_{ex} - \dot m_{ex} \tilde{C}_{p,ex} \left(T_{ex} - T_{ex,in}\right)
$$

$$
\frac{dT_{ex}}{dt} = -\left(\frac{\dot{Q}_{ex} + \dot m_{ex} \tilde{C}_{p,ex} \left(T_{ex} - T_{ex,in}\right)}{\rho_{ex} V_{ex} \tilde C_{p,ex}}\right) \tag{6}
$$

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

The reactor design equations, (3) through (6), are initial value ordinary differential equations (IVODEs), so initial values and a stopping criterion are needed. I could analyze the entire process all at once, but here I'm going to analyze it as two phases: the heating phase and the cooling phase.

The instant the solution is added to the reactor can be defined as $t=0$. This marks the start of the heating phase. The molar amounts of A, $n_{A,0}$, and Z, 0.0 (only A is present initially), the reacting fluid temperature, $T_0$, and the cooling water temperature, $T_{ex,0}$, at that time are then the initial values for the analysis of the heating phase. It ends when the reacting fluid reaches $T_1 = 50 °C$.

The cooling phase begins the instant the heating phase ends, so the initial values for the cooling phase are the final values from the heating phase. The cooling phase ends when the reacting fluid cools down to $T_f = 25 °C$, so that is the stopping criterion for the cooling phase.

:::

The initial values and stopping criterion for solving the reactor design equations for the heating phase are presented in @tbl-example_13_4_heating_initial_values. If $t_1$, $n_{A,1}$, $n_{Z,1}$, and $T_{ex,1}$ represent the values of $t$, $n_A$, $n_Z$, and $T_{ex}$ at the end of the heating phase, those values are also the intial values for the cooling phase, which ends when $T = T_f$. Thus, the initial values and stopping criterion for the coolling phase are given in @tbl-example_13_4_cooling_initial_values

| Variable | Initial Value | Stopping Criterion |
|:-------|:-------:|:-------:|
| $t$ | $0$ | |
| $n_A$ | $n_{A,0}$ | |
| $n_Z$ | 0 | |
| $T$ | $T_0$ | $T_1$ |
| $T_{ex}$ | $T_{ex,0}$ | |
  
: Initial values and stopping criterion for solving the design equations, (3) through (6), for the heating phase of the process. {#tbl-example_13_4_heating_initial_values tbl-colwidths="[20, 40, 40]"}


| Variable | Initial Value | Stopping Criterion |
|:-------|:-------:|:-------:|
| $t$ | $t_1$ | |
| $n_A$ | $n_{A,1}$ | |
| $n_Z$ | $n_{Z,1}$ | |
| $T$ | $T_1$ | $T_f$ |
| $T_{ex}$ | $T_{ex,1}$ | |
  
: Initial values and stopping criterion for solving the design equations, (3) through (6), for the cooling phase of the process. {#tbl-example_13_4_cooling_initial_values tbl-colwidths="[20, 40, 40]"}

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

In order to solve the reactor design equations, every quantity appearing in them or substituted into them must be expressed in terms of known constants, the independent variable, $t$, and the dependent variables, $n_A$, $n_Z$, $T$, and $T_{ex}$. The initial values and stopping criterion must also be calculated.

Looking at the reactor design equations, I see that $V$, $\breve{C}_p$, $\Delta H_1$, $\rho_{ex}$, $\tilde{C}_{p,ex}$, and $T_ex,in$ are known constants. The water flow rate, $\dot{m}_{ex}$, will equal 0 until the reacting fluid temperature reaches 50 °C. After that, $\dot{m}_{ex}$ will be constant with a value that will be provided at the time the reactor design equations are solved.

The reaction rate, $r_1$, is given by equation (2); it introduces $k_1$ and $C_A$ when it is substituted into the design equations. The rate coefficient can be expressed in terms of known constants ($k_{0,1}$, $E_1$, and the gas constant, $R$) using the Arrhenius expression, @eq-arrhenius. The concentration of A can be expressed in terms of the molar amount of A and the volume using the definition of concentration.

The rate of heat exchange between the water in the jacket and the reacting fluid can be expressed in terms of the known constants, $A_{ex}$ and $U_{ex}$, and the jacket and reacting fluid temperatures. Similarly, the rate of heat exchange between the steam in the coil and the reacting fluid can be expressed in terms of the kknown constants, $U_{coil}$, $A_{coil}$, and $T_{coil}$ = 120 °C, and the reacting fluid temperature. However, the coil only exchanges heat until the reacting fluid reaches 50 °C.

The initial moles of A can be calculated from the known initial concentration of A and the volume.

:::

**Ancillary Equations**

The water flow rate is given by equation (7), and the rate of heat exchange with the steam by equation (8). Both of these terms change when the heating phase ends and the cooling phase begins. The rate of heat exchange between the water in the jacket and the reacting fluid is given by equation (9).

$$
\dot{m}_{ex} \big\vert_{t \lt t_1} = 0 \qquad \qquad \dot{m}_{ex} \big\vert_{t \ge t_1} = \dot{m}_{ex} \tag{7}
$$

$$
\dot{Q}_{coil}\big\vert_{t \lt t_1} = U_{coil} A_{coil} \left(T_{coil} - T\right) \qquad \qquad \dot{Q}_{coil}\big\vert_{t \ge t_1} = 0 \tag{8}
$$

$$
\dot{Q}_{ex} = U_{ex} A_{ex} \left(T_{ex} - T\right) \tag{9}
$$

The rate is given by equation (2), where the rate coefficient is found using equation (10) and the concentration of A is found using equation (11). The initial molar amount of A can be calculated using equation (12).

$$
k_1 = k_{0,1}\exp{\left( \frac{-E_1}{RT} \right)} \tag{10}
$$

$$
C_A = \frac{n_A}{V} \tag{11}
$$

$$
n_{A,0} = C_{A,0}V \tag{12}
$$

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

At this point, the only thing needed in order to solve the design equations is the value of the cooling water flow rate, $\dot{m}_{ex}$. Because this is an optimization problem, I will adjust its value so I can create data for a plot of conversion *vs*. coolant flow rate. Assuming that value will be provided when needed, the design equations can be solved to find $n_A$, $n_Z$, $T$, and $T_{ex}$ at times between $t=0$ and the time, $t_f$, when the reactor cools to 25 °C. The conversion as a function of processing time can be calculated using its definition, @eq-conversion_def_closed. The final time and the final molar amount of A can then be used to calculate the net rate of production of Z, using @eq-bstr_net_rate.

:::

**Adjusted Value**: $\dot{m}_{ex}$

**Response Calculation**

Solving the reactor design equations will yield $n_A\left(t\right)$ and $T\left(t\right)$ directly. The conversion as a function of reaction time can then be calculated using equation (13). The final reaction time, $t_f$, and the final molar amount of Z, $n_Z$, can be used to calculate the net rate of production of Z using equation (14).

$$
f_A\left(t\right) = \frac{n_{A,0} - n_A\left(t\right)}{n_{A,0}} \tag{13}
$$

$$
r_{Z,net} = \frac{n_Z}{t_f + t_{turn}} \tag{14}
$$

**Response Function**

The response function is created with the following structure:

* The adjusted value, that is the coolant flow rate, $\dot{m}_{ex}$, is passed to the response function as an argument.
* Variables are defined and assigned the values of all known and given quantities: $k_{0,1}$ = 2.59 x 10^9^ min^-1^, $E_1$ = 16.5 kcal mol^-1^, $\Delta H_1$ = -22,200 cal mol^-1^, $C_{A,0}$ = 2 M, $T_0$ = 23 °C, $\breve{C}_p$ = 440 cal L^-1^ K^-1^, $V$ = 4.0 L, $V_{ex}$ = 0.5 L, $A_{ex}$ = 0.6 ft^2^, $U_{ex}$ = 1.13 x 10^4^ cal ft^-2^ h^-1^ K^-1^, $T_{ex,in}$ = 20 °C, $\rho_{ex}$ = 1 g cm^-3^, $\tilde{C}_{p,ex}$ = 1 cal g^-1^ K^-1^, $U_{coil}$ = 3.8 x 10^4^ cal ft^-2^ h^-1^ K^-1^, $A_{coil}$ =  0.23 ft^2^, $T_{coil}$ = 120 °C, $T_{ex,0}$ = 23 °C, $\dot{m}_{ex,0}$ = 0, $T_1$ = 50 °C, $T_f$ = 25 °C, $t_{turn}$ = 25 min.
* A function is defined that evaluates the derivatives in the design equations given values of the independent variable, $t$, and the dependent variables, $n_A$, $n_Z$, $T$, and $T_{ex}$. Specifically, it
	* Sets the value of $\dot{m}_{ex}$ according to equation (7).
	* Calculates $\dot{Q}_{coil}$, $\dot{Q}_{ex}$, $k_1$, and $C_A$ using equations (8) through (11).
	* Calculates $r_1$ using equation (2).
	* Evaluates and returns the values of the derivatives, equations (3) through (6).
* The response function then
	* Calculates $n_{A,0}$ using equation (12).
	* Solves the design equations for the heating phase using the function defined above and the initial values and stopping criterion in @tbl-example_13_4_heating_initial_values to find the final values of $t_1$, $n_{A,1}$, $n_{Z,1}$, and $T_{ex,1}$.
	* Solves the design equations for the cooling phase using the initial values and stopping criterion in@tbl-example_13_4_cooling_initial_values to find the values of $t$, $n_A$, $n_Z$, $T$, and $T_{ex}$ at the end of the processing.
	* Calculates the conversion as a function of reaction time using equation (13) and the net rate of production of Z using equation (14).
	* Returns the net rate of production of Z and vectors containing the reaction time, conversion and reacting fluid temperature.

**Calculations**

1. A range of values of $\dot{m}_{ex}$ is chosen. (Note the range of values may need to be adjusted.)
2. The response function is used to calculate $r_{Z,net}$ for each value of $\dot{m}_{ex}$.
3. The resulting values of $r_{Z,net}$ are plotted against $\dot{m}_{ex}$.
4. The graph produced in step 3 is inspected.
	a. If it shows a maximum, the value of $\dot{m}_{ex}$ corresponding to the maximum value of $r_{Z,net}$ and the maximum value of $r_{Z,net}$ are the quantities of interest.
	b. If it does not show a maximum, the range of values of $\dot{m}_{ex}$ is adjusted and steps 2 through 4 are repeated.
5. The response function is used to calculate $t$, $f_A\left(t\right)$, and $T\left(t\right)$ using the optimum coolant rate found in step 4.
6. The conversion and reacting fluid temperature are plotted *vs*. the reaction time.

:::{.callout-note collapse="false"}
## Note

Once a maximum has been found graphically, the process can be repeated using a large number of values of $\dot{m}_{ex}$ packed into a small range that includes the maximum. This will improve the accuracy of the results. These results need not be plotted. Instead they can be tabulated. The largest value of $r_{Z,net}$ can then be identified, and the corresponding value of $\dot{m}_{ex}$ can be read from the same row of the table.

:::

**Results**

```{r}
#| echo: false
#| output: false
df <- read.csv(paste0(path_to_results,'reb_13_4_results.csv'))
```

The calculations were performed as described above. The net rate of production of Z is plotted as a function of the cooling water flow rate in @fig-example_13_4_net_rate_plot. The maximum net rate, `r df$value[1]` `r df$units[1]`, occurs at a coolant flow rate of `r df$value[2]` `r df$units[2]`. The conversion and reacting fluid temperature profiles at that coolant flow rate are shown in @fig-example_13_4_conversion_profile and @fig-example_13_4_temperature_profile. Knowing the initial concentration of A and the Arrhenius parameters, the conversion and temperature profiles were used to calculate the reaction rate profile shown in @fig-example_13_4_rate_profile, where the rate scale is logarithmic.

![Net rate of production of Z as cooling water flow rate varies.](`r paste0(path_to_figures,'reb_13_4_net_rate_plot.png')`){#fig-example_13_4_net_rate_plot width="80%"}

![Conversion profile during processing with the optimum coolant flow rate.](`r paste0(path_to_figures,'reb_13_4_conversion_profile.png')`){#fig-example_13_4_conversion_profile width="80%"}

![Temperature profile during processing with the optimum coolant flow rate.](`r paste0(path_to_figures,'reb_13_4_temperature_profile.png')`){#fig-example_13_4_temperature_profile width="80%"}

![Instantaneous reaction rate profile during processing with the optimum coolant flow rate.](`r paste0(path_to_figures,'reb_13_4_rate_profile.png')`){#fig-example_13_4_rate_profile width="80%"}

**Summary and Comments**

At the initial conditions, the instantaneous rate of reaction is extremely small as can be seen in @fig-example_13_4_rate_profile, and consequently conversion of A initially increases very slowly, @fig-example_13_4_conversion_profile. For this reason, the steam heating coil is used to heat the reacting fluid to 50 °C. This requires ca. 3.5 min and can be seen in @fig-example_13_4_temperature_profile and @fig-example_13_4_net_rate_plot as an abrupt decrease in the slope at that time.

Once the steam heating coil is removed, heat is being generated due to the heat of reaction and simulataneously heat is being removed by transfer to the cooling water in the jacket. The rate of heat generation must be greater than the rate of heat removal, because @fig-example_13_4_temperature_profile shows that the temperature continues to rise.

As the reaction proceeds, the temperature is increasing while the concentration of reactant A is decreasing due to consumption by reaction. The increasing temperature alone would cause the rate to increase while the decrease in reactant concentration, alone, would cause the rate to decrease. As is very often the case, the effect of increasing temperature is stronger than the effect of decreasing concentration, so the rate increases. This, in turn, causes the temperature to rise even faster, as can be seen in the temperature profile just after the end of the heating phase where the profile is concave downward.

Eventually the effects upon the rate of increasing temperature and decreasing concentration become equal. This corresponds to the maximum in the instantaneous reaction rate profile, @fig-example_13_4_rate_profile, at ca `r df$value[4]` `r df$units[4]`. At this point, the temperature profile, @fig-example_13_4_temperature_profile, displays an inflection point. For a brief period after the rate reaches its maximum, the temperature continues to rise, reaching a maximum value of `r df$value[5]` `r df$units[5]` at ca. `r df$value[6]` `r df$units[6]`. This happens because while the rate is starting to decrease, the reaction is still generating heat faster than the cooling water is removing it.

Once the temperature passes through its maximum, heat is being removed by transfer to the cooling water in the jacket faster than it is being generated by reaction. As a result the temperature and rate decrease steadily. Nonetheless, the conversion had already reached `r df$value[7]``r df$units[7]` when the temperature started to decrease and ultimately increased to `r df$value[8]``r df$units[8]` by the time the reacting fluid cooled to 25 °C.

:::{.callout-note collapse="false"}
## Note

In this example, the net rate of reaction was maximized with respect to the cooling water flow rate. It might be possible to improve the process further by adjusting both the cooling water flow rate *and* the temperature where the heating coil is removed. If that were done, the graphical approach used here to maximize the net rate would not be the best mathematical approach. Instead, a reaction engineer might use software designed for multivariable optimization.

:::


## Symbols Used in @sec-5_bstr_analysis

| Symbol | Meaning |
|:-------|:--------|
| $i$ | index denoting a reagent. |
| $n_i$ | molar amount of reagent $i$, an additional subscripted 0 denotes the initial molar amount. |
| $r_{i,net}$ | net rate of generation of reagent $i$. |
| $t_{rxn}$ | lenght of time during which reaction occurs. |
| $t_{turn}$ | turnaround time. |

: {tbl-colwidths="[20,80]"}
