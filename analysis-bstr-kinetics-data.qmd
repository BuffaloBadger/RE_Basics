# Analysis of Kinetics Data from a BSTR {#sec-bstr-data-analysis}

@sec-kin-data-gen presented an overview of the design of kinetics experiments and the generation and analysis of kinetics data. This chapter focuses specifically on using reactors for those activities that conform to the assumptions of the ideal BSTR model described in @sec-modeling-ideal-reactors and [Appendix -@sec-ideal-reactor-models]. The most critical aspect of the ideal BSTR model is the assumption of perfect mixing, so the chapter begins with a few examples of devices that can be modeled as ideal BSTRs.

## Laboratory BSTRs

The name Batch *Stirred Tank* Reactor may conjure up a mental image of a BSTR as a vessel shaped much like a simple laboratory beaker, but perhaps fabricated from metal, with some means of stirring the contents vigourously. In fact, it is quite possible to use a simple beaker or Erlenmeyer flask placed on a heated magnetic stir plate and equipped with magnetic stir bar as a BSTR. When a round-bottomed flask like that shown in @fig-laboratory_bstr is used, the rotating shaft from a motor extends through a neck and into the flask. The shaft has a paddle on its end that is curved to match the bottom of the flask. As the paddle rotates, it mixes the contents of the reactor. The reactor shown in the figure has two additional necks that can be used, for example, to insert a thermometer and to withdraw samples for analysis. This particular flask has a jacket that surrounds the reactor. A heating or cooling fluid can be circulated through that jacket using the inlet and outlet ports seen on the sides of the vessel. There is also a stopcock at the bottom that can be opened to drain the BSTR when the experiments are complete. 

![Round-bottomed flask used as a laboratory BSTR.](Graphics/laboratory_stirred_tank_reactor.png){#fig-laboratory_bstr width=70%}

For higher pressure reactions, a metal "autoclave" can be used. The top of this type of autoclave is a flange with a gasket that can be bolted onto the reactor to seal it for use at higher pressures. Typically autoclaves can be heated or cooled and they use a shaft and paddle for agitation. Special fittings or magnetic couplings are used so that the rotating shaft can pass into the autoclave without allowing the high pressure contents to leak out.

In fact, devices that do not resemble a stirred beaker can also be used as BSTRs for kinetics data generation. The primary requirement is that the contents of the reactor be perfectly mixed. As an example, @fig-batch_recirc_reactor shows a recirculation loop reactor. Fluid is rapidly recirculated in the reactor by a pump. In-line mixing devices can be placed in the flow path to promote thorough mixing of the fluid. The reactor must be operated at a very high recirculation rate, and for isothermal operation, the pump and other components all must be maintained at the same constant temperature. If heterogeneous catalytic reactions are being studied, a packed catalyst bed can be inserted somewhere within the loop. In this case, the amount of reactant converted during a single pass through the bed should be very small so that the compositions at the beginning and at the end of the bed are essentially equal. In this way the composition in the loop will change with time, but within it, the composition will be essentially uniform everywhere, just as the batch reactor model assumes. A recirculation reactor such as that shown in @fig-batch_recirc_reactor is particularly useful for the study of a single gas phase reaction that involves a change in the total number of moles. In such a system, if the initial composition, temperature and pressure are known, the composition at any other time can be found from a measurement of the total pressure. Thus kinetics data can be measured simply by recording the total pressure as a function of time.

![Batch recirculation loop reactor schematic.](Graphics/batch_recirculation_schematic.png){#fig-batch_recirc_reactor width="60%"}

The stopped flow reactor, shown schematically in @fig-stopped_flow_reactor, is a batch reactor that is especially useful for the study of rapid, liquid-phase, bimolecular reactions. Solutions containing the reactants are fed in separate streams to a small mixing chamber. This chamber is designed so that the fluids enter as high velocity jets. The high velocity of these jets causes instantaneous, perfect mixing when the jets enter the reactor. Downstream from the mixing chamber, but still near to it, a detector is located. Typically the detector is a spectrophotometer. This device shines radiation of a given frequency through the fluid and measures how much of the radiation is absorbed. The frequency of the radiation is chosen so that only one of the reactants or products absorbs the radiation. In this way the response from the spectrophotometer is directly proportional to the amount of that one reactant or product. In a typical experiment the fluids begin flowing and a steady state is established. The flow is then stopped instantaneously, and the response of the spectrophotometer is recorded as a function of time. The instant the flow stops, the volume through which the radiation passes becomes a very small batch reactor.

![Stopped-flow reactor schematic.](Graphics/stopped_flow_schematic.png){#fig-stopped_flow_reactor width=80%}

### Testing the Ideality of a BSTR

Before a laboratory BSTR is used to generate kinetics data, it should be tested to ensure that it conforms to the assumptions of an ideal BSTR. The most important assumption is that of perfect mixing. If the reactor walls are transparent or if there is a window in the walls, a "smoke test" is a simple way to check the mixing. To perform this kind of test a small amount of colored fluid is added to the reactor. For a gas phase reactor the added fluid is some form of smoke, for a liquid phase system it is often a colored dye. The contents of the reactor are observed at the instant the smoke or dye is added. The smoke of dye should instantaneously mix and fill the entire contents of the reactor. Importantly, there should not be any "corners" or other locations where the color changes slowly. Locations where the color changes slowly are called stagnant zones. They are places where the mixing is not perfect.

A second way of testing the assumption of perfect mixing involves performing the same experiment several times. Each time the experiment is repeated, the only difference from the other experiments is the rate of agitation. That is, a different stirrer speed or recirculation rate is used in each experiment. As the agitation rate is increased in successive experiments, a point should be reached where the experimental results are identical to the previous experiment. At that rate of agitation, the assumption of perfect mixing can be assumed to be satisfied. In subsequent experiments where kinetics data are being generated, an agitation rate somewhat above that critical rate should then be used.

## BSTR Kinetics Experiments and Data

In @sec-kin-data-gen it was recommended that experiments for the generation of kinetics data be performed in blocks where all of the experiments in any one block occur at the same temperature. The basis for this recommendation is that rates are typcially more strongly affected by changes in temperature than by changes in composition. If both temperature and composition change between two experiments, the stronger temperature effects may mask the more subtle composition effects.

In order to follow that recommendation, reactors being used to generate kinetics data should operate isothermally. In *Reaction Engineering Basics* it is always assumed that kinetics data have been generated using an isothermal reactor wherein only one reaction is occurring. If the kinetics data will be analzed using a linearized reactor model (see @sec-kin-data-gen and below), there is a second reason for operating a BSTR isothermally. If the reactor is isothermal, it is possible to write only one mole balance, and that mole balance can be solved separately from the energy balance. If the reactor is non-isothermal, the energy and mole balances must be solved simultaneously, and this will typically make it very difficult or even impossible to linearize the reactor model.

In a typical BSTR kinetics experiment, the reactants are first loaded into the reactor; this is also called charging the reactor. If the charge to the reactor has not been pre-heated, then once the reagents are in the vessel, it may be necessary to heat the contents to the desired temperature. If the reaction being studied involves two or more reactants, they can be pre-heated separately to the desired temperature before adding them to the reactor. Alternatively, it may be necessary to add catalyst to start the reaction.

In any of these situations, **as soon as the reactor is charged and has stabilized at the desired temperature**, the "initial composition" is analyzed. The kinetics experiment is taken to begin at the instant the initial composition is analyzed. The reaction then is allowed to proceed over time. Periodically during this period the elapsed time and some quantity that can be related to the composition (the response) are recorded. As such, each experiment typically yields multiple measurements of the response variable.

## Design of BSTR Experiments

The purpose of kinetics experiments is to generate kinetics data that can be used to develop a rate expression. Generally there will be a critical range of temperatures and critical ranges of the concentration of each reagent within which the rate expression needs to be as accurate as possible. The experiments should be designed so that the temperature and each concentration (or partial pressure) spans its critical range. A factorial design like that described in @sec-kin-data-gen then can be used.

### Adjusted Experimental Inputs

As already noted, each BSTR experiment will be isothermal, so one of the experimental adjusted reactor inputs will be the reactor temperature. The number of different temperatures to be used will depend upon the critical range of the temperature. If the rate expression needs to be accurate over a range of 150 °C, a greater number of temperatures should be studied than if it needs to be accurate over a range of 30 °C.

Two experimental inputs affect the concentrations of the reagents during the experiments. One is the initial composition at the start of the experiment. In any one experiment, the composition will change continually as the reaction proceeds, so responses measured at different elapsed times during the same experiment will correspond to different compositions. It makes sense to measure the response as many times as possible during each experiment to minimize the time and cost of the experimental study. Consequently the temperature and the initial concentration are the primary inputs that are adjusted from experiment to experiment, with as many response measurements as possible or practical during each experiment. These were the adjusted experimental inputs specified in [Example -@sec-example_7_1].

The number of times the response can be measured may be determined by the time it takes to make the measurement. For example changes in the absorbance radiation at a particular frequency where one reactant or product absorbs can be measured almost continuously, but analysis using gas chromatography may require several minutes per measurement. The temperature of the experiment may also affect the possible number of response measurements. Consider an irreversible reaction. The reaction rate will be greater in experiments where the temperature is higher. As a consequence, the reaction will go to completion in a shorter period of time in higher temperature experiments than in low temperature experiments. That may mean that fewer responses can be measured in a high temperature experiment than in a low temperature experiment.

### Experimental Responses

Many different quantities can be used as the experimental response. The only requirement is that it must be possible to relate the measured response to the composition of the system. Obvious choices for the measured response are the concentration or partial pressure of any one reactant or product. (Recall from @sec-reaction-progress that knowing the initial molar amounts and any one final amount allows calculation of the apparent extent of reaction, which, in turn allows the calculation of all other final amounts.)

Similar quantities that could be measured as the experimental response include the mole fraction of any reactant or product or the conversion of any reactant. There are other, less obvious possibilities for the measured response. As noted above, for a gas phase reaction where the total number of moles changes as a result of the reaction, the total pressure of the system can be used as the response variable. Properties such as the refactive index of a liquid, the electrical conductivity of a liquid, the absorbance of radiation of a specific frequency, etc. can often be related to the amount of one reagent in the fluid, in which case that property can also be used as the measured response.

One other possibility for the measured response from BSTR kinetics experiments is known as the half-life. This response variable is the elapsed time required for the amount of any one reactant to decrease to one-half of its initial value. Measuring the half-life is particularly easy with a stopped-flow reactor like that depicted in @fig-stopped_flow_reactor. One simply measures the elapsed time between the instant the flow is stopped and the instant the spectrophotometer signal becomes one-half of its original value. (This assumes that the spectrophotometer signal is linearly proportional to the amount of the reagent absorbing the light.) The analysis of kinetics data where the measured response is the half-life is discussed below.

## BSTR Data Analysis

When the experimental data consist of blocks with all of the data in any one block being at the same temperature, the analysis proceeds in two phases as described in @sec-kin-data-gen. In the first phase the data blocks are analyzed individually and the results are used to assess how accurately the proposed rate expression captures the effects of composition and pressure upon the reaction rate. A model of the reactor is used in this analysis to estimate the value of the rate coefficient and other kinetics parameters at each of the block temperatures. **This first phase of the analysis is the focus of this section and this chapter**. Once the rate coefficients have been estimated at all of the block temperatures, they are used to assess how accurately the proposed rate expression captures the temperature depenence of the reaction rate. That phase does not use the reactor model; it involves fitting the Arrhenius expression to the data from the first phase, resulting in estimates for the pre-exponential factor and the activation energy. This was described in @sec-rates-rate-express and illustrated in [Example -@sec-example_4_4]. It will be illustrated again in the examples at the end of this chapter, but it will not be discussed here.

The analysis of a block of kinetics data generated using an ideal, isothermal BSTR makes use of the ideal BSTR mole balance, @eq-bstr_mole_balance. In *Reaction Engineering Basics* there will alway be one reaction taking place within the reactor, so the mole balance on any reactant or product, $i$, will take the from shown in @eq-bstr_mole_bal_one_reaction. Because only one reaction is taking place, it is not necessary to use an index for the reaction.

$$
\frac{dn_i}{dt} = \nu_i r V
$$ {#eq-bstr_mole_bal_one_reaction}

@sec-kin-data-gen described three general approaches to the analysis of kinetics data. The preferred approach uses exact mole balances to model the reactor. Another popular approach uses a linearized reactor model, but this is not always possible. The third approach uses an approximate mole balance. The use of each of those three approaches for the analysis of BSTR kinetics data is considered in this section. In addition, a fourth method of data analysis based on using the half-life of the reaction as the response variable is described.

### Analysis Using a Response Function

Analysis using a response function is straightforward. Because it sacrifices no accuracy and can be used in every situation, kinetics data analysis using a response function is the preferred approach in *Reaction Engineering Basics*. A BSTR response function is a computer function. The experimental adjusted reactor inputs and the kinetics parameters in the rate expression are passed to it as arguments. Within the BSTR response function the mole balance design equations, @eq-bstr_mole_bal_one_reaction, are solved to find the molar amounts of all reagents at each of the times the experimental response was measured. In turn, those results are used to calculate the value of the experimental response predicted by the BSTR model for each experiment.  The BSTR response function returns those model-predicted responses.

The BSTR response function is used with computer software for parameter estimation. Typically the response function is provided to the parameter estimation software along with a guess for the values of the kinetics parameters, the experimental adjusted reactor inputs and the experimental measured responses. The parameter estimation software returns the best estimate and 95% confidence interval (or an equivalent quantity) for each of the kinetics parameters together with the coefficient of determination, $R^2$.

The estimated kinetics parameters can then be used to calculate the model-predicted response and the residual (difference between the model-predicted response and the experimentally measured response) for each experiment. From those a parity plot (model-predicted response *vs*. experimentally measured response) and residuals plots (residual *vs*. each adjusted reactor input) can be created.

The accuracy of the model can then be assessed and a recommendation made by noting that when the model is accurate the following criteria will be satisfied.

* The coefficient of determination, $R^2$, will be close to 1.
* The uncertainty in each parameter estimate will be small compared to the estimate.
* The points in the parity plot will all be close to a diagonal line ($y_{\text{expt}} = y_{\text{model}}$).
* In each residuals plot, the points will scatter randomly about zero (the horizontal axis), and no systematic deviations will be apparent.

### Analysis Using a Linearized Model

In this approach, a single mole balance design equation, @eq-bstr_mole_bal_one_reaction, is used. It is solved analytically to obtain an integrated form of the reactor model. This is shown in @eq-integrated_bstr_mole_bal where $f$ represents the function obtained upon solving the mole balance analytically. It isn't always possible to solve the mole balance in this way; when it isn't possible, this approach cannot be used.

$$
\frac{dn_i}{dt} = \nu_i r V \qquad \Rightarrow \qquad n_i = f\left( n_i, t \right)
$$ {#eq-integrated_bstr_mole_bal}

Assuming that the mole balance can be solved to find the function, $f$, the solution of the IVODE is re-written so that by defining new variables it becomes a linear equation. Sometimes this can be done using only algebraic manipulations. When the integrated model equation contains a fraction with multiple terms in the denominator, taking the reciprocal of both sides sometimes leads to a linearized equation. Similarly, if the integrated model equation contains an exponential, taking the log of both sides sometimes leads to a linearized equation. In [Example -@sec-example_4_4] a linearized version of the Arrhenius expression was fit to experimental rate coefficient data. It isn't always possible to linearize the integrated reactor model, in which case this approach again can't be used. If the integrated reactor model can be linearized, it will have the linear form shown in @eq-linear_equation and reproduced here.

$$
y = m_1x_1 + m_2x_2 + \cdots + m_nx_n + b
$$

**It is important to understand** that *the kinetics parameters cannot appear in the defining equation for the new variables*, $y$ and the $x_i$. Also, *the definition of each slope, $m_i$, and the intercept, $b$, must contain a unique combination of the kinetics parameters, and it may not contain any adjusted inputs or the response*. That means that the total number of slopes and intercepts must equal the number of kinetics parameters.

At this point, the analysis proceeds as described in @sec-kin-data-gen. The primary advantage of this approach is that the linearized model can be fit to the new $y$ and $x$ data using linear least squares. It is not necessary to write a response function, nor to use general parameter estimation software. As noted in @sec-kin-data-gen, if there are only one or two kinetics parameters in the rate expression, the linearized model, $y=mx$ or $y=mx+b$, can be fit to the $x$ - $y$ data using a spreadsheet.

The criteria for assessing the accuracy of the rate expression are the same as when using a response function (see @sec-kin-data-gen). When the rate expression contains two kinetics parameters and a spreadsheet is used for analysis, it isn't necessary to generate parity and residuals plots. Instead, a model plot can be used instead. If the model is accurate, the plotted points lie close to the trendline with no systematic deviations from the line. That is, with random scatter about the line.

### Analysis Using an Approximate Reactor Model (Differential Analysis)

In this approach, an approximate form of the mole balance, @eq-bstr_diff_mol_bal, is used. The primary advantage of this approach is that it converts the reactor model from an IVODE to an algebraic/transcendental equation (ATE). The derivative can be approximated using backward, forward or central differences (see [Appendix -@sec-pre-knowledge]). In the past, before computers were readily available, the derivative was also estimated graphically. That is $n_i$ was plotted *vs*. $t$, a smooth curve was drawn through the data, and the slopes of tangents to that curve were measured and used to approximate the derivative.

$$
\frac{dn_i}{dt} = \nu_i r V \approx \frac{\Delta n_i}{\Delta t} = \nu_i r V
$$ {#eq-bstr_diff_mol_bal}

If the measured response is not the molar amount of $i$, it becomes necessary to process the data when using this approach. That is, it is necessary to use the measured response to calculate $n_i$, so that the derivative can be approximated. In practice, the approximate reactor model is typically linearized and analyzed as described above when using this approach.

As one might expect, this approach to kinetics data analysis is not as accurate as using the exact reactor model. As the data becomes noisier (i. e. the greater the random error in the data), the accuracy decreases. If the noise in the data is very small and the intervals between response measurements are also small, the accuracy can approach the accuracy of analysis using the exact reactor model. Nonetheless, analysis using the exact reactor model is generally preferred, while this approach is often used to perform a quick, preliminary analysis.

One variation on this approach uses **initial rates**. The only difference in this approach is that @eq-bstr_diff_mol_bal is only applied at the start of the experiment. As a result, each experiment yields only the value of the rate at the initial conditions. This approach is typically applied graphically by plotting the molar amount of $i$ *vs*. $t$. The initial slope then can be measured graphically. It facilitates a quick, preliminary assessment of possible rate expressions. As personal computers have become popular and available, the use of this approach appears to have declined.

### Half-life Methods of Analysis

Another method that appears to have declined in popularity is the half-life method. It involves measuring the “half-life” of the reaction as described above. The half-life method is most commonly applied when the rate is expected to depend upon the concentration of a single reactant, e. g. reactant A, in a power-law fashion, @eq-half_life_rate_expr. The half-life, $t_{1/2}$, is the amount of time that it takes for the concentration of the reactant to decrease to one-half of its initial value. This rate expression can be substituted into the batch reactor design equation, @eq-bstr_mole_bal_one_reaction, as shown in @eq-half_life_ode.

$$
r_A = - kC_A^\alpha
$$ {#eq-half_life_rate_expr}

$$
\frac{dn_i}{dt} = - kVC_A^\alpha = -kV\left( \frac{n_A}{V} \right)^\alpha = -kV^{1-\alpha}n_A^\alpha
$$ {#eq-half_life_ode}

@eq-half_life_ode can be solved by separating the variables and integrating. The lower limit of integration is that the moles of A equal $n_{A,0}$ at $t$ equals zero, and the upper limit of integration is that the moles of A equal $0.5n_{A,0}$ at $t$ equals $t_{1/2}$. If the reaction order, $\alpha$, is equal to one, the result is given in @eq-half_life_first_order; for reaction orders other than one, @eq-half_life_other_order results.

$$
t_{1/2} = \frac{0.693}{k}
$$ {#eq-half_life_first_order}

$$
t_{1/2} = \frac{\left(2^{\alpha -1} - 1\right)}{kC_{A,0}^{\alpha - 1}\left( \alpha - 1 \right)}
$$ {#eq-half_life_other_order}

@eq-half_life_first_order and @eq-half_life_other_order suggest that the reaction order, $\alpha$, can be determined by measuring the half-life in a series of experiments using different initial concentrations of A. If the half-life is the same for all initial concentrations, the reaction is first order. Otherwise, a log-log plot of the half-life *vs*. the initial concentration should yield a straight line, and the slope should equal $1-\alpha$ as can be seen by taking the logs of each side of equation @eq-half_life_other_order. Note that $k$ and $\alpha$ were treated as constants in this analysis, so each block of experiments at a single temperature must be evaluated separately.

## Examples

All of the examples in [Chapters -@sec-bstr-data-analysis], [-@sec-cstr-data-analysis], and [-@sec-pfr-data-analysis] involve using experimental data to generate and assess a rate expression. Here in @sec-bstr-data-analysis the experimental data have been generated using an ideal BSTR. This type of problem can be called a "kinetics data analysis problem." When one is assigned any problem to solve, one of the first things they need to do is to identify what type of problem it is. Instead of repeating how an expert would identify the problem type in each of the following examples, a single expert thinking callout is provided here. Readers should mentally insert this callout at the start of every example in this chapter.

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking after Reading each Problem Statement in this Chapter

This is what I call a "kinetics data analysis problem." It has 3 distinguishing characteristics.

* The problem statement describes reactor experiments.
* The data resulting from performing those experiments are provided.
* The problem asks you to generate a rate expression or to assess the accuracy of a proposed rate expression using those data.

I know that to solve a kinetics data analysis problem I will need to do the following things.

* Identify the experimental adjusted reactor inputs. These are the things that the person doing the experiment had control over and was able to set their value.
* Identify the experimental response. This is some quantity that is related to the composition of the reacting fluid at the time it was measured.
* Formulate some type of mathematical model of the experiments. In this book, where kinetics experiments are isothermal and involve only one reaction, the model will be based upon one or more mole balances.
* Fit the model separately to the experimental data in each the blocks containing data at a single temperature. This yields the value of the kinetics parameters in the rate expression that minimize the difference between the responses the model predicts and the responses that were measured experimentally.
* Assess whether the model is sufficiently accurate in capturing the effect of pressure and composition on the reaction rate.
* Fit the Arrhenius expression to the resulting rate coefficients, assess how accurately the model captures the temperature dependence of the rate, and make a recommendation based upon that assessment.

:::

### Differential Analysis {#sec-example_8_1}

{{< include ../RE_Basics_Examples/reb_8_1/problem_statement.qmd >}}

```{r}
#| echo: false
#| output: false
library(tidyverse)
source("~/Libraries/R/fmt_tibble_col.R")
d <- read.csv("Data/reb_8_1_data.csv")
# Experiment, T, CA0, t, CA
```

The first few data points are shown in @tbl-example_8_1_data. The full data set is available in the .csv file [reb_8_1_data.csv](./Data/reb_8_1_data.csv)

```{r}
#| echo: false
#| warning: false
#| label: tbl-example_8_1_data
#| tbl-cap: First 8 of the 72 experimentally generated data.
library(kableExtra)
library(knitr)
kbl(d[1:8,], format = "markdown", align = "cc", col.names = c('Experiment','T (°C)',
    'C~A,0~ (M)', 't~rxn~ (min)', 'C~A~ (M)'))
```

---

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

Having identified this as a kinetics data analysis problem as described in the expert thinking callout at the start of this section, I know that I need to identify the adjusted experimental inputs and the measured experimental response. I like to start by additionally summarizing information from the problem statement including the type of reactor used in the experiments and constant quantities provided in the problem statement. Knowing that I need to estimate the values of all of the kinetics parameters appearing in the rate expression, it is also useful to identify and list them, too. Creating these lists at the start of the analysis makes it easier to formulate the model for the experiments. Note that in listing the adjusted experimental inputs and the measured experimental response, the variable symbols are underlined to indicate that they are vector quantities.

I know that the data will be analyzed in two phases as described in @sec-kin-data-gen. In this problem, data were generated at 4 different temperatures. For the first phase of the analysis, I will separate the data into four blocks. One block will contain the data from all experiments conducted at 60 °C, one will contain the 73 °C data, one, the 82 °C data and one, the 90 °C data. I will analyze each of these blocks separately to estimate the best value of $k$ at that temperature and to assess the accuracy of the rate expression at that temperature.

:::

**Reactor Type**: BSTR

**Given Constants**: $V = 1\text{ L}$.

**Adjusted Inputs**: $\underline{T}$, $\underline{C_{A,0}}$, and $\underline{t}$

**Experimental Response**: $\underline{C_{A,\text{ expt}}}$

**Kinetics Parameters**: $k_0$, and $E$

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

I am instructed to perform differential data analysis in this problem. That means that I will model the reactor using just one mole balance, and in that mole balance I will approximate the derivative using a finite difference. Since the response in this problem is the concentration of A, it makes sense to write that approximate mole balance on A. 

:::

**Reactor Design Equation**

An approximate mole balances on A for the first measured response in each experiment is presented in equation (3). For the rest of the measured responses in that experiment, the approximate mole balance is given by equation (4), where $i$ indexes the measurement times during that experiment.

$$
\frac{n_A \Big\vert_{t=t_1} - n_A \Big\vert_{t=0}}{t_1} = -r V \tag{3}
$$

$$
\frac{n_A \Big\vert_{t=t_i} - n_A \Big\vert_{t=t_{i-1}}}{t_i - t_{i-1}} = -r V \tag{4}
$$

:::{.callout-tip collapse="true"}
## Click Here to See Where That Came From

Start from @eq-bstr_diff_mol_bal written for reagent A.

$$
\frac{dn_A}{dt} = \nu_A r V \approx \frac{\Delta n_A}{\Delta t} = \nu_A r V
$$

The stoichiometric coefficient of A is -1. If backward differences are used, it is possible to approximate the derivative at each of the times the response was measured in any one experiment. (If forward differences were used, the derivative could not be approximated at the time of the final measurement.) For the first measurement, the previous values of $n_A$ and $t$ are the initial values. If the start of the each experiments is defined to be $t=0$, equation (3) results. For the remaining times when the response is measured, the previous values are simply those from the previous measurement, equation (4). 

:::

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

I know that the next thing I need to do is to substitute the rate expression into the reactor model and then fit the model to the experimental data. I could fit the model using a response function. However, when differential analysis is used, it is common to linearize the reactor model and use linear least squares for the fitting. That is the approach I will use here.

:::

Substitution of the rate expression into equation (4) and rearrangement leads to equation (5). Recognizing that $t_0 = 0$, this equation can be used for every data point.

$$
\frac{C_{A,i-1} - C_{A,i}}{t_i - t_{i-1}} = k C_{A,i} \tag{5}
$$

:::{.callout-tip collapse="true"}
## Click Here to See Where That Came From

Start by substituting the rate expression, equation (2), into equation (4) and letting $n_{A,i} = n_A \Big\vert_{t=t_i}$.

$$
\frac{n_{A,i} - n_{A,i-1}}{t_i - t_{i-1}} = -k V C_{A,i}
$$

Then divide each side of the equation by $-V$.

$$
\frac{n_{A,i} - n_{A,i-1}}{t_i - t_{i-1}} \frac{-1}{V} = k C_{A,i}
$$

Finally, note that $\frac{n_{A,i}}{V} = C_{A,i}$ and $\frac{n_{A,i-1}}{V} = C_{A,i-1}$.

$$
\frac{C_{A,i-1} - C_{A,i}}{t_i - t_{i-1}} = k C_{A,i}
$$

:::

If $x$ and $y$ are defined as shown in equations (6) and (7), it is apparent that equation (5) is a linear equation with a slope of $k$ and an intercept of 0, equation (8).

$$
x_i = C_{A,i} \tag{6}
$$

$$
y_i = \frac{C_{A,i-1} - C_{A,i}}{t_i - t_{i-1}} \tag{7}
$$

$$
y = kx \tag{8}
$$

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

The next step is to estimate the parameters. Since the model is a linear equation, I can do that using linear least squares. I could use a spreadsheet program to do this, but I prefer write a short computer program that calls a linear least squares function. My main reason for this preference is that it the software will provide the coefficient of determination, the parameter estimates, *and* the 95% confidence intervals (or an equivalent measure of uncertainty) for the estimated parameter. When a spreadsheet is used to plot the data and add a trendline, the uncertainties are *not* shown. Additional calculations must be performed in the spreadsheet to generate those uncertainties. 

In either case, the values of $x$ and $y$ must first be calculated for each experiment using equations (6) and (7). A straight line can then be fit to the resulting $x$ - $y$ data to obtain the coefficient of determination, the parameter estimates, and the 95% confidence intervals for the parameters. The model in this problem, $y=mx$, is linear with only one parameter, so a model plot can be used to assess its accuracy as described in @sec-kin-data-gen.

:::

**Parameter Estimation and Assessment of Accuracy**

```{r}
#| echo: false
#| output: false
library(tidyverse)
source("~/Libraries/R/fmt_tibble_col.R")
d <- read.csv("../RE_Basics_Examples/reb_8_1/python/reb_8_1_phase_1_results.csv")
# T, k, k_ll, k_ul, R_sq_
d <- fmt_tibble_col(d, 2:5, 3, 2, 2)
d$k_full = paste0(d$k,' min^-1^, 95% CI [',d$k_ll,', ',d$k_ul,']')
```

Within each block of data, values of $x$ and $y$ were calculated for each experimental data point, equation (8) was fit to the resulting data, and a model plot was created. The fitting results are given in @tbl-example_8_1_phase_1_results, and the model plots are shown in @fig-example_8_1_phase_1_plots.

```{r}
#| echo: false
#| warning: false
#| label: tbl-example_8_1_phase_1_results
#| tbl-cap: Phase 1 fitting results
d <- d %>% select(T, k_full, R_sq)
library(kableExtra)
library(knitr)
kbl(d, format = "markdown", align = "cc", col.names = c("T (°C)", "k", "R^2^"))
```

::: {#fig-example_8_1_phase_1_plots layout-ncol=2}

![](Graphics/reb_8_1_model_T_equals_65.png)

![](Graphics/reb_8_1_model_T_equals_73.png)

![](Graphics/reb_8_1_model_T_equals_82.png)

![](Graphics/reb_8_1_model_T_equals_90.png)

Model Plots for each of the four temperature blocks.
:::

The 95% confidence intervals for each of the four estimated rate coefficients are relatively small compared to the estimated values and the $R^2$ values are all close to 1. Looking at the model plots, the deviations of the experimental data appear to be random. In general, the magnitude of the deviations are acceptable. The deviations are greater for the experiments at lower temperatures. If this is a concern, additional experiments should be performed at the lower temperatures.

```{r}
#| echo: false
#| output: false
library(tidyverse)
source("~/Libraries/R/fmt_tibble_col.R")
d <- read.csv("../RE_Basics_Examples/reb_8_1/python/reb_8_1_Arrhenius_results.csv")
d <- fmt_tibble_col(d, 2, 3, 2, 2)
a <- c('k~0~','E','R^2^')
b1 <- paste0(d$value[1],' ',d$units[1],', 95% CI [',d$value[2],', ',d$value[3],']')
b2 <- paste0(d$value[4],' ',d$units[4],', 95% CI [',d$value[5],', ',d$value[6],']')
b <- c(b1,b2,d$value[7])
# item, value, units
d <- data.frame(a,b)
```

The Arrhenius expression was fit to the estimated rate coefficients in @tbl-example_8_1_phase_1_results. The parameter estimation results are shown in @tbl-example_8_1_arrhenius_results.

```{r}
#| echo: false
#| warning: false
#| label: tbl-example_8_1_arrhenius_results
#| tbl-cap: Parameter estimation results
library(kableExtra)
library(knitr)
kbl(d, format = "markdown", align = "cc", col.names = NULL)
```

The 95% confidence interval for the pre-exponential factor is quite large, but this is often observed for the pre-exponential factor. The confidence interval for the activation energy is small relative to its value, suggesting a good fit. Additionally, the coefficient of determination is equal to 1, which indicates a very good fit. The Arrhenius plot is shown in @fig-example_8_1_arrhenius_plot. The estimated rate coefficients fall almost exactly on the line representing the Arrhenius expression.

![Arrhenius plot resulting from the estimated parameters.](Graphics/reb_8_1_Arrhenius_plot.png){#fig-example_8_1_arrhenius_plot width=80%}

**Recommendation**

As the problem instructed, the kinetics data were analyzed using an approximate reactor model. This is expected to introduce some error. Despite the use of differential data analysis, the model was found to describe the experimental results with reasonable accuracy. The greatest discrepancies between the experiments and the model predictions occurred at low temperature. While additional low-temperature experiment could be performed to try to improve the accuracy, doing so is not necessary. Given that the instructions said to use differential analysis, one can infer that extremely high accuracy is not needed here.

:::{.callout-note collapse="false"}
## Note

In this experimental study 3 experiments were performed at each temperature, differing only in the initial concentration of A. The elapsed time between each measurement of the response was 5 min in those experiments. Had it been possible to measure the response very quickly, say every 0.25 min, a single experiment could have been used at each temperature.

In addition to reducing the time required to perform the experiments, this might have improved the accuracy of the results. In the present study, the derivative of the molar amount of A with respect to time was approximated using two data points that were 5 min apart. If the data points had been 0.25 min apart, the approximation would have been more accurate.

:::

### Analysis Using a Linearized Reactor Model {#sec-example_8_2}

{{< include ../RE_Basics_Examples/reb_8_2/problem_statement.qmd >}}

```{r}
#| echo: false
#| output: false
library(tidyverse)
source("~/Libraries/R/fmt_tibble_col.R")
d <- read.csv("Data/reb_8_2_data.csv")
 # T, PA0, PB0, t, fA
```

The first few data points are shown in @tbl-example_8_2_data. The full data set is available in the file [reb_8_2_data.csv](Data/reb_8_2_data.csv).

```{r}
#| echo: false
#| warning: false
#| label: tbl-example_8_2_data
#| tbl-cap: First 5 of the 189 experimentally generated data.
library(kableExtra)
library(knitr)
kbl(d[1:5,], format = "markdown", align = "cc", 
    col.names = c('T (°C)', 'P~A,0~ (atm)', 'P~B,0~ (atm)', 't~rxn~ (min)', 
    'f~A~'))
```

---

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

I can see that this is a kinetics data analysis problem (see the expert thinking callout at the start of this section). I will start by listing the reactor type, constants provided in the problem statement, the adjusted experimental inputs, the measured experimental responses and the kinetics parameters I need to estimate.

:::

**Reactor Type**: BSTR

**Given Constants**: $V = 500\text{ cm}^3$.

**Adjusted Inputs**: $\underline{T}$, $\underline{P_{A,0}}$, $\underline{P_{B,0}}$, and $\underline{t_{rxn}}$

**Experimental Responses**: $\underline{f_{A,\text{ expt}}}$

**Kinetics Parameters**: $k_0$, and $E$

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

The data set includes experiments at each of 3 temperatures. From this I know that I will need to analyze the data in two phases. In the first phase I will analyzed blocks of data, each of which contains *all* of the experiments at *one* of the three temperatures. Because all of the data in a block are at the same temperature, I know that in the first phase I will only be able to estimate $k$ at each of the block temperatures. The values of $k_0$ and $E$ will be estimated in the second phase of the analysis.

The problem statement instructs me to use a linearized reactor model. That means I must use a single mole balance on one of the products or reactants to model the reactor. (Because the reactor is isothermal, I can solve the mole balance independently of the energy balances.) The response in this problem is the fractional conversion of reagent A, so I'll write the mole balance on reagent A.

The mole balance will be a differential equation. I know that I will need to solve that IVODE analytically before I'll be able to linearize the model.

:::

**Reactor Design Equation**

A mole balance on reagent A is shown in equation (3).

$$
\frac{dn_A}{dt} = -kVP_AP_B \tag{3}
$$

:::{.callout-tip collapse="true"}
## Click Here to See Where That Came From

Start from @eq-bstr_mole_bal_one_reaction written for reagent A.

$$
\frac{dn_i}{dt} = \nu_i r V
$$

The stoichiometric coefficient of A is -1. Substitution of that value and the rate expression gives equation (3).

:::

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

I need to solve equation (3) before I can linearize it. To do that, I need to express every variable quantity appearing in it in terms of the dependent variable, $n_A$, and the independent variable $t$. In any one experiment, $k$ and $V$ will be constant, but $P_A$ and $P_B$ will change as the reaction proceeds. Consequently, I need to express $P_A$ and $P_B$ in terms of $n_A$ and $t$.

:::

Using the ideal gas law, the partial pressures can be eliminated, equation (4).

$$
\frac{dn_A}{dt} = -kV\left( \frac{n_ART}{V} \right)\left( \frac{n_BRT}{V} \right) = \frac{-k\left(RT\right)^2}{V}n_An_B \tag{4}
$$

The molar amount of B can then be expressed in terms of the molar amount of A, equation (5).

$$
\frac{dn_A}{dt} = \frac{-k\left(RT\right)^2}{V}n_A\left( n_{B,0} - n_{A,0} + n_A \right) \tag{5}
$$

:::{.callout-tip collapse="true"}
## Click Here to See Where That Came From

Start by expressing the molar amount of reagent B in terms of its initial amount and the apparent extent of the reaction.

$$
n_B = n_{B,0} - \xi
$$

Then express $\xi$ in terms of the molar amount of reagent A.

$$
n_A = n_{A,0} - \xi \qquad \Rightarrow \qquad \xi = n_{A,0} - n_A
$$

Substuting the second expression into the first gives an expression for the molar amount of reagent B.

$$
n_B = n_{B,0} - n_{A,0} + n_A
$$

Substitution of that expression into equation (4) gives equation (5).

:::

Separation of variables and integration then leads to equation (6).

$$
\frac{1}{n_{A,0}-n_{B,0}} \ln{\frac{n_{A,0}\left( n_{B,0} - n_{A,0} + n_A  \right)}{n_{B,0}n_A}} = \frac{-k\left(RT\right)^2}{V} t\tag{6}
$$

:::{.callout-tip collapse="true"}
## Click Here to See Where That Came From

Rearrange equation (5) so only $n_A$ appears on the left side and only $t$ appears on the right.

$$
\frac{dn_A}{n_A\left( n_{B,0} - n_{A,0} + n_A \right)} = \frac{-k\left(RT\right)^2}{V}dt
$$

Then integrate noting that at $t=0$, $n_A = n_{A,0}$, at any later time, $t$, the molar amount of reagent A is $n_A$, and $k$, $R$, $T$, and $V$ are constants that can be taken outside of the integral.

$$
\int_{n_{A,0}}^{n_A}\frac{dn_A}{n_A\left( n_{B,0} - n_{A,0} + n_A \right)} = \frac{-k\left(RT\right)^2}{V}\int_{t_0}^tdt
$$

$$
\frac{1}{n_{B,0}-n_{A,0}} \left(\ln{\frac{ n_{B,0} - n_{A,0} + n_A  }{n_A}}\right)\Bigg\vert_{n_{A,0}}^{n_A} = \frac{-k\left(RT\right)^2}{V} t\Big\vert_{t_0}^t
$$

Evaluating at the upper and lower limits and taking the difference on each side then yields equation (6).

:::

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

Looking at equation (6), I can see that the first fraction will become infinite if $n_{A,0} = n_{B,0}$, and some of the experiments have equal initial partial pressures of reagents A and B. If $n_{A,0} = n_{B,0}$ then $n_A$ will equal $n_B$ at all times because one A is consumed every time one B is consumed in the reaction. In this case, the rate expression becomes $r=kP_A^2$, so the reactor model is as follows.

$$
\frac{dn_A}{dt} = -kVP_A^2
$$

Rearrange so only $n_A$ appears on the left side and only $t$ appears on the right.

$$
\frac{dn_A}{n_A^2} = \frac{-k\left(RT\right)^2}{V}dt
$$

Then integrate noting that at $t=0$, $n_A = n_{A,0}$, at any later time, $t$, the molar amount of reagent A is $n_A$, and $k$, $R$, $T$, and $V$ are constants that can be taken outside of the integral.

$$
\int_{n_{A,0}}^{n_A}\frac{dn_A}{n_A^2} = \frac{-k\left(RT\right)^2}{V}\int_{t_0}^tdt
$$

$$
\frac{-1}{n_A}\Bigg\vert_{n_{A,0}}^{n_A} = \frac{-k\left(RT\right)^2}{V} t\Big\vert_{t_0}^t
$$

Evaluating at the upper and lower limits and taking the difference on each side then yields equation (7), below.

:::

If $n_{A,0} = n_{B,0}$, separation of variables and integration leads to equation (7).

$$
\frac{1}{n_{A,0}} - \frac{1}{n_A} = \frac{-k\left(RT\right)^2}{V} t\tag{7}
$$

:::{.callout-note collapse="false"}
## Note

Someone just starting to learn about kinetic data analysis might not have noticed that the initial fraction in equation (6) will become infinite if $n_{A,0} = n_{B,0}$. In that case, the analysis would have failed a little later, indicating that something was wrong. Eventually the new learner might figure out the problem, but this is one of those times when a little prior experience (or the ability to ask a teacher has such experience) really helps. 

:::


:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

Having solved the mole balance ODE, the next step is to linearize it. In this problem nothing needs to be done. It is already linear. That means that I next need to calculate the values of $x$ and $y$ for each experimental data point.

:::

If $y$ is defined as shown in equation (8) for experiments where $n_{A,0} = n_{B,0}$, or as shown in equation (9) when $n_{A,0} \ne n_{B,0}$, and $x$ is defined as shown in equation (10), it can be seen that the model for both cases is a linear equation with a slope equal to $k$, equation (11).

$$
y = \frac{1}{n_{A,0}} - \frac{1}{n_A} \tag{8}
$$

$$
y = \frac{1}{n_{B,0}-n_{A,0}} \ln{\frac{n_{A,0}\left( n_{B,0} - n_{A,0} + n_A  \right)}{n_{B,0}n_A}} \tag{9}
$$

$$
x = \frac{-t\left(RT\right)^2}{V} \tag{10}
$$

$$
y=kx \tag{11}
$$

**Ancillary Equations**

The value of $x$ can be calculated for each data point using the information provided in the problem statement. In order to calculate $y$, the initial molar amounts of A and B and the final molar amount of A must be calculated. The initial amounts can be found using the ideal gas law, equations (10) and (11). The final molar amount of reagent A can then be found using the measured conversion of A, equation (12).

$$
n_{A,0} = \frac{P_{A,0}V}{RT} \tag{10}
$$

$$
n_{B,0} = \frac{P_{B,0}V}{RT} \tag{11}
$$

$$
n_A = n_{A,0} \left( 1 - f_A \right) \tag{12}
$$

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

The next step in this phase of the analysis is to fit equation (9) to the $x$ - $y$ data that I just calculated. I can do this using a spreadsheet or using software for linear regression. Once equation (9) has been fit to the data for each of the three temperatures, I can generate model plots as described in @sec-kin-data-gen.

:::

**Parameter Estimation and Assessment of Accuracy**

```{r}
#| echo: false
#| output: false
library(tidyverse)
source("~/Libraries/R/fmt_tibble_col.R")
d <- read.csv("../RE_Basics_Examples/reb_8_2/python/reb_8_2_phase_1_results.csv")
 # T, k, k_ll, k_ul, R_sq_
d <- fmt_tibble_col(d, 2:5, 3, 2, 2)
d$k_full = paste0(d$k,' mol cm^-3^ min^-1^ atm^-2^, 95% CI [',d$k_ll,', ',d$k_ul,']')
```

Equation (9) was fit separately to the data in each of the three constant-temperature blocks. The results are shown in @tbl-example_8_2_phase_1_results. The model plots shown in @fig-example_8_2_model_plots were then created.

```{r}
#| echo: false
#| warning: false
#| label: tbl-example_8_2_phase_1_results
#| tbl-cap: Estimated values of the rate coefficient at each of the three temperatures studied in the experiments.
d <- d %>% select(T, k_full, R_sq)
library(kableExtra)
library(knitr)
kbl(d, format = "markdown", align = "cc", col.names = c("T (°C)", "k", "R^2^"))
```

::: {#fig-example_8_2_model_plots layout-ncol=1 width=60%}

![](Graphics/reb_8_2_model_T_equals_475.png){width=60%}

![](Graphics/reb_8_2_model_T_equals_500.png){width=60%}

![](Graphics/reb_8_2_model_T_equals_525.png){width=60%}

Model Plots for each of the three temperature blocks.
:::

The 95% confidence intervals for each of the three estimated rate coefficients are very small compared to the estimated values and the $R^2$ values are almost equal to 1. The magnitude of the deviations of the data points from the model line in the model plots is also small and random. All of these observations suggest that the rate expression is very accurate with respect to the composition dependence of the rate.

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

At this point I have completed the first phase of the analysis, and I know that the second phase of the analysis involves fitting the Arrhenius expression to the results I just obtained. I've done this enough times now that I know to use the linearized Arrhenius expression where $x=\frac{-1}{RT}$ and $y=\ln{k}$ and that the resulting slope will equal the activation energy and the intercept will equal $\ln{k_0}$. (See [Example -@sec-example_4_4], [Example -@sec-example_8_1], and @sec-rates-rate-express.)

:::

```{r}
#| echo: false
#| output: false
library(tidyverse)
source("~/Libraries/R/fmt_tibble_col.R")
d <- read.csv("../RE_Basics_Examples/reb_8_2/python/reb_8_2_Arrhenius_results.csv")
d <- fmt_tibble_col(d, 2, 3, 2, 2)
a <- c('k~0~','E','R^2^')
b1 <- paste0(d$value[1],' ',d$units[1],', 95% CI [',d$value[2],', ',d$value[3],']')
b2 <- paste0(d$value[4],' ',d$units[4],', 95% CI [',d$value[5],', ',d$value[6],']')
b <- c(b1,b2,d$value[7])
 # item, value, units
d <- data.frame(a,b)
```

The Arrhenius expression was fit to the estimated rate coefficients for the three blocks with the following results.

```{r}
#| echo: false
#| warning: false
#| label: tbl-example_8_2_arrhenius_results
#| tbl-cap: Parameter estimation results
library(kableExtra)
library(knitr)
kbl(d, format = "markdown", align = "cc", col.names = NULL)
```

The 95% confidence interval for the pre-exponential factor is large. Specifically it ranges from ca. one-third of the estimated value to three times the estimated value, but a wide confidence interval is often observed for the pre-exponential factor. The confidence interval for the activation energy is small relative to its value, suggesting a good fit. Additionally, the coefficient of determination is equal to 1, which indicates a very good fit. The Arrhenius plot is shown in @fig-example_8_2_Arrhenius_plot. The estimated rate coefficients fall almost exactly on the line representing the Arrhenius expression.

![Arrhenius plot resulting from the estimated parameters.](Graphics/reb_8_2_Arrhenius_plot.png){#fig-example_8_2_Arrhenius_plot width=80%}

**Recommendation**

The proposed rate expression given in equation (2) provides a very accurate representation of the experimental data in this study. It should be accepted with the pre-exponential factor and activation energy shown in @tbl-example_8_2_arrhenius_results.

:::{.callout-note collapse="false"}
## Note

The use of a linearized model, as demonstrated in this example is accurate and straightforward. There are two advantages to using this approach. First, the parameter estimation can easily be performed using a spreadsheet, and second, that means that it isn't necessary to guess the values of the parameters in order to estimate their values. It also has disadvantages. One is that it can't always be used. In some cases it isn't possible to solve the mole balance analytically, and in others it isn't possible to linearize the integrated model equation. An additional disadvantage is that it requires analytical solution of the IVODE mole balance.

:::


### A Gas-Phase Reaction With Total Pressure as the Response {#sec-example_8_3}

{{< include ../RE_Basics_Examples/reb_8_3/problem_statement.qmd >}}



```{r}
#| echo: false
#| output: false
library(tidyverse)
source("~/Libraries/R/fmt_tibble_col.R")
d <- read.csv("../RE_Basics_Examples/reb_8_3/reb_8_3_data.csv")
 # T,t,P
```

The first few data points are shown in @tbl-example_8_3_data. The full data set is available in the file [reb_8_3_data.csv](Data/reb_8_3_data.csv).

```{r}
#| echo: false
#| warning: false
#| label: tbl-example_8_3_data
#| tbl-cap: First 5 of the 72 experimentally generated data.
library(kableExtra)
library(knitr)
kbl(d[1:5,], format = "markdown", align = "cc", col.names = c('T (°C)', 't~rxn~ (s)', 'P (atm)'))
```

---

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

This problem has all the characteristics of a kinetics data analysis problem. As is my usual practice, I will start by listing the reactor type, constants provided in the problem statement, the adjusted experimental inputs, the measured experimental responses and the kinetics parameters I need to estimate.

:::

**Reactor Type**: BSTR

**Given Constants**: $V=100 \text{ cm}^3$ and $P_{A,0}=4 \text{ atm}$.

**Adjusted Inputs**: $\underline{T}$ and $\underline{t_{rxn}}$

**Experimental Responses**: $\underline{P}$

**Kinetics Parameters**: $k_0$, and $E$

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

I know that in order to estimate the kinetics parameters I will need to fit a reactor model to the experimental data. I also know that I should analyze the data in blocks where each block contains all of the data at one of the experimental temperatures. I'll use those blocks to estimate the rate coefficient, $k$, at each experimental temperature. Later I'll use the results to find the Arrhenius parameters.

Here I will fit the reactor model to the experimental data using a response function as described in @sec-kin-data-gen. A response function is given the adjusted experimental inputs and values for the kinetics parameters. Internally it must solve the reactor design equations and use the results to calculate and return the model-predicted response. The first thing I need to do then is to identify and write the reactor design equations. As noted in @sec-modeling-ideal-reactors, I know that when the reactor operates isothermally, as it did in these experiments, the mole balances on the reagents can be solved independently of the energy balances. Therefore I'll start by generating mole balances on every reagent to use as the reactor model. For that I can use @eq-bstr_mole_bal_one_reaction.
$$
\frac{dn_i}{dt} = \nu_i r V
$$

This system has only 2 reagents, A and A~2~, and their stoichiometric coefficients are -2 and 1, respectively. With that knowledge, I can write the mole balances.

:::

**Reactor Design Equations**

Mole balances on A and A~2~ are presented in equations (3) and (4).

$$
\frac{dn_A}{dt} = -2rV \tag{3}
$$

$$
\frac{dn_{A_2}}{dt} = rV \tag{4}
$$

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

Within the response function, the design equations must be solved numerically. Here the design equations are a set of coupled IVODEs. The dependent variables are $n_A$ and $n_{A_2}$ and the independent variable is $t$. I need three things to solve the IVODEs: (1) ancillary equations to calculate every quantity appearing in the IVODEs using known constants, the independent variable, and the dependent variables, (2) initial values, and (3) a stopping criterion. 

To start, I will go through each of the design equations variable by variable. When a variable isn't a constant, the independent variable or one of the dependent variables, I'll write an expression for it. I'll go through that expression variable by variable, writing expressions for any quantities other than known constants, the independent variable or one of the dependent variables, and so on.

:::

**Ancillary Equations**

When the rate expression is substituted into the mole balances, it introduces the partial pressure of A, which can be expressed in terms of known constants, the independent variable or one of the dependent variables using the ideal gas law, equation (5).

$$
P_A = \frac{n_ART}{V} \tag{5}
$$

The instant the reaction starts can be defined as $t=0$. At that time, no reagent A~2~ is present, so its initial value is zero. The initial value of the molar amount of reagent A can be found from its initial pressure and the ideal gas law. Thus, the initial values are given by equations (6) and (7).

$$
n_A\Big\vert_{t=0} = n_{A,0} = \frac{P_{A,0}V}{RT} \tag{6}
$$

$$
n_{A_2}\Big\vert_{t=0} = n_{A_2,0} = 0 \tag{7}
$$

The stopping criterion is that the time equals the time at which the response was measured, $t_{rxn}$, equation (8).

$$
t_f = t_{rxn}\tag{8}
$$

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

At this point the mole balance design equations can be solved numerically. Doing so will yield the values of $n_A$ and $n_{A_2}$ at a range of times between $t=0$ and $t_f$. Within the response function I need to use those values to calculate the response, which in this problem is the final pressure. I can do that using the ideal gas law and the values of $n_A$ and $n_{A_2}$ at $t_f$.

:::

**Response Function**

Letting $n_{A,f}$ and $n_{A_2,f}$ represent the calculated molar amounts of A and A~2~ at the time the response was measured, the total pressure can be found using the ideal gas law, equation (9).

$$
P = \frac{\left( n_{A,f} + n_{A_2,f} \right)RT}{V} \tag{9}
$$

**Parameter Estimation and Assessment of Accuracy**

```{r}
#| echo: false
#| output: false
library(tidyverse)
source("~/Libraries/R/fmt_tibble_col.R")
d <- read.csv("../RE_Basics_Examples/reb_8_3/python/reb_8_3_phase_1_results.csv")
 # T, k, k_ll, k_ul, R_sq_
d <- fmt_tibble_col(d, 2:5, 3, 2, 2)
d$k_full = paste0(d$k,' mol cm^-3^ s^-1^ atm^-1^, 95% CI [',d$k_ll,', ',d$k_ul,']')
```

The reactor model was fit separately to the data in each of the three constant-temperature blocks. The results are shown in @tbl-example_8_3_phase_1_results. The parity and residuals plots shown in @fig-example_8_3_model_plots were then created.

```{r}
#| echo: false
#| warning: false
#| label: tbl-example_8_3_phase_1_results
#| tbl-cap: Estimated values of the rate coefficient at each of the three temperatures studied in the experiments.
d <- d %>% select(T, k_full, R_sq)
library(kableExtra)
library(knitr)
kbl(d, format = "markdown", align = "cc", col.names = c("T (°C)", "k", "R^2^"))
```

::: {#fig-example_8_3_model_plots layout-ncol=2}

![](Graphics/reb_8_3_parity_T_equals_250.png)

![](Graphics/reb_8_3_residuals_T_equals_250.png)

![](Graphics/reb_8_3_parity_T_equals_275.png)

![](Graphics/reb_8_3_residuals_T_equals_275.png)

![](Graphics/reb_8_3_parity_T_equals_300.png)

![](Graphics/reb_8_3_residuals_T_equals_300.png)

Parity and Residuals Plots for each of the three temperature blocks.
:::

The 95% confidence intervals for each of the three estimated rate coefficients are very small compared to the estimated values and the $R^2$ values are almost equal to 1. In the parity plots the magnitude of the deviations of the data points from the line representing a perfect model are small. In the residuals plots the deviations are random (no trends are apparent). All of these observations suggest that the rate expression is very accurate with respect to the composition dependence of the rate.

:::{.callout-note collapse="false"}
## Note

The deviations in the residuals plots appear to be large, but this is because the $y$ axis is greatly expanded in the residuals plots. The parity plots are used to visually assess the magnitude of the errors. The residuals are used to visually assess the randomness of the errors.

:::

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

Having found values for the rate coefficient at each of the three experimental temperature, and having assessed the model to accurately predict the effects of pressure and composition at each experimental temperature, I now need to fit the Arrhenius expression to the rate parameter results I just obtained. I will do this using the linearized form of the Arrhenius expression. (See the previous examples in this Chapter, and @sec-rates-rate-express.)

:::

```{r}
#| echo: false
#| output: false
library(tidyverse)
source("~/Libraries/R/fmt_tibble_col.R")
d <- read.csv("../RE_Basics_Examples/reb_8_3/python/reb_8_3_Arrhenius_results.csv")
d <- fmt_tibble_col(d, 2, 3, 2, 2)
a <- c('k~0~','E','R^2^')
b1 <- paste0(d$value[1],' ',d$units[1],', 95% CI [',d$value[2],', ',d$value[3],']')
b2 <- paste0(d$value[4],' ',d$units[4],', 95% CI [',d$value[5],', ',d$value[6],']')
b <- c(b1,b2,d$value[7])
 # item, value, units
d <- data.frame(a,b)
```

The Arrhenius expression was fit to the data in @tbl-example_8_3_phase_1_results with the following results.

```{r}
#| echo: false
#| warning: false
#| label: tbl-example_8_3_arrhenius_results
#| tbl-cap: Parameter estimation results
library(kableExtra)
library(knitr)
kbl(d, format = "markdown", align = "cc", col.names = NULL)
```

The 95% confidence interval for the pre-exponential factor is huge. Specifically it ranges from ca. 5.4 to 11,500 mol cm^-3^ s^-1^ atm^-1^, but a wide confidence interval is often observed for the pre-exponential factor. The 95% confidence interval for the activation energy is smaller (70.8 to 106 kJ mol^-1^). Importantly, the coefficient of determination is equal to 1 and in the Arrhenius plot, @fig-example_8_3_Arrhenius_plot, the estimated rate coefficients fall almost exactly on the line representing the Arrhenius expression.

![Arrhenius plot resulting from the estimated parameters.](Graphics/reb_8_3_Arrhenius_plot.png){#fig-example_8_3_Arrhenius_plot width=80%}

**Recommendation**

The proposed rate expression given in equation (2) provides an accurate representation of the experimental data in this study. It should be accepted with the pre-exponential factor and activation energy shown in @tbl-example_8_3_arrhenius_results.

:::{.callout-note collapse="false"}
## Note

problem is not realistic because can't pre-heat reactant and can't heat it instantly.

also it wasn't necessary to use full reactor model, but did so for purposes of illustration. It is preferred because it can **always** be used while linearization can't. See next example.

:::

### Assessing a Michaelis-Menten Rate Expression {#sec-example_8_4}

{{< include ../RE_Basics_Examples/reb_8_4/problem_statement.qmd >}}

```{r}
#| echo: false
#| output: false
library(tidyverse)
source("~/Libraries/R/fmt_tibble_col.R")
d <- read.csv("../RE_Basics_Examples/reb_8_4/reb_8_4_data.csv")
 # CS0, t, CP
```

The first few data points are shown in @tbl-example_8_4_data. The full data set is available in the file [reb_8_4_data.csv](Data/reb_8_4_data.csv).

```{r}
#| echo: false
#| warning: false
#| label: tbl-example_8_4_data
#| tbl-cap: First 8 of the 72 experimentally generated data.
library(kableExtra)
library(knitr)
kbl(d[1:5,], format = "markdown", align = "cc", col.names = c('C~S,0~ (mmol L^-1^)', 't~rxn~ (min)', 'C~P~ (mmol L^-1^)'))
```

---

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

I will start my solution of this kinetics data analysis problem by listing the reactor type, the constants provided in the problem statement, the adjusted experimental inputs, the measured experimental responses and the kinetics parameters I need to estimate.

:::

**Reactor Type**: BSTR

**Given Constants**: $V=50 \text{ ml}$.

**Adjusted Inputs**: $\underline{C_{S,0}}$ and $\underline{t_{rxn}}$

**Experimental Responses**: $\underline{C_P}$

**Kinetics Parameters**: $V_{max}$, and $K_m$

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

All of the data in this problem were generated at the same temperature, so they can all be analyzed together. I need to write a reactor model (see @sec-modeling-ideal-reactors), use it to create a reactor response function (see @sec-kin-data-gen and above), and use that to fit the reactor model to the experimental data (see [Appendix -@sec-parameter-est] and [Example -@sec-example_8_3]).

For an isothermal reactor, the mole balances can be solved independently of the other reactor design equations. In this problem there are three reagents, the substrate S, the product P, and water. I will use @eq-bstr_mole_bal_one_reaction to write mole balance on these reagents, noting that their stoichiometric coefficients are -1, 1, and 1, respectively. 

:::

Mole balances on the substrate S, the product P, and water are presented in equations (3) through (5).

$$
\frac{dn_S}{dt} = -rV \tag{3}
$$

$$
\frac{dn_P}{dt} = rV \tag{4}
$$

$$
\frac{dn_{H_2O}}{dt} = rV \tag{5}
$$

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

Within the response function I am creating, I need to solve the mole balance equations numerically. The adjusted inputs and the kinetics parameters will be available in the response function. The mole balances are IVODEs, so to solve them I need to provide three things: (1) ancillary equations to calculate the value of every quantity in the mole balances using only known constants, the independent variable ($t$ in this problem), and the dependent variables ($n_S$, $n_P$, and $n_{H_2O}$); (2) initial values and (3) a stopping criterion.

:::

**Ancillary Equations**

Substitution of the rate expression into the mole balances introduces the concentration of substrate S, which can be calculated using equation (6).

$$
C_S = \frac{n_S}{V} \tag{6}
$$

The instant the reaction began can be defined as $t=0$. The initial values are then given by equations (7) and (8).

$$
n_S\Big\vert_{t=0} = C_{S,0}V \tag{7}
$$

$$
n_P\Big\vert_{t=0} = n_{H_2O}\Big\vert_{t=0} = 0 \tag{8}
$$

The integration of the IVODEs should stop when $t=t_{rxn}$.

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

At this point the mole balances can be solved numerically. Doing so will yield the values of $n_S$, $n_P$, and $n_{H_2O}$ at times between $t=0$ and $t=t_{rxn}$. I need to use those results to calculate the response, which in this problem was the concentration of the product P. This is trivial using the definition of a concentration.

:::

**Response Function**

Letting $n_{P,f}$ denote the molar amount of product P found by solving the mole balances, the model-predicted response can be calculated using equation (9).

$$
C_{P,\text{ model}} = \frac{n_{P,f}}{V} \tag{9}
$$

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

The response function can now be used to fit the reactor model to the experimental data. Doing so will yield the best estimates for the kinetics parameters, $V_{max}$ and $K_m$, and their 95% confidence intervals. It will also yield the coefficient of determination, $R^2$.

I can use the estimated parameter values to calculate the model-predicted response for every experiment. Then I can create a parity plot (experimental responses *vs*. model-predicted responses) and residuals plots (difference between the experimental and model-preducted responses *vs*. each of the adjusted inputs, in this case the initial substrate concentration and the reaction time).

The accuracy of the rate expression can then be assessed as described in this chapter and in @sec-kin-data-gen. The criteria suggesting accuracy are as follows:

* The coefficient of determination, $R^2$, will be close to 1.
* The uncertainty in each parameter estimate will be small compared to the estimate.
* The points in the parity plot will all be close to a diagonal line ($y_{\text{expt}} = y_{\text{model}}$).
* In each residuals plot, the points will scatter randomly about zero (the horizontal axis), and no systematic deviations will be apparent.

:::

**Parameter Estimation and Assessment of Accuracy**

```{r}
#| echo: false
#| output: false
library(tidyverse)
source("~/Libraries/R/fmt_tibble_col.R")
d <- read.csv("../RE_Basics_Examples/reb_8_4/python/reb_8_4_results.csv")
d <- fmt_tibble_col(d, 2, 3, 2, 2)
a <- c('V~max~','K~m~','R^2^')
b1 <- paste0(d$value[1],' ',d$units[1],', 95% CI [',d$value[2],', ',d$value[3],']')
b2 <- paste0(d$value[4],' ',d$units[4],', 95% CI [',d$value[5],', ',d$value[6],']')
b <- c(b1,b2,d$value[7])
 # item, value, units
d <- data.frame(a,b)
```

Fitting the reactor model to the experimental data yielded the results shown in @tbl-example_8_4_results. The estimated parameter values were used to create the parity plot shown in @fig-example_8_4_parity and the residuals plots shown in @fig-example_8_4_residuals_t and @fig-example_8_4_residuals_CS.

```{r}
#| echo: false
#| warning: false
#| label: tbl-example_8_4_results
#| tbl-cap: Parameter estimation results
library(kableExtra)
library(knitr)
kbl(d, format = "markdown", align = "cc", col.names = NULL)
```

![Parity plot for the proposed rate expression.](Graphics/reb_8_4_parity.png){#fig-example_8_4_parity width=80%}

![Residuals *vs*. reaction time.](Graphics/reb_8_4_residuals_vs_t.png){#fig-example_8_4_residuals_t width=80%}

![Residuals *vs*. initial substrate concentration.](Graphics/reb_8_4_residuals_vs_CS.png){#fig-example_8_4_residuals_CS width=80%}

The confidence intervals for both $V_{max}$ and $K_m$ are narrow and the coefficient of determination is close to 1.0. In the parity plot the deviations of the responses from the line representing a perfect model are small. In both residuals plots the deviations about zero are random. All of these results indicate that the proposed rate expression is accurate when the kinetics parameters have the values shown in @tbl-example_8_4_results.

**Recommendation**

When the parameters, $V_{max}$ and $K_m$ have the values shown in @tbl-example_8_4_results, the rate expression is accurate and acceptable.

---

## Symbols Used in @sec-bstr-data-analysis
| Symbol | Meaning |
|:-------|:--------|
| $b$ | $y$-$ntercept of a linearized response model. |
| $f\left(\right)$ | Mathematical function of the variables enclosed by the parentheses. |
| $k$ | Rate coefficient. |
| $m_i$ | Slope in the $i$ direction of a linear response model. |
| $n_i$  |  Molar amount of reagent $i$. |
| $r$ | Rate of reaction per unit volume. |
| $r_i$ | Rate of generation of reagent $i$ per unit volume. |
| $t$ | Time. |
| $t_{1/2}$ | Reaction half-life. |
| $x_i$ | Independent variable in a linear response function. |
| $y$ | Reactor response, an additional subscripted "expt" denotes the experimentally measured response, an additional subscripted "model" denotes the response predicted by the model. |
| $C_i$ | Molar concentration of reagent $i$. |
| $R^2$ | Coefficient of determination. |
| $V$ | Volume. |
| $\alpha$ | Power-law reaction order. |
| $\nu_i$ | Stoichiometric coefficient of reagent $i$. |
| $\delta n_i$ | Change in $n_i$. |


: {tbl-colwidths="[20,80]"}