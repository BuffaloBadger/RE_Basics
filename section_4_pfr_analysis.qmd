# PFR Analysis {#sec-4_pfr_analysis}

## PFR Characteristics

## PFR Operation

## Qualitative Analysis of Steady-State Reaction in a PFR

## PFR Design Equations

## PFR Reaction Fronts

## Packed Bed PFRs

## Examples

```{r}
#| echo: false
#| output: false
library(tidyverse)
library(knitr)
library(kableExtra)
library(readxl)
source("~/Libraries/R/fmt_tibble_col.R")
```


### Steady-State Conversion in a Gas-Phase PFR {#sec-example_13_7_1}

{{< include examples/reb_13_7_1/narrative.qmd >}}

{{< include examples/reb_13_7_1/equations.qmd >}}

---

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

This assignment describes an isolated PFR and the manner in which it operates and asks questions about the reactor outputs. For analysis purposes, it isn't part of a larger system, so I will need to create a model for the reactor and use it to answer the questions. I'll summarize the assignment by assigning an appropriate variable symbol to each quantity provided in the narrative. I'll use a subscripted "in" to denote quantities that apply at the inlet to the reactor.

:::

#### Assignment Summary

**Given and Known Constants**: $\Delta H_1$ = 44.8 kJ mol^-1^, $k_{0,1}$ = 7.22 x 10^6^ mol atm^-2^ cm^-3^ s^-1^, $E_1$ = 84.1 kJ mol^-1^, $L$ = 10 ft, $D$ = 1 in, $T_{ex}$ = 200 °C, $U$ = 7.48 x 10^4^ J h^-1^ ft^-2^ K^-1^, $y_{A,in}$ = 0.60, $y_{B,in}$ =  0.40, $\dot{V}_{in}$ = 282 L min^-1^, $P$ = 2.5 atm, $T_{in}$ = 175 °C, $\hat{C}_{p,A}$ = 18.0 cal mol^-1^ K^-1^, $\hat{C}_{p,B}$ = 12.25 cal mol^-1^ K^-1^, $\hat{C}_{p,Z}$ = 21.2 cal mol^-1^ K^-1^, and $R$ = 8.314 J mol^-1^ K^-1^ = 0.08206 L atm mol^-1^ K^-1^.

**Reactor System**: Heated, steady-state PFR

**Quantities of Interest**: $T \big\vert_{z=L}$ and $f_B$

#### Mathematical Formulation of the Solution

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

I need to generate the reactor design equations needed to model this PFR as discussed in @sec-3_design_eqns. Mole balances are always included among the reactor design equations. I will write mole balances on each of the reagents in the system, A, B, and Z. The PFR operates at steady-state, so I'll start with the general steady-state PFR given in @eq-pfr_ss_mol_balance. There is only one reaction taking place, so the summation reduces to a single term. 

$$
\frac{d \dot{n}_i}{d z}  =\frac{\pi D^2}{4}\cancelto{\nu_{i,1}r_1}{\sum_j \nu_{i,j}r_j}
$$

This reactor is not isothermal, so the mole balances must be solved simultaneously with an energy balance on the reacting gas. To generate that equation, I'll start from the general form of the steady-state PFR energy balance, @eq-pfr_ss_energy_balance. There are three reagents present in the reactor, so the first summation expands to three terms. Again, there is only one reaction taking place, so the final summation reduces to a single term. Knowing that I will be solving the design equations numerically, I'll rearrange the equation into the form of a derivative expression.

$$
\cancelto{\left( \dot{n}_A \hat{C}_{p,A} + \dot{n}_B \hat{C}_{p,B} + \dot{n}_Z \hat{C}_{p,Z}  \right)}{\left(\sum_i \dot{n}_i \hat{C}_{p,i} \right)} \frac{d T}{d z} = \pi D U\left( T_{ex} - T  \right) - \frac{\pi D^2}{4}\cancelto{r_1 \Delta H_1}{\sum_j r_j \Delta H_j}
$$

$$
\frac{d T}{d z} = \frac{\pi D U\left( T_{ex} - T  \right) - \frac{\pi D^2}{4}r_1 \Delta H_1}{\dot{n}_A \hat{C}_{p,A} + \dot{n}_B \hat{C}_{p,B} + \dot{n}_Z \hat{C}_{p,Z}}
$$

The PFR is being heated using the latent heat of a heat exchange fluid. Because only the latent heat is involved, the temperature of the exchange fluid is constant. That means that I can solve the other mole and energy balances independently of an energy balance on the heat exchange fluid. (In this assignment I'm not provide with sufficient information to write the exchange fluid energy balance, but neither does the assignment ask for anything that would need to be calculated using it.)

Finally, for PFRs a momentum balance is needed to account for pressure drop along the length of the reactor. In this assignment, however, it is noted that pressure drop is negligible, so a momentum balance is not needed.

:::

**Reactor Design Equations**

Mole balance design equations for A, B, and Z are presented in equations (3) - (5). The energy balance on the reacting gas is given in equation (6).

$$
\frac{d \dot{n}_A}{dz} = -\frac{\pi D^2}{4}r_1 \tag{3}
$$

$$
\frac{d \dot{n}_B}{dz} = -\frac{\pi D^2}{4}r_1 \tag{4}
$$

$$
\frac{d \dot{n}_Z}{dz} = \frac{\pi D^2}{4}r_1 \tag{5}
$$

$$
\frac{d T}{d z} = \frac{\pi D U\left( T_{ex} - T  \right) - \frac{\pi D^2}{4}r_1 \Delta H_1}{\left( \dot{n}_A \hat{C}_{p,A} + \dot{n}_B \hat{C}_{p,B} + \dot{n}_Z \hat{C}_{p,Z} \right)} \tag{6}
$$

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

The reactor design equations consist of four IVODEs and they contain four dependent variables, so there isn't a need to either eliminate a dependent variable or add an IVODE. However, in order to solve the design equations numerically, initial values and a stopping criterion are needed.

I can define $z=0$ to be the inlet to the reactor. The initial values are then simply the values of the depedent variables at the reactor inlet. The length of the reactor is provided, so that can serve as the stopping criterion.

:::

**Initial Values and Stopping Criterion**

| Variable | Initial Value | Stopping Criterion |
|:------:|:-------:|:-------:|
| $z$ | $0$ | $L$ |
| $\dot{n}_A$ | $\dot{n}_{A,in}$ | |
| $\dot{n}_B$ | $\dot{n}_{B,in}$ | |
| $\dot{n}_Z$ | $0$ | |
| $T$ | $T_{in}$ | |
  
: Initial values and stopping criterion for solving  equations, (numbers). {#tbl-example_13_7_1_initial_values}

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

In order to solve the IVODEs numerically I'll need to do two things: calculate the values of the derivatives at the start of each integration step and calculate all of the initial and final values in @tbl-example_13_7_1_initial_values.

I'll need to evaluate the derivatives at the start of each integration step. At that point, the independent ($z$) and dependent ($\dot{n}_A$, $\dot{n}_B$, $\dot{n}_Z$, and $T$) variables will be known along with the given and known constants. I will need to calculate any other quantities that appear in the derivatives expressions, equations (3) through (6).

Looking at those equations I see that I'll need to calculate the rate, $r_1$. I can use the rate expression, equation (2), to do that, but that wiill require me to calculate the rate coefficient, $k_1$, and the partial pressures of A and B. The Arrhenius expression, @eq-arrhenius, can be used for the former and the defining equation for partial pressure for the latter.

$$
P_i = y_iP = \frac{\dot{n}_i}{\sum_i\dot{n}_i}
$$

:::

**Ancillary Equations for Evaluating the Derivatives**

$$
k_1 = k_{0,1} \exp{\left( \frac{-E_1}{RT} \right)} \tag{7}
$$

$$
P_A = \frac{\dot{n}_A}{\dot{n}_A + \dot{n}_B + \dot{n}_Z}P \tag{8}
$$

$$
P_B = \frac{\dot{n}_B}{\dot{n}_A + \dot{n}_B + \dot{n}_Z}P \tag{9}
$$

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point
When I solve the IVODEs numerically, I'll also need to know the initial and final values in @tbl-example_13_7_1_initial_values....
:::

**Ancillary Equations for Calculating the Initial and Final Values**

$$
\dot{n}_{A,in} = y_{A,in}\frac{P\dot{V}_{in}}{RT_{in}}\tag{10}
$$

$$
\dot{n}_{B,in} = y_{B,in}\frac{P\dot{V}_{in}}{RT_{in}}\tag{11}
$$

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point
develop equations needed to calculate quantities of interest
:::

**Ancillary Equations for Calculating the Quantities of Interest**

Solving the reactor design equations yields [list independent and dependent variables]. 

$$
f_B = \frac{\dot{n}_{B,in} - \dot{n}_B}{\dot{n}_{B,in}}\tag{12}
$$

**Calculations Summary**

1. Substitute given and known constants into all equations.
2. When it is necessary to evaluate the derivatives
	a. [list of variables] will be available.
	b. 
3. When it is necessary to calculate the initial and final values in @tbl-example_13_7_1_initial_values
	a. [list of variables] are known constants.
	b. 
4. When it is necessary to evaluate the residual corresponding to [variable]
    a. a guess for [variable] will be available for use in all equations.
    b. 
5. When it is necessary to calculate the quantities of interest, [list]
	a. corresponding sets of values of [independent variable], [dependent variable], spanning the range from their initial values to their final values will be available.
	b. 

#### Numerical implementation of the Solution

1. Make the given and known constants available for use in all functions.
2. Define a variable to hold [unknown constant] and make it available to all functions.
3. Write a derivatives function that
	a. receives the independent and dependent variables, [list], as arguments,
	b. evaluates the derivatives as described in step 2 of the calculations summary, and 
	c. returns the values of the derivatives, [list].
4. Write a residuals function that
	a. receives a guess for [variable] and makes it available to all functions,
	b. evaluates the residual as described in step 4 of the calculations summary, and
	c. returns the value of [variable].
5. Write a reactor model function that
	a. ...
	b. calculates the initial and final values in @tbl-example_13_7_1_initial_values as described in step 3 of the calculations summary,
	c. gets corresponding sets of values of [independent variable], [dependent variable], spanning the range from their initial values to their final values by calling an IVODE solver and passing the following information to it
		i. the initial values and stopping criterion in @tbl-example_13_7_1_initial_values and
		ii. the name of the derivatives function from step 3 above,
	d, checks that the solver successfully solved the IVODEs, and
	e. returns the values returned by the IVODE solver.
6. Perform the analysis by
	a. ...
	b. getting corresponding sets of values of [independent variable], [dependent variable], spanning the range from their initial values to their final values by calling the reactor model function from step 5 above,
	c. calculates the quantities of interest as described in step 5 of the calculations summary,
	d. ....

#### Results and Discussion

```{r}
#| echo: false
#| output: false
df <- read.csv("examples/reb_13_7_1/results.csv") 
df <- fmt_tibble_col(df, 2, 3, 3, 1)
```

The calculations were performed as described above. The outlet temperature is `r df$value[1]` `r df$units[1]` and the conversion of B is `r df$value[2]` `r df$units[2]`.


::: {.callout-note appearance="simple"}
## [SC]{style="color:blue"}o[RE]{style="color:red"} Connection
Videos showing how to complete this assignment using either Matlab or Python, along with the Matlab and Python code, are available in [SCoRE](http://buffalobadger.github.io/SCoRE/class_19.html).
:::

### Required Steady-State PFR Feed Temperature {#sec-example_13_7_2}

{{< include examples/reb_13_7_2/narrative.qmd >}}

{{< include examples/reb_13_7_2/equations.qmd >}}

---

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point
identify problem type, describe variable naming
:::

#### Assignment Summary

**Given and Known Constants**: 

**Reactor System**: 

**Quantities of Interest**: 

#### Mathematical Formulation of the Solution

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point
generate design equations
:::

**Reactor Design Equations**

Mole balance design equations for [reagents] are presented in equations (numbers). The energy balance on the reacting fluid is given in equation (number). An energy balance on the heat exchange fluid is shown in equation (number).

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point
check number of ivodes and deps
:::

differential ideal gas law

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point
define initial values and stopping criterion
:::

**Initial Values and Stopping Criterion**

| Variable | Initial Value | Stopping Criterion |
|:------:|:-------:|:-------:|
| $$ | $$ | $$ |
| $$ | $$ | |
  
: Initial values and stopping criterion for solving  equations, (numbers). {#tbl-example_13_7_2_initial_values}

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

In order to solve the IVODEs numerically I'll need to do two things: calculate the values of the derivatives at the start of each integration step and calculate all of the initial and final values in @tbl-example_13_7_2_initial_values.

I'll start by writing the design equations in the form of derivative expressions (see @sec-apndx....

I'll need to evaluate the derivatives at the start of each integration step. At that point, the independent and dependent variables will be known along with the given and known constants. I will need to calculate any other quantities that appear in the derivatives expressions.
:::

**Ancillary Equations for Evaluating the Derivatives**



:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point
When I solve the IVODEs numerically, I'll also need to know the initial and final values in @tbl-example_13_7_2_initial_values....
:::

**Ancillary Equations for Calculating the Initial and Final Values**



:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point
develop equations needed to calculate quantities of interest
:::

**Ancillary Equations for Calculating the Quantities of Interest**

Solving the reactor design equations yields [list independent and dependent variables]. 

**Calculations Summary**

1. Substitute given and known constants into all equations.
2. When it is necessary to evaluate the derivatives
	a. [list of variables] will be available.
	b. 
3. When it is necessary to calculate the initial and final values in @tbl-example_13_7_2_initial_values
	a. [list of variables] are known constants.
	b. 
4. When it is necessary to evaluate the residual corresponding to [variable]
    a. a guess for [variable] will be available for use in all equations.
    b. 
5. When it is necessary to calculate the quantities of interest, [list]
	a. corresponding sets of values of [independent variable], [dependent variable], spanning the range from their initial values to their final values will be available.
	b. 

#### Numerical implementation of the Solution

1. Make the given and known constants available for use in all functions.
2. Define a variable to hold [unknown constant] and make it available to all functions.
3. Write a derivatives function that
	a. receives the independent and dependent variables, [list], as arguments,
	b. evaluates the derivatives as described in step 2 of the calculations summary, and 
	c. returns the values of the derivatives, [list].
4. Write a residuals function that
	a. receives a guess for [variable] and makes it available to all functions,
	b. evaluates the residual as described in step 4 of the calculations summary, and
	c. returns the value of [variable].
5. Write a reactor model function that
	a. ...
	b. calculates the initial and final values in @tbl-example_13_7_2_initial_values as described in step 3 of the calculations summary,
	c. gets corresponding sets of values of [independent variable], [dependent variable], spanning the range from their initial values to their final values by calling an IVODE solver and passing the following information to it
		i. the initial values and stopping criterion in @tbl-example_13_7_2_initial_values and
		ii. the name of the derivatives function from step 3 above,
	d, checks that the solver successfully solved the IVODEs, and
	e. returns the values returned by the IVODE solver.
6. Perform the analysis by
	a. ...
	b. getting corresponding sets of values of [independent variable], [dependent variable], spanning the range from their initial values to their final values by calling the reactor model function from step 5 above,
	c. calculates the quantities of interest as described in step 5 of the calculations summary,
	d. ....

#### Results and Discussion

The calculations were performed as described above.

::: {.callout-note appearance="simple"}
## [SC]{style="color:blue"}o[RE]{style="color:red"} Connection
Videos showing how to complete this assignment using either Matlab or Python, along with the Matlab and Python code, are available in [SCoRE](http://buffalobadger.github.io/SCoRE/class_19.html).
:::

### Pressure Drop in a Steady-State, Gas-Phase PFR {#sec-example_13_7_3}

{{< include examples/reb_13_7_3/narrative.qmd >}}

{{< include examples/reb_13_7_3/equations.qmd >}}

---

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point
identify problem type, describe variable naming
:::

#### Assignment Summary

**Given and Known Constants**: 

**Reactor System**: 

**Quantities of Interest**: 

#### Mathematical Formulation of the Solution

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

$$
\frac{{dP}}{{dz}} =  - \frac{{1 - \varepsilon }}{{{\varepsilon ^3}}}\frac{{{G^2}}}{{\rho {\Phi _s}{D_p}}}\left[ {\frac{{150\left( {1 - \varepsilon } \right)\mu }}{{{\Phi _s}{D_p}G}} + 1.75} \right]
$$

:::

**Reactor Design Equations**

Mole balance design equations for [reagents] are presented in equations (numbers). The energy balance on the reacting fluid is given in equation (number). An energy balance on the heat exchange fluid is shown in equation (number).

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point
check number of ivodes and deps
:::

differential ideal gas law

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point
define initial values and stopping criterion
:::

**Initial Values and Stopping Criterion**

| Variable | Initial Value | Stopping Criterion |
|:------:|:-------:|:-------:|
| $$ | $$ | $$ |
| $$ | $$ | |
  
: Initial values and stopping criterion for solving  equations, (numbers). {#tbl-example_13_7_3_initial_values}

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

In order to solve the IVODEs numerically I'll need to do two things: calculate the values of the derivatives at the start of each integration step and calculate all of the initial and final values in @tbl-example_13_7_3_initial_values.

I'll start by writing the design equations in the form of derivative expressions (see @sec-apndx....

I'll need to evaluate the derivatives at the start of each integration step. At that point, the independent and dependent variables will be known along with the given and known constants. I will need to calculate any other quantities that appear in the derivatives expressions.
:::

**Ancillary Equations for Evaluating the Derivatives**



:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point
When I solve the IVODEs numerically, I'll also need to know the initial and final values in @tbl-example_13_7_3_initial_values....
:::

**Ancillary Equations for Calculating the Initial and Final Values**



:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point
develop equations needed to calculate quantities of interest
:::

**Ancillary Equations for Calculating the Quantities of Interest**

Solving the reactor design equations yields [list independent and dependent variables]. 

**Calculations Summary**

1. Substitute given and known constants into all equations.
2. When it is necessary to evaluate the derivatives
	a. [list of variables] will be available.
	b. 
3. When it is necessary to calculate the initial and final values in @tbl-example_13_7_3_initial_values
	a. [list of variables] are known constants.
	b. 
4. When it is necessary to evaluate the residual corresponding to [variable]
    a. a guess for [variable] will be available for use in all equations.
    b. 
5. When it is necessary to calculate the quantities of interest, [list]
	a. corresponding sets of values of [independent variable], [dependent variable], spanning the range from their initial values to their final values will be available.
	b. 

#### Numerical implementation of the Solution

1. Make the given and known constants available for use in all functions.
2. Define a variable to hold [unknown constant] and make it available to all functions.
3. Write a derivatives function that
	a. receives the independent and dependent variables, [list], as arguments,
	b. evaluates the derivatives as described in step 2 of the calculations summary, and 
	c. returns the values of the derivatives, [list].
4. Write a residuals function that
	a. receives a guess for [variable] and makes it available to all functions,
	b. evaluates the residual as described in step 4 of the calculations summary, and
	c. returns the value of [variable].
5. Write a reactor model function that
	a. ...
	b. calculates the initial and final values in @tbl-example_13_7_3_initial_values as described in step 3 of the calculations summary,
	c. gets corresponding sets of values of [independent variable], [dependent variable], spanning the range from their initial values to their final values by calling an IVODE solver and passing the following information to it
		i. the initial values and stopping criterion in @tbl-example_13_7_3_initial_values and
		ii. the name of the derivatives function from step 3 above,
	d, checks that the solver successfully solved the IVODEs, and
	e. returns the values returned by the IVODE solver.
6. Perform the analysis by
	a. ...
	b. getting corresponding sets of values of [independent variable], [dependent variable], spanning the range from their initial values to their final values by calling the reactor model function from step 5 above,
	c. calculates the quantities of interest as described in step 5 of the calculations summary,
	d. ....

#### Results and Discussion

The calculations were performed as described above.

::: {.callout-note appearance="simple"}
## [SC]{style="color:blue"}o[RE]{style="color:red"} Connection
Videos showing how to complete this assignment using either Matlab or Python, along with the Matlab and Python code, are available in [SCoRE](http://buffalobadger.github.io/SCoRE/class_20.html).
:::

### Example 4 {#sec-example_13_7_4}

### Example 5 {#sec-example_13_7_5}

### Example 6 {#sec-example_13_7_6}

## Symbols Used in [Chapter -@sec-4_pfr_analysis]
