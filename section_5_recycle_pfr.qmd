# Recycle PFRs {#sec-5_recycle_pfr}

One of the most important factors when evaluating or comparing different reactor systems are the ways that the composition and temperature vary as a function of the time during which the reaction is taking place. CSTRs and PFRs represent the two extremes. The tempeature and composition are constant for the entire time the reaction is taking place in a CSTR, while they vary continuously over the time the reaction is taking place in a PFR.

@sec-5_thermal_backmix_pfr showed how, for an exothermic reaction, the variation of the temperature during the time the reaction is taking place in a PFR can be altered to be a little bit more like a CSTR. That is accomplished by transferring heat from the product stream to the feed stream. This chapter examines a way to alter the variation of both the temperature [and the composition]{.underline} during the time the reaction is taking place in a PFR to be a little bit more like a CSTR. To accomplish that, a fraction of the product stream is split off and mixed with the process feed stream.

## Recycle PFRs

A recycle PFR is depicted in @fig-recycle_pfr. The system consists of a stream mixer, the PFR, and a stream splitter. The fluid stream, 2, leaving the reactor is split into two streams. One of the resulting streams, 3, is the product stream for the process. The other stream, 4, is called the *recycle* stream because it is diverted back to the reactor inlet where it is mixed with the fresh feed to the process, stream 0. The resulting mixed stream, 1, is what enters the PFR.

![Schematic representation of a recycle PFR showing the stream splitter, S, PFR reactor, and stream mixer, M.](Graphics/recycle_pfr.png){#fig-recycle_pfr width="60%"}

In a steady-state CSTR, the fresh feed is immediately mixed into the reacting fluid. As a consequence, the composition and temperature are at their outlet values for the entire time the fluid reacts. In a PFR, the composition and temperature change continuously from their inlet values to their final values as the fluid flows through the reactor. By recycling, or backmixing, some of the converted fluid into the fresh feed, the inlet composition and temperature are effectively those of a partially converted feed stream. Another way to describe the differences is that the composition and temperature of the reacting fluid in a PFR progress from their inlet values to their outlet values while the composition and temperature of the reacting fluid in a CSTR immediately jump to their outlet values. In those terms, the composition and temperature of the reacting fluid in a recycle PFR immediately jump part of the way to their outlet values and then progress the rest of the way to their outlet values.

In other words, adding recycle to a PFR shifts it's behavior to be more like a CSTR. The ratio of the flow rate of stream 4 to that of stream 3 is called the **recycle ratio**, $R_R$, @eq-recycle_ratio. As the recycle ratio approaches infinity, that is as more and more of stream 2 is recycled, a recycle PFR approaches the behavior of a CSTR. The recycle ratio can be calculated using volumetric flow rates or the molar flow rate of any reagent, $i$, present in the system, as shown in the equation.

$$
R_R = \frac{\dot{V}_4}{\dot{V}_3} = \frac{\dot{n}_{i,4}}{\dot{n}_{i,3}}
$$ {#eq-recycle_ratio}

Adding thermal backmixing to a PFR shifts it's thermal behavior to be more like a CSTR without affecting its compositional behavior. In contrast, adding recycle to a PFR shifts all of its behavior to be more like a CSTR. So if the behavior of a CSTR is desired, why not just use a CSTR? Why use a recycle PFR? One situation where a recycle PFR would be preferred over a CSTR is when the reactions taking place require a heterogeneous catalyst. Specifically, the catalyst can be loaded into the PFR with the reacting fluid flowing through the resulting packed bed. This avoids the need to devise a way to achieve the perfect mixing required in a CSTR.

Generally speaking CSTR-like behavior, whether provided by an actual CSTR or by a recycle PFR, is desired when the outlet composition and temperature result ih a larger rate or better selectivity than the feed composition and temperature. For example, the rate of an exothermic auto-catalytic reaction in an adiabatic reactor is greater at the outlet conditions where the temperature is larger (larger rate coefficient) and the product concentration is higher (which increases the rate of an auto-catalytic reaction).

In fact, for an exothermic auto-catalytic reaction, a recycle PFR might be preferred over a CSTR. The rate of an auto-catalytic reaction increases with product concentration, but it still must go to zero as the reactant becomes fully consumed. In other words, there is a rate trade-off between high product concentration and low reactant concentration. At very high conversions where the reactant concentration is near zero, the rate in a CSTR will be very small for the entire time the reaction is taking place. In a recycle PFR, the rate at the inlet will be larger than it would be without recycle due to the presence of product at an appreciable concentration and the higher temperature. Then it will decrease as the fluid flows through the PFR, ultimately becoming equal to the rate in a CSTR. Thus, the average rate in the recycle PFR will be greater than the rate in a CSTR, and consequently, the volume of the recycle PFR will be smaller.

## Analysis of Recycle PFRs

Three components make-up a recycle PFR: a stream mixer, the PFR, and a stream splitter. In order to model a recycle PFR, design equations are needed for each component. *Reaction Engineering Basics* only considers steady-state recycle PFRs. The reactor design equations for a steady-state PFR, Equations [-@eq-pfr_ss_mol_balance] and [-@eq-pfr_ss_energy_balance], were derived in @sec-apndx_ideal_reactor_models, presented in @sec-3_design_eqns, and discussed in @sec-4_pfr_analysis. The general mole and reacting fluid energy balances are reproduced below. Recall that these equations also can be written using the reactor volume as the dependent variable, and the sensible heat term can be written in terms of the volumetric or gravimetric heat capacity of the reacting fluid as a whole. If the PFR is heated or cooled using a heat exchange fluid, and energy balance on that fluid, @eq-exchange_energy_bal_sensible or @eq-exchange_energy_bal_latent, as appropriate, must be added to the reactor design equations, and if there is pressure drop a momentum balance, @eq-pfr_momentum_balance or @eq-pfr_ergun_eqn, as appropriate, must be added.

$$
\frac{d \dot{n}_i}{d z}  =\frac{\pi D^2}{4}\sum_j \nu_{i,j}r_j
$$

$$
\left(\sum_i \dot{n}_i \hat{C}_{p,i} \right) \frac{d T}{d z} = \pi D U\left( T_{ex} - T  \right) - \frac{\pi D^2}{4}\sum_j r_j \Delta H_j
$$

Mole and energy balances for stream splitters and stream mixers were presented in @sec-5_reactor_networks and are reproduced below using the stream notation in @fig-recycle_pfr. For stream splitters, the fact that all streams are at the same temperature is used in lieu of an energy balance. The energy balance for a stream mixer can also be written in terms of volumetric or gravimetric heat capacities of the flowing fluids.

$$
0 = \dot{n}_{i,2} - \dot{n}_{i,3} - \dot{n}_{i,4}
$$

$$
T_2 = T_3 = T_4
$$

$$
0 = \dot{n}_{i,1} - \dot{n}_{i,0} - \dot{n}_{i,4}
$$ 

$$
0 = \sum_i \left( \dot{n}_{i,0} \int_{T_{0}}^{T_{1}} \hat{C}_{p,i} dT + \dot{n}_{i,4} \int_{T_{4}}^{T_{1}} \hat{C}_{p,i} dT  \right) 
$$

When the fluid in a recycle PFR is incompressible, balance equations can be written for the volumetric flow rates. Additionally, a balance on the entire process shows that streams 0 and 3 have equal volumetric flow rates, and a balance on just the PFR shows that streams 1 and 2 have equal volumetric flow rates.

$$
0 = \dot{V}_2 - \dot{V}_3 - \dot{V}_4
$${#eq-splitter_liq_vol_bal}

$$
0 = \dot{V}_1 - \dot{V}_0 - \dot{V}_4
$${#eq-mixer_liq_vol_bal}

$$
\dot{V}_0 = \dot{V}_3; \quad \left( \text{incompressible liquids} \right)
$${#eq-overall_vol_flow_bal_recycle}

$$
\dot{V}_1 = \dot{V}_2; \quad \left( \text{incompressible liquids} \right)
$${#eq-reactor_vol_flow_bal_recycle}

### Solving the Recycle PFR Design Equations

The design equations for a recycle PFR form a set of differential-algebraic equations (DAEs). That set of DAEs includes the PFR design equations as IVODEs and the stream mixer and stream splitter mole and energy balances as ATEs. In some instances it may be possible to solve the IVODEs independently from the ATEs. To do that, the composition and temperature of stream 1 must be known. Most commonly, though, the composition of the feed, stream 0, is known and that of stream 1 is unknown.

In the more common situation where the composition and temperature of stream 0 are known (and not those of stream 1), the DAEs must be solved simultaneously. The procedure for doing so is analogous to the solution of the DAEs associated with a thermally backmixed PFR. @sec-apndx_solve_daes provides the mathematical and numerical details for doing so. In essence, the solution is structured as if only the ATEs are being solved. By properly choosing the unknowns in the ATEs, the IVODEs are solved within the computer function that evaluates the ATE residuals.

When modeling PFRs, it often is not necessary to solve all of the ATEs numerically. Only the stream mixer mole and energy balance ATEs need to be solved numerically to find the molar flow rates and temperature of stream 1. When the solution is structured in this way, the stream splitter ATEs are solved analytically within the function that evaluates the residuals, as are the IVODEs. The most significant advantage of structuring the solution in this manner is that the number of initial guesses for the unknowns in the ATEs is reduced by nearly one-half. (To see the difference, compare the solution presented in [Example -@sec-example_K] to the solution presented in [Example -@sec-example_17_3_1]. The same set of DAEs is solved in both examples, but in [Example -@sec-example_K] seven initial guesses are required while in [Example -@sec-example_17_3_1] only three initial guesses are necessary.)

### Multiplicity in Steady-State Recycle PFRs

@sec-5_thermal_backmix_pfr noted that when the input to a reactor can be affected by the output from that reactor, multiple steady states may be observed. In a recycle PFR, a fraction of the reactor output is mixed into the reactor input, so clearly the input is affected by the output. As such, multiple steady states can occur in recycle PFRs, just as they can in CSTRs and thermally backmixed PFRs. When the inputs and operating parameters for a recycle PFR are fixed and the design equations are being solved to find the reactor outputs, the initial guesses should be varied to determine whether there are multiple solution for the model equations. (In more advanced courses and books on reaction engineering analysis methods are typically presented for determining when multiple steady states can occur and for determining the stability of each steady state. In this book, Examples [-@sec-example_12_7_4], [-@sec-example_12_7_6], and [-@sec-example_16_3_2] use more rudimentary approaches to determining whether multiple steady states are possible and whether a given steady state is stable.)

## Examples

### Producing a Chiral Molecule in a Recycle PFR {#sec-example_17_3_1}

{{< include examples/reb_17_3_1/narrative.qmd >}}

{{< include examples/reb_17_3_1/equations.qmd >}}

---

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

identify problem type, describe variable naming, identify reactor operating mode

:::

#### Assignment Summary

**Given and Known Constants**: 

**Reactor System**: 

**Quantities of Interest**: 

#### Mathematical Formulation of the Solution

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

generate design equations

:::

**Reactor Design Equations**

Mole balance design equations for [reagents] are presented in equations (numbers). The energy balance on the reacting fluid is given in equation (number). An energy balance on the heat exchange fluid is shown in equation (number). The momentum balance is given in equation (number).

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

check number of ivodes and deps, and if needed, generate IVODE from the differential ideal gas law

:::

A differential form of the ideal gas law, appropriate for this reactor system, is shown in equation (number).

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

define initial values and stopping criterion

:::

**Initial Values and Stopping Criterion**

| Variable | Initial Value | Stopping Criterion |
|:------:|:-------:|:-------:|
| $$ | $$ | $$ |
| $$ | $$ | |
  
: Initial values and stopping criterion for solving  equations, (numbers). {#tbl-example_17_3_1_initial_values}

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

In order to solve the IVODEs numerically I'll need to do two things: calculate the values of the derivatives at the start of each integration step and calculate all of the initial and final values in @tbl-example_17_3_1_initial_values. At the start of each integration step, the independent variable (symbol) and dependent variables (list) will be known, as will the given and known constants listed above. I will need to calculate any other quantities that appear in the IVODE design equations (list).

identify and generate ancillary equations

:::

**Ancillary Equations for Evaluating the Derivatives**



:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

When I solve the IVODEs numerically, I'll also need to calculate the initial and final values in @tbl-example_17_3_1_initial_values....

:::

**Ancillary Equations for Calculating the Initial and Final Values**



:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

At this point the reactor design equations can be solved numerically to get corresponding sets of values of [list] spanning the range from their initial (inlet) values to their final (outlet) values.

develop equations needed to calculate quantities of interest

:::

**Ancillary Equations for Calculating the Quantities of Interest**

Solving the reactor design equations yields [list independent and dependent variables].  The quantities of interest....

**Calculations Summary**

1. Substitute given and known constants into all equations.
2. When it is necessary to evaluate the derivatives
	a. [list of variables] will be available.
	b. 
3. When it is necessary to calculate the initial and final values in @tbl-example_17_3_1_initial_values
	a. [list of variables] are known constants.
	b. 
4. When it is necessary to evaluate the residual corresponding to [variable]
    a. a guess for [variable] will be available for use in all equations.
    b. 
5. When it is necessary to calculate the quantities of interest, [list]
	a. corresponding sets of values of [independent variable], [dependent variable], spanning the range from their initial values to their final values will be available.
	b. 

#### Numerical implementation of the Solution

1. Make the given and known constants available for use in all functions.
2. Define a variable to hold [unknown constant] and make it available to all functions.
3. Write a derivatives function that
	a. receives the independent and dependent variables, [list], as arguments,
	b. evaluates the derivatives as described in step 2 of the calculations summary, and returns them.
4. Write a residuals function that
	a. receives a guess for [variable] and makes it available to all functions,
	b. evaluates the residual as described in step 4 of the calculations summary, and
	c. returns the value of [variable].
5. Write a reactor model function that
	a. ...
	b. calculates the initial and final values in @tbl-example_17_3_1_initial_values as described in step 3 of the calculations summary,
	c. gets corresponding sets of values of [independent variable], [dependent variable], spanning the range from their initial values to their final values by calling an IVODE solver and passing the following information to it
		i. the initial values and stopping criterion in @tbl-example_17_3_1_initial_values and
		ii. the name of the derivatives function from step 3 above,
	d. checks that the solver successfully solved the IVODEs, and
	e. returns the values returned by the IVODE solver.
6. Perform the analysis by
	a. ...
	b. calling the reactor model function from step 5 above to get corresponding sets of values of [independent variable], [dependent variable], spanning the range from their initial values to their final values,
	c. calculating the quantities of interest as described in step 5 of the calculations summary,
	d. ....

#### Results and Discussion

The calculations were performed as described above.

::: {.callout-note appearance="simple"}
## [SC]{style="color:blue"}o[RE]{style="color:red"} Connection
Videos showing how to complete this assignment using either Matlab or Python, along with the Matlab and Python code, are available in [SCoRE](http://buffalobadger.github.io/SCoRE/class_26.html).
:::

Class 32 Activity

### Parallel Reactions in a Recycle PFR {#sec-example_17_3_2}

{{< include examples/reb_17_3_2/narrative.qmd >}}

{{< include examples/reb_17_3_2/equations.qmd >}}

---

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

identify problem type, describe variable naming, identify reactor operating mode

:::

#### Assignment Summary

**Given and Known Constants**: 

**Reactor System**: 

**Quantities of Interest**: 

#### Mathematical Formulation of the Solution

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

generate design equations

:::

**Reactor Design Equations**

Mole balance design equations for [reagents] are presented in equations (numbers). The energy balance on the reacting fluid is given in equation (number). An energy balance on the heat exchange fluid is shown in equation (number). The momentum balance is given in equation (number).

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

check number of ivodes and deps, and if needed, generate IVODE from the differential ideal gas law

:::

A differential form of the ideal gas law, appropriate for this reactor system, is shown in equation (number).

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

define initial values and stopping criterion

:::

**Initial Values and Stopping Criterion**

| Variable | Initial Value | Stopping Criterion |
|:------:|:-------:|:-------:|
| $$ | $$ | $$ |
| $$ | $$ | |
  
: Initial values and stopping criterion for solving  equations, (numbers). {#tbl-example_17_3_2_initial_values}

:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

In order to solve the IVODEs numerically I'll need to do two things: calculate the values of the derivatives at the start of each integration step and calculate all of the initial and final values in @tbl-example_17_3_2_initial_values. At the start of each integration step, the independent variable (symbol) and dependent variables (list) will be known, as will the given and known constants listed above. I will need to calculate any other quantities that appear in the IVODE design equations (list).

identify and generate ancillary equations

:::

**Ancillary Equations for Evaluating the Derivatives**



:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

When I solve the IVODEs numerically, I'll also need to calculate the initial and final values in @tbl-example_17_3_2_initial_values....

:::

**Ancillary Equations for Calculating the Initial and Final Values**



:::{.callout-tip collapse="true"}
## Click Here to See What an Expert Might be Thinking at this Point

At this point the reactor design equations can be solved numerically to get corresponding sets of values of [list] spanning the range from their initial (inlet) values to their final (outlet) values.

develop equations needed to calculate quantities of interest

:::

**Ancillary Equations for Calculating the Quantities of Interest**

Solving the reactor design equations yields [list independent and dependent variables].  The quantities of interest....

**Calculations Summary**

1. Substitute given and known constants into all equations.
2. When it is necessary to evaluate the derivatives
	a. [list of variables] will be available.
	b. 
3. When it is necessary to calculate the initial and final values in @tbl-example_17_3_2_initial_values
	a. [list of variables] are known constants.
	b. 
4. When it is necessary to evaluate the residual corresponding to [variable]
    a. a guess for [variable] will be available for use in all equations.
    b. 
5. When it is necessary to calculate the quantities of interest, [list]
	a. corresponding sets of values of [independent variable], [dependent variable], spanning the range from their initial values to their final values will be available.
	b. 

#### Numerical implementation of the Solution

1. Make the given and known constants available for use in all functions.
2. Define a variable to hold [unknown constant] and make it available to all functions.
3. Write a derivatives function that
	a. receives the independent and dependent variables, [list], as arguments,
	b. evaluates the derivatives as described in step 2 of the calculations summary, and returns them.
4. Write a residuals function that
	a. receives a guess for [variable] and makes it available to all functions,
	b. evaluates the residual as described in step 4 of the calculations summary, and
	c. returns the value of [variable].
5. Write a reactor model function that
	a. ...
	b. calculates the initial and final values in @tbl-example_17_3_2_initial_values as described in step 3 of the calculations summary,
	c. gets corresponding sets of values of [independent variable], [dependent variable], spanning the range from their initial values to their final values by calling an IVODE solver and passing the following information to it
		i. the initial values and stopping criterion in @tbl-example_17_3_2_initial_values and
		ii. the name of the derivatives function from step 3 above,
	d. checks that the solver successfully solved the IVODEs, and
	e. returns the values returned by the IVODE solver.
6. Perform the analysis by
	a. ...
	b. calling the reactor model function from step 5 above to get corresponding sets of values of [independent variable], [dependent variable], spanning the range from their initial values to their final values,
	c. calculating the quantities of interest as described in step 5 of the calculations summary,
	d. ....

#### Results and Discussion

The calculations were performed as described above.

::: {.callout-note appearance="simple"}
## [SC]{style="color:blue"}o[RE]{style="color:red"} Connection
Videos showing how to complete this assignment using either Matlab or Python, along with the Matlab and Python code, are available in [SCoRE](http://buffalobadger.github.io/SCoRE/class_26.html).
:::


## Symbols used in [Chapter -@sec-5_recycle_pfr]

| Symbol | Meaning |
|:-------|:--------|
| $f_i$ | Fractional conversion of reactant $i$. |
| $k_j$ | Rate coefficient for reaction $j$. |
| $k_{0,j}$ | Arrhenius pre-exponential factor for rate coefficient $k_j$. |
| $\dot{n}_I$ | Molar flow rate of reagent $i$; an additional subscript denotes the flow stream. |
| $r_j$ | Rate of reaction $j$. |
| $y_i$ | Gas phase mole fraction of reagent $i$. |
! $z$ | Distance from the inlet of a PFR in the axial direction. |
| $A$ | Heat transfer area. |
| $C_i$ | Concentration of reagent $i$; an additional subscript denotes the flow stream. |
| $\hat{C}_{p,i}$ | Molar heat capacity of reagent $i$. |
| $\tilde{C}_{p,}$ | Gravimetric heat capacity. |
| $\breve{C}_{p,}$ | Volumetric heat capacity. |
| $D$ | PFR diameter. |
| $E_j$ | Arrhenius activation energy for rate coefficient $k_j$. |
| $P$ | Pressure. |
| $P_i$ | Parial pressure of reagent $i$. |
| $R$ | Ideal gas constant. |
| $T$ | Temperature; an additional subscript denotes the flow stream. |
| $U$ | Heat transfer coefficient; an additional subscript denotes the type of temperature difference to be used with it. |
| $V$ | Volume; an additional subscript denotes the equipment. |
| $\dot{V}$ | Volumetric flow rate; an additional subscript denotes the flow stream. |
| $\epsilon$ | Residual; an additional subscript is used to differentiate between multiple residuals. |
| $\nu_{i,j}$ | Stoichiometric coefficient of reagent $i$ in reaction $j$. |
| $\Delta H_j$ | Heat of reaction $j$. |
| $\Delta T$ | Temperature difference in a heat exchanger; an additional denotes the type (e. g. arithmetic mean, log-mean, or cold). |

: {tbl-colwidths="[20,80]"}
